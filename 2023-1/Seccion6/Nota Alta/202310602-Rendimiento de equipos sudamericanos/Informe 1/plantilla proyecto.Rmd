---
title: " PROYECTO DE ESTADISTICA"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    toc: yes
    df_print: paged
  html_notebook:
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: no
    number_sections: yes
    theme: yeti
---

# **Tema: Rendimiento de equipos sudamericanos**
Análisis del rendimiento de equipos sudamericanos en la Copa Sudamericana en los últimos 5 años   


## **Introducción**

<div style="text-align: justify"> El fútbol, es el deporte más popular de américa latina,Dentro de ello existen competiciones importantes, así como lo es "La copa sudamericana",la segunda competición más importante y prestigiosa a nivel de clubes de américa del sur, el cual esta organizado por la Confederación Sudamericana de Fútbol.

## **Relevancia**

<div style="text-align: justify"> La copa sudamericana es un atrayente de que sirve como generador de éxito,prestigio y dinero, pues el ganador obtiene 3,5 millones de euros aproximadamente,además levantar la copa sudamericana y también habilitar la opción hacia dos títulos internacionales más: La Recopa Sudamericana en el que enfrenta al campeón de la Copa Libertadores y La Suruga Bank, el cual es un torneo jugado en Japón, en el que se enfrenta al ganador de dicho país asiático.

<div style="text-align: justify"> El torneo también sirve como preparación para uno de los eventos más importantes de clubes, "Copa Mundial de Clubes de la FIFA",con ello los líderes que cada club obtienen estadísticas que definen al equipo por temporada, y apartir de allí hacer modificaciones dentro del mismo con el fin de lograr un mejor rendimiento, el país argentino es el pionero en este torneo, ya que ha obtenido 7 de las últimas 14 copas disputadas.

<div style="text-align: justify"> El modelo de la Copa Sudamericana es uno de los más complicados, debido a que inicia con partidos de eliminación directa entre equipos de zona sur y zona norte, las normas de dicho campeonato están en constante modificación debido a que no logran representar de manera equitativa a los equipos de todos los países en todas las etapas de la competencia. 

## **Objetivo general:**  
<div style="text-align: justify"> Realizar un análisis del rendimiento de los equipos sudamericanos en la Copa Sudamericana durante los últimos 5 años, con el objetivo de identificar los patrones de desempeño de los equipos y su evolución a lo largo del tiempo, así como también proponer posibles mejoras en la competición.  

## **Objetivos específicos:**
1) Recolectar una base de datos completa y actualizada de todos los partidos de la Copa Sudamericana disputados en los últimos 5 años.

2) Analizar el rendimiento de los equipos sudamericanos en términos de número de ocasiones claras de gol y ocasiones claras de gol falladas, así como también la cantidad de goles anotados y recibidos. 

3) Identificar el país con los equipos más exitosos en la Copa Sudamericana durante los últimos 5 años en relación a la etapa en la que fueron eliminados. 

4) Identificar a los países que tuvieron a los equipos que mostraron un mejor desempeño en cuanto a la precisión de goles en relación a la cantidad de equipos jugados. 


# **Datos**

## Recolección de datos
+ POBLACIÓN: Los equipos Sudamericanos que participaron en la Copa.
+ MUESTRA:  Cada equipo que participa al menos en un partido en la Copa Sudamericana en los años 2018 - 2022
+ TAMAÑO DE LA MUESTRA: El número de equipos a analizar es 149 (total de equipos) y la muestra es representativa de la población total.
+ TIPO DE MUESTREO: El tipo de muestreo es un censo, ya que se seleccionaron a todos los equipos que participaron en la copa Sudamericana desde el año 2018 - 2022.


## Analisis de variables:  
Las variables de la base de datos se clasifican en numérica discreta (7), numérica continua (4), categórica nominal (2) y categórica ordinal (2), ademas con su respectiva restricción como se ve en la siguiente tabla:  


| **Variable**                            | **Tipo**              | **Restricción**       |  
|-----------------------------------------|-----------------------|-----------------------|  
| Año                                     | Numérica   Discreta   | Entero no negativo    |  
| Equipo                                  | Categórica Nominal    | Valores repetitivos   |  
| Edad_promedio                           | Numérica   Continua   | Cantidad muy variable |  
| Pais                                    | Categórica Nominal    | Valores repetitivos   |  
| Eliminación                             | Categórica Ordinal    | Orden inalterable     |  
| Goles                                   | Numérica   Discreta   | Entero no negativo    |  
| Rojas                                   | Numérica   Discreta   | Entero no negativo    |  
| Amarillas                               | Numérica   Discreta   | Entero no negativo    |  
| Posesion_balon                          | Numérica   Continua   | Cantidad muy variable |  
| Faltas                                  | Numérica   Continua   | Cantidad muy variable |  
| Partidos                                | Numérica   Discreta   | Entero no negativo    |  
| Prescicion_goles                        | Categórica Ordinal    | Orden inalterable     |  
| ocaciones.claras.falladas               | Numérica   Discreta   | Entero no negativo    |  
| ocaciones.claras                        | Numérica   Discreta   | Entero no negativo    |  
| rendimiento.de.ocaciones.claras         | Numérica   Continua   | Cantidad muy variable |


## Limpieza de datos

Función para verificar si se cuenta con los paquetes necesarios
```{r}
libreria<-c("stringr","readr","plyr","dplyr","ggplot2")
for(i in libreria){
  if(!require(i,character.only = TRUE)){
    install.packages(i)
    library(i)
  }
}


```


Cargamos las librerías necesarias para poder llevar a cabo la limpieza de datos

```{r}
library(stringr)
library(readr)
library(plyr)
library(dplyr)
library(ggplot2)

datos<-read_csv("dato_completo.csv",show_col_types = FALSE )

datos
```
Procedemos a verificar los nombres de cada una de las variables dentro de nuestra base datos.
```{r}
names(datos)
```
Teniendo en cuenta que los nombres para cada columna son muy extensos procedemos a realizar el cambio de nombres usando la función *rename*
```{r}
datos<-rename(datos,Año="AÑO DE CAMPEONATO",Equipo="NOMBRE DE EQUIPO", Edad_promedio="EDAD PROMEDIO DE JUGADORES",Pais="PAIS AL QUE PERTENECEN EL CLUB", Eliminación="ETAPA EN EL QUE FUE ELIMINADO",Goles="TOTAL DE GOLES POR TORNEO", Rojas="CANTIDAD DE TARJETAS ROJAS",Amarillas="CANTIDAD DE TARJETAS AMARILLAS",Posesion_balon="POSESION PROMEDIO DE BALON % POR CAMPEONATO",Faltas="PROMEDIO DE FALTAS POR CAMPEONATO",Partidos="CANTIDAD DE PARTIDOS JUGADOS", Prescicion_goles="Prescición de goles a de ocaciones claras" )
datos
```
Verificamos los valores que hay en la columna Dais, en la cual, solo tendrían que constar de 10 valores. Dichos valores deberían de tener solo algunos países tales como: Argentina, Bolivia, Brasil, Chile, Colombia, Ecuador, Paraguay, Perú, Uruguay y Venezuela. Sin embargo, se es posible ver que existen datos como Argentino, Ayacucho, baranquilla,etc. 

```{r}
table(datos$Pais)
```

Para poder realizar la corrección de la columna país se hizo uso de la función *str_replace* en el caso de Ayacucho lo que se puso fue Perú porque Ayacucho pertenece a este país. Por otra parte en el caso de Barranquilla se remplazo por Colombia,  ya que en este caso Barranquilla pertenece a Colombia. En el resto de los casos el reemplazo es un poco mas obvio.
```{r}
datos$Pais<-str_replace(datos$Pais,"Ayacucho","Perú")
datos$Pais<-str_replace(datos$Pais,"Peru","Perú")
datos$Pais<-str_replace(datos$Pais,"Panamá","Colombia")
datos$Pais<-str_replace(datos$Pais,"Argentino","Argentina")
datos$Pais<-str_replace(datos$Pais,"Barranquilla","Colombia")
datos$Pais<-str_replace(datos$Pais,"paraguay","Paraguay")
table(datos$Pais)
datos
```
Luego de corregir la variable país se procedió a realizar la corrención en la columna que hace referencia a la etapa de clasificación por parte d e los equipos. Primero, verificamos los valores que tenemos en el data frame en relación a la columna de etapa de eliminación. Posteriormente, hacemos uso de la función *tolower* para poder poner a todos los caracteres a minúsculas; de esta manera, facilitar la corrección.
```{r}
table(datos$Eliminación)
datos$Eliminación<-tolower(datos$Eliminación)
```
Verificamos que los valores para la columna que hace referencia a la etapa de eliminación ahora cuenta cuentan con los caracteres en minúsculas.
```{r}
table(datos$Eliminación)
```
En este punto procedemos a corregir a aquellos valores que hacen referencia a lo mismo pero con diferentes nombres. Esto con el objetivo de uniformizar lo datos pertenecientes a la columna para su posterior análisis.
```{r}
datos$Eliminación<-str_replace(datos$Eliminación,"semi final","semis")
datos$Eliminación<-str_replace(datos$Eliminación,"semifinal","semis")
table(datos$Eliminación)
```

```{r}
summary(datos)
```
Procedemos a filtrar la cantidad mínima de los na que se tienen en la base de datos para minimizar el sesgo en cuanto al análisis de las variables.

```{r}
datos<-drop_na(datos)
datos
```
Verificamos el tipo de dato que se tiene en cada una de las columnas respetando el análisis de variables que se desea realizar
```{r}
str(datos)
```
A continuación procedemos a modificar el tipo de dato de las variables teniendo en cuenta la naturaleza de cada una.
```{r}
datos$Año<-as.integer(datos$Año)
datos$Goles<-as.integer(datos$Goles)
datos$Rojas<-as.integer(datos$Rojas)
datos$Amarillas<-as.integer(datos$Amarillas)
datos$Partidos<-as.integer(datos$Partidos)
datos$`ocaciones claras falladas`<-as.integer(datos$`ocaciones claras falladas`)
datos$`ocaciones claras`<-as.integer(datos$`ocaciones claras`)
glimpse(datos)
```
Posterior a todas las correcciones verificamos si todavía contamos con algún na en la base de datos. Al finalizar esta ultima operación se procede a guardar la base de datos limpia usando la función *write_csv*, con la cual, se trabajara en la parte de los descriptores gráficos.
```{r}
sum(is.na(datos))
write_csv(datos,"DatosLimpios.csv")
```

## Analisis descriptivo

```{r}
# Llamamos la base de datos limpia
datos2<-read_csv("DatosLimpios.csv",show_col_types = FALSE)
datos2
```


### Primer gráfico 

HACIENDO REFERENCIA AL OBJETIVO 2: Analizar el rendimiento de los equipos sudamericanos en términos de número de ocasiones claras de gol y ocasiones claras de gol falladas, así como también la cantidad de goles anotados.

```{r}
plot(datos2$`ocaciones claras`, datos2$`ocaciones claras falladas`,
     xlab = "Numero de ocaciones claras",
     ylab = "Numero ocaciones claras falladas",
     main = "Rendimiento de los equipos sudamericanos")
abline(a = 0, b = 0.577, col = "red")
```
**ANALISIS DESCRIPTIVO:**

Línea Vertical: Número de ocasiones Claras Falladas
Línea Horizontal:Número de ocasiones Claras
Línea Diagonal: Representa el Rendimiento 
Punto en el gráfico: Representa a cada equipo

Diagonal: Representa la línea de equipos que  generan y convierten la misma cantidad de oportunidades claras de gol.

Puntos sobre la diagonal: Representa a  equipos que generan más oportunidades claras de gol, lo que indica un bajo rendimiento en términos de eficacia de definición.

Puntos debajo de la diagonal: Representa a  equipos que convierten más oportunidades claras de gol de las que generan; alto rendimiento en términos de definición.


Puntos en zona superior derecha del gráfico: Representa a equipos  que generan más ocasiones claras de gol, pero han fallado muchas de ellas; Indica bajo rendimiento en términos de definición.

Puntos en zona  inferior izquierda del gráfico: Representa a equipos que generan pocas ocasiones claras de gol y fallas muchas de ellas; indica bajo rendimiento.

Conclusión: El rendimiento de los equipos en términos de ocasiones claras de gol y ocasiones claras falladas será de manera inverso, es decir cuando un equipo tenga mayor ocasiones claras; tendrá menor cantidad de ocasiones claras falladas.

```{r}
lm(datos2$`ocaciones claras`~datos2$`ocaciones claras falladas`,data=datos2)
```
Formulando la ecuación  de Regresión para el diagrama de dispersión:

$$B_0=0.239$$
$$B_1=1.611$$
Ecuación de regresión
$$y=0.239+1.611x$$

### Segundo gráfico
HACIENDO REFERENCIA AL OBJETIVO 2: Analizar el rendimiento de los equipos sudamericanos en términos de número de ocasiones claras de gol y ocasiones claras de gol falladas, así como también la cantidad de goles anotados.


```{r}
plot(datos2$`ocaciones claras`, datos2$Goles,
     xlab = "Numero de ocaciones claras",
     ylab = "Cantidad de Goles Anotados",
     main = "Rendimiento de los equipos sudamericanos")
abline(a = 0, b = 0.577, col = "red")
```

**ANALISIS DESCRIPTIVO:**

Línea Vertical: Número de ocasiones Claras Falladas
Línea Horizontal:Número de ocasiones Claras
Línea Diagonal: Representa el Rendimiento 
Punto en el gráfico: Representa a cada equipo


Equipo con gran cantidad de ocasiones claras de gol y alta cantidad de goles anotados: alto rendimiento; Mayor eficacia en generar goles y definición.

Equipo con gran cantidad de ocasiones claras de gol, pero menor cantidad de goles anotados: Bajo rendimiento, indicativo de problemas en definición.

Equipo con baja cantidad de ocasiones claras de gol pero alta cantidad de goles anotados: Alto rendimiento en aprovechar las ocasiones, con indicativo negativo en generar situaciones de gol.

Equipo con baja cantidades de ocasiones claras y baja cantidad de goles anotados: Bajo nivel de Rendimiento; menor eficaz en generar goles y definición

Conclusión: En general el rendimiento de un equipo se dará conforme se va alejando del cero de manera diagonal; es decir lo equipos que están cerca al cero de manera diagonal tienen menor rendimiento que los equipos que están al otro extremo diagonal del gráfico.

```{r}
lm(datos2$`ocaciones claras`~datos2$Goles,data=datos2)
```
Formulando la ecuación  de Regresión para el diagrama de dispersión:
$$B_0=1.84$$
$$B_1=1.18$$
Ecuación de regresión
$$y=1.84+1.18x$$

### Tercer y cuarto gráfico

HACIENDO REFERENCIA AL OBJETIVO 3. Identificar el país con los equipos más exitosos en la Copa Sudamericana durante los últimos 5 años en relación a la etapa en la que fueron eliminados.


- Cargamos el archivo de la base de datos y filtramos el año, país y eliminación, de las muestras para manipularlos
```{r, echo=FALSE} 
daton <- read.csv("DatosLimpios.csv")
daton
da<-filter(daton,Eliminación != "previa" )
```


- Modificamos algunos valores de País para que sea fácil su lectura, posteriormente establecemos el orden de nuestros valores a la hora de mostrar las gráficas
```{r}
daton$Pais<-str_replace(daton$Pais,"Perú","Pe")
daton$Pais<-str_replace(daton$Pais,"Bolivia","Bo")
daton$Pais<-str_replace(daton$Pais,"Argentina","Ar")
daton$Pais<-str_replace(daton$Pais,"Chile","Ch")
daton$Pais<-str_replace(daton$Pais,"Uruguay","Uy")
daton$Pais<-str_replace(daton$Pais,"Paraguay","Py")
daton$Pais<-str_replace(daton$Pais,"Brasil","Br")
daton$Pais<-str_replace(daton$Pais,"Ecuador","Ec")
daton$Pais<-str_replace(daton$Pais,"Colombia","Co")
daton$Pais<-str_replace(daton$Pais,"Venezuela","Ve")

```


```{r}
daton$Eliminación<-str_replace(daton$Eliminación,"campeon","final")
daton$Eliminación<-factor(daton$Eliminación, levels = c("final", "semis", "cuartos", "octavos"))
daton$Pais<-factor(daton$Pais, levels = c("Br", "Ar","Co","Ec","Uy","Ve","Py","Pe","Bo"))
da<-filter(daton,Eliminación != "previa" )

datos<-select(da,Año,Pais,Eliminación)
datos
```



- Vamos a establecer primero la cantidad de equipos participantes de en los ultimos 5 años de cada pais

```{r}
barplot(table(datos$Pais), col = c("green", "skyblue","yellow","purple","blue","brown","pink","orange","red","lightgreen"), main = "Cantidad de equipos participantes",cex.axis = 0.8, cex.names = 0.7)

```
- Luego estableceremos un mosaico de hasta que posciciones llegaron los equipos de cada pais en los 5 años:


**Copa Sudamericana 2018 - 2022**
```{r}
mosaicplot(table(da$Pais,da$Eliminación), col = c("yellow", "skyblue","orange","purple",""),cex.axis = 0.6,main="Tabla de equipos vs eliminacion")
```
**ANÁLISIS DESCRIPTIVO:**

En cuanto a la primera gráfica de cantidad de equipos participantes de cada país a partir de octavos de final en los últimos 5 años, podemos ver que los países que tienen más equipos en las competiciones son Argentina y Brasil, por el otro lado el país que tiene menos cupos es Bolivia, ahora veremos si la cantidad de cupos afecta al desempeño de los equipos de los países.

El índice de dificultad ósea de mayor mérito es esta: final>semis>cuartos>octavos
En la siguiente gráfica se muestra el porcentaje de instancias alcanzadas en cada país, además de que la anchura de la columna representa la cantidad de equipos participantes.
Para el análisis, en teoría mientras más equipos haya en un país, el porcentaje de las instancias más altas debe ser estar mejor distribuidas.

Como se ven en la gráfica la afirmación se cumple en casi todos los equipos, a excepción de Ecuador, pero la relación respecto a los otros países si se cumple.

Podemos decir que la cantidad de equipos guarda una gran relación con la cantidad de instancias llegadas en cada país.

### Quinta gráfica 

HACIENDO REFERENCIA AL OBJETIVO 4. Identificar a los países que tuvieron a los equipos que mostraron un mejor desempeño en cuanto a la precisión de goles en relación a la cantidad de equipos jugados.


Creamos un nuevo data frame con las variables que vamos a usar para dar seguimiento al objetivo 4
```{r}
datofinal<-data.frame(Pais=datos2$Pais,cantidad_partidos=datos2$Partidos,Prescicion_goles=datos2$Prescicion_goles)
datofinal
```
Haciendo uso de la nueva base de datos construimos nuestro gráfico de barras
```{r}
ggplot(datofinal,aes(x=Pais,y=cantidad_partidos,fill=Prescicion_goles),xlabel=)+geom_col(position="dodge")+ggtitle("Cantidad de partidos y Prescición de goles durante los ltimos 5 años") + theme(plot.title = element_text(hjust = 0.5)) +ylab("Cantidad de partidos")+labs(fill="Prescición de goles")+theme(axis.text = element_text(angle = 90))
```
**ANÁLISIS DESCRIPTIVO:**

En el presente gráfico podemos observar la cantidad de partidos jugados por los equipos pertenecientes a cada uno de los países que conforman la copa sudamericana. En suma, en cada uno de los países podemos ver la precisión de goles que tuvo un país, sin tener en cuenta la cantidad total de equipos, en relación la cantidad de partidos jugados. De esta manera, mostrando la cantidad de paridos en donde se tuvo una precisión de goles buena, media y mala. Ademas, con este gráfico es posible observar cual de estos países posee mejor rendimiento en sus equipos en cuanto a la precisión de goles. En este caso el país que tendría una mejor precisión de goles en relación a los partidos jugados seria Brasil, ya que posee mayor frecuencia en la barra rosada que todos los demás países. Por otra parte, el país que tiene equipos con la peor precisión de goles vendría a ser entre Colombia y Venezuela, puesto que poseen la menor frecuencia en la barra rosada.No obstante si hacemos un análisis general podemos observar que en ninguno de los países la barra que hace referencia a una precisión mala es mas grande que que la barra de precisión buena, por lo que se tendría un rendimiento adecuado para todos los equipos de cada país. Añadido a eso aquellos países en donde la barra verde no este al nivel de las barras azules tendrán una mejor precisión de goles en relación a los países en donde la barra verde sea mas grade que la azul.


## Referencia de la base de datos para el proyecto
Sofascore. (s.f.). Torneo de Fútbol Sudamericana - América del Sur - Sofascore. Sofascore. Recuperado de https://www.sofascore.com/es/torneo/futbol/south-america/conmebol-sudamericana/480


