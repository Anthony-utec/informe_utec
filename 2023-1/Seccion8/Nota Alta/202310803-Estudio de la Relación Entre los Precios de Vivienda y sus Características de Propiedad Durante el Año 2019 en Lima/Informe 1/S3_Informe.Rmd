---
title: "Estudio de la Relación Entre los Precios de Vivienda y sus Características de Propiedad Durante el Año 2019 en Lima"
output: 
  html_document:
    toc: true
    toc_depth: 5
    toc_float:
      collapsed: false
      smooth_scroll: true
date: "2023-06-05"
---

   
```{r}
# Verificar si las librerías están instaladas y, en caso contrario, instalarlas
required_packages <- c("ggplot2", "dplyr", "readr","plotrix",'graphics')  # Lista de librerías requeridas
missing_packages <- setdiff(required_packages, installed.packages()[,"Package"])
if (length(missing_packages) > 0) {
  install.packages(missing_packages, dependencies = TRUE)
}
# Cargar las librerías
library(graphics)
library(readr)
library(dplyr)
library(ggplot2)
library(plotrix)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Cargar el archivo CSV
urbania_data <- read_csv("urbania_data.csv")
# Visualizar los primeros registros de los datos
head(urbania_data)
```


## 1. **INTRODUCCIÓN** 

#### 1.1. **RELEVANCIA:**

El estudio de la relación entre los precios de vivienda y sus características en Lima durante el año 2019 es de gran importancia para el mercado inmobiliario y la toma de decisiones. Comprender cómo diferentes atributos afectan el valor de una vivienda proporciona información valiosa para evaluar su precio y desarrollar estrategias de inversión. Este estudio permite identificar tendencias y patrones, así como entender cómo factores como ubicación, tamaño, antigüedad y servicios influyen en los precios. Estos conocimientos son fundamentales para políticas públicas, planificación urbana y decisiones financieras en bienes raíces.

#### 1.2. **OBJETIVO:**

Analizar la relación entre los precios de vivienda y sus características de propiedad durante el año 2019 en Lima, con el fin de comprender los factores que influyen en la valoración de las propiedades en el mercado inmobiliario de la ciudad.

#### 1.2.1. **OBJETIVOS ESPECÍFICOS:**

- Identificar las principales características de propiedad que están asociadas con precios más altos de vivienda en Lima durante el año 2019.

- Evaluar la influencia de variables como el área total, la antigüedad, el número de dormitorios y baños, y la presencia de características especiales (piscina, amoblado, cocheras, etc.) en los precios de las viviendas.

- Analizar la variación de los precios de vivienda entre diferentes distritos de Lima durante el año 2019 y determinar si existen factores geográficos, como la ubicación o la proximidad a servicios, que expliquen estas diferencias.

- Comparar los precios y características de las propiedades residenciales y comerciales en Lima durante el año 2019, con el objetivo de identificar posibles diferencias en la valoración y determinar si el uso comercial agrega valor a las propiedades.

- Investigar la relación entre los precios de vivienda y el estado de la propiedad, como su estado de conservación o mantenimiento, y determinar si existe una relación significativa entre estos factores.

## 2. **MODO DE ORGANIZACIÓN**
```{r}
datos <- data.frame(
  Tarea = c("Selección de temas", "Definición de tema", "Recolección de data", "Análisis para P1", "Presentación P1", "Análisis del Feedback"),
  Inicio = seq(as.Date("2023-04-20"), as.Date("2023-06-04"), length.out = 6),
  Fin = seq(as.Date("2023-04-20"), as.Date("2023-06-04"), length.out = 6) + 1
)

ggplot(datos, aes(y = Inicio, yend = Fin, x = Tarea, xend = Tarea)) +
  geom_segment(size = 10, color = "#0072B2") +
  labs(y = "Fecha", x = "") +
  ggtitle("ORGANIZACIÓN DURANTE EL DESARROLLO DEL PROYECTO") +
  scale_color_manual(values = c("#0072B2", "#004488", "#A6CEE3")) +  theme(plot.title = element_text(hjust = 0.5))+
coord_flip()
```

## 3. **DATOS**

#### 3.1. **RECOLECCIÓN DE DATOS:**

Los datos utilizados en este estudio fueron extraídos de una base de datos obtenida de la página Urbania.com, correspondiente al año 2019 en Lima, Perú. Esta base de datos ofrece información detallada sobre los precios de vivienda y diversas características de propiedad. Para acceder a la fuente original de los datos, se puede seguir el enlace proporcionado en Kaggle (https://www.kaggle.com/datasets/pbenavides/house-pricing-lima-peru?resource=download).

#### 3.2. **POBLACIÓN:**

El estudio se centra en todas las viviendas de Lima, especialmente en Lima Metropolitana, el principal centro urbano y económico del país. Esto proporciona una visión completa de los precios de vivienda y sus características en un entorno urbano y dinámico. Lima abarca una amplia y diversa área geográfica con diversos precios y atributos de propiedad, y cuenta con numerosas transacciones inmobiliarias y opciones de vivienda.

#### 3.3. **MUESTRA:**

La base de datos utilizada en este estudio proviene de las viviendas publicadas en la página Urbania.com. La base de datos consta de 7663 filas y 91 columnas, lo que proporciona una gran cantidad de información para analizar. Sin embargo, es importante tener en cuenta que la base de datos puede contener valores nulos, por lo que será necesario realizar una limpieza de datos antes de llevar a cabo el análisis. Esto asegurará que los resultados obtenidos sean confiables y precisos.

#### 3.4. **MUESTREO:**


Para llevar a cabo el muestreo de nuestro estudio, se utilizó un instrumento de recolección basado en un código de Python. Este código fue diseñado de manera que pudiera aprovechar métodos avanzados como Machine Learning, Web-Scraping y Programación Orientada a Objetos (POO) para cumplir con su función de manera eficiente y precisa. Los detalles técnicos y una descripción exhaustiva del código utilizado se encuentran disponibles en el siguiente enlace:(https://github.com/PBenavides/Automated-Valuation-Model-Lima)

#### 3.5. **VARIABLES:**

| Variable            | Tipo            | Descripción   |
|---------------------|-----------------|--------------|
| Precio              | Numérica/Continua|      Precio en soles        |
| Dormitorios         | Categórica/Ordinal|       Cantidad de dormitorios       |
| Antigüedad          | Numérica/Continua|         Años de antigüedad    |
| Luminosidad         | Categórica/Nominal|       Que tan luminoso es       |
| Tipo                | Categórica/Nominal|        Tipo de inmueble   |
| Área_total_m2       | Numérica/Continua|       Área total       |
| Área_constr_m2      | Numérica/Continua|        Área total construida      |
| NroBanios           | Numérica/Continua|       Cantidad de baños       |
| Estado de Inmueble  | Categórica/Nominal|        Estado de cuidado en que se encuentra el inmueble      |
| Distrito            | Categórica/Nominal|       Distrito de Lima en que se ubica       |
| Cocheras            | Numérica/Discreta|        Cantidad de cocheras      |
| Uso_profesional     | Categórica/Nominal|      ¿Se le puede dar un uso tipo profesional?        |
| Uso_comercial       | Categórica/Nominal|       ¿Se le puede dar un uso tipo comercial?       |
| Nro_pisos           | Numérica/Discreta|       Cantidad de pisos       |
| Piscina             | Categórica/Nominal|       Cantidad de piscinas       |
| Amoblado            | Categórica/Nominal|        ¿Se encuentra amoblado?      |	


#### 3.6. **LIMPIEZA DE DATOS:**

```{r}
# Eliminar filas que no tienen "Lima" en la columna "Provincia"
urbania_data <- urbania_data %>% filter(Provincia == "Lima")
#Seleccionamos solo las variables que vamos a usar
columnas_usar = c("Precio", "Dormitorios", "Antiguedad", "Luminosidad", "Tipo", "Area_total_m2",'Area_constr_m2', "NroBanios", "Dormitorios", "Estado de Inmueble", "Distrito",'Cocheras','Uso_profesional','Uso_comercial','Nro_pisos','Piscina','Amoblado')
urbania_data <- urbania_data %>% select(all_of(columnas_usar))
# Eliminar filas con valores faltantes
urbania_data <- na.omit(urbania_data)
str(urbania_data)
# Clasificación correcta de variables según su tipo
# Lista de columnas numéricas
urbania_data <- urbania_data %>% 
  mutate(Luminosidad = factor(Luminosidad, levels = c("Muy luminoso", "Luminoso", "NoEspecifica")),
`Estado de Inmueble` = factor(`Estado de Inmueble`, levels = c("Excelente", "Muy bueno", "Bueno", "Remodelado", "A Remodelar", "NoEspecifica")))
# Eliminar valores atípicos en la columna "price"
urbania_data <- urbania_data[urbania_data$Area_total_m2 <= 5000, ] 

Q1 <- quantile(urbania_data$Precio, 0.25)
Q3 <- quantile(urbania_data$Precio, 0.75)
Q1_area <- quantile(urbania_data$Area_total_m2, 0.25)
Q3_area <- quantile(urbania_data$Area_total_m2, 0.75)

IQR_area <- Q3_area - Q1_area
IQR <- Q3 - Q1

lower_limit <- Q1 - 1.5 * IQR
upper_limit <- Q3 + 1.5 * IQR
lower_limit_area <- Q1_area - 1.5 * IQR_area
upper_limit_area <- Q3_area + 1.5 * IQR_area

urbania_data <- urbania_data[urbania_data$Precio >= lower_limit & urbania_data$Precio <= upper_limit, ]
urbania_data <- urbania_data[urbania_data$Area_total_m2 >= lower_limit_area & urbania_data$Area_total_m2 <= upper_limit_area, ]
# Convertimos al precio en miles
urbania_data$Precio <- (urbania_data$Precio/10000)
# Guardar los datos limpios en un nuevo archivo CSV
write_csv(urbania_data, "urbania_data_clean.csv")
```


## 4. **ANÁLISIS DESCRIPTIVO**
### 4.1. **ANÁLISIS GENERAL:**

```{r}
# Diagrama de dispersión AREA TOTAL Y PRECIO
ggplot(urbania_data, aes(x = Area_total_m2, y = Precio)) +
  geom_point(color = "#5399E6") +
  geom_smooth(method = "lm", se = FALSE, color = "#2144A4") +
  labs(title = "Relación Entre Área Total y Precio", x = "Área Total (m^2)", y = "Precio (miles)") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_color_manual(values = c("#5399E6", "#2144A4"))
```
```{r}
cor(urbania_data$Area_total_m2, urbania_data$Precio)
```
- Un coeficiente de correlación de 0.7137099 indica una correlación positiva moderadamente fuerte entre el área total y el precio. A medida que aumenta el área total de una propiedad, es probable que su precio también aumente, pero no necesariamente de manera proporcional o lineal. La correlación de 0.71 indica que hay una tendencia general de crecimiento en el precio a medida que aumenta el área total, pero otros factores también pueden influir en el precio de manera independiente.
```{r}
# Filtrar los datos eliminando los valores atípicos
filtered_data <- urbania_data %>%
  filter(Area_constr_m2 >= lower_limit & Area_constr_m2 <= upper_limit & Area_constr_m2 <= Area_total_m2)
# Generar el diagrama de dispersión con los datos filtrados
ggplot(filtered_data, aes(x = Area_total_m2, y = Area_constr_m2)) +
  geom_point(color = "#5399E6") +
  geom_smooth(method = "lm", se = FALSE, color = "#2144A4") +
  labs(title = "Relación Entre Área Total y Área Construida (Sin Valores Atípicos)", 
       x = "Área Total (m^2)", y = "Área Construida (m^2)") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_color_manual(values = c("#5399E6", "#2144A4"))
```
```{r}
# Filtrar los datos eliminando los valores atípicos
filtered_data <- urbania_data %>%
  filter(Area_constr_m2 <= Area_total_m2)
# Calcular la correlación entre el área total y el área construida
cor(filtered_data$Area_total_m2, filtered_data$Area_constr_m2)
```

- En el análisis, se realizó una modificación para asegurar que el área construida no sea mayor que el área total, eliminando datos atípicos. Se encontró una correlación positiva moderada de 0.7125446 entre el área construida y el área total, lo que sugiere que hay una relación positiva entre ambas variables. A medida que aumenta el área total de una propiedad, es probable que también aumente el área construida, y viceversa. Sin embargo, es importante destacar que esta correlación no implica una relación lineal perfecta ni establece una relación causal entre las variables.
```{r}
#Histograma AREA TOTAL
ggplot(urbania_data, aes(x = Area_total_m2)) +
  geom_histogram(aes(y = ..density..),binwidth = 100, fill = "#4378D0" , color = "white") +
  geom_density(color = "red") +
  labs(title = "Distribución de Área Total (m^2)", x = "Área Total (m^2)", y = "Densidad") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text = element_text(size = 10),
        panel.background = element_rect(fill = "white"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank())
```
```{r}
# Cálculo de la media
media_area <- round(mean(urbania_data$Area_total_m2), 2)
# Cálculo de la desviación estándar
desviacion_area <- round(sd(urbania_data$Area_total_m2), 2)
# Valor mínimo y máximo
minimo_area <- min(urbania_data$Area_total_m2)
maximo_area <- max(urbania_data$Area_total_m2)
# Imprimir los resultados
media_area
desviacion_area
minimo_area
maximo_area
```
- El histograma muestra la distribución del atributo "Área Total (m^2)" en el conjunto de datos. La forma de la distribución es asimétrica positiva, con la mayoría de las propiedades concentradas en áreas pequeñas y unas pocas propiedades con áreas muy grandes. Esto indica que hay una considerable variabilidad en las áreas de las propiedades. La media de 428.36 metros cuadrados y la desviación estándar de 323.19 confirman esta interpretación, mostrando la dispersión alrededor de la media. 
```{r}
#Histograma PRECIO
ggplot(urbania_data, aes(x = Precio)) +
  geom_histogram(aes(y = ..density..),binwidth = 10, fill = "#5399E6" , color = "white") +
  geom_density(color = "red") +
  labs(title = "Distribución de Precios", x = "Precio(miles)", y = "Frecuencia") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text = element_text(size = 10),
        panel.background = element_rect(fill = "white"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank())
```
```{r}
# Cálculo de la media del precio
mean(urbania_data$Precio)
# Cálculo de la desviación estándar del precio
sd(urbania_data$Precio)
# Valor mínimo y máximo del precio
min(urbania_data$Precio)
max(urbania_data$Precio)
```
- El histograma de precios representa la distribución de precios de las viviendas en el conjunto de datos. Los precios tienen una media de 66.53 miles de unidades monetarias y una desviación estándar de 44.84. La distribución es sesgada hacia la derecha, lo que indica que la mayoría de las viviendas tienen precios más bajos, mientras que hay algunas viviendas con precios más altos que se consideran valores atípicos. La forma de la distribución sugiere que existe una concentración de viviendas con precios más bajos y una dispersión gradual hacia precios más altos. Esto puede ser útil para comprender la estructura de precios en el mercado inmobiliario y tomar decisiones informadas sobre la compra o venta de viviendas.
```{r}
#Gráfico de barras PRECIO-TIPO
totalP <- urbania_data %>% group_by(Tipo) %>% 
  summarise(PT = mean(Precio)) 
ggplot(totalP, aes(x = Tipo, y = PT, fill = Tipo)) +
  geom_bar(stat = "identity") +
  labs(title = "Precio Total por Tipos de Vivienda", x = "Tipo", y = "Precio Total") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_fill_manual(values = c("#5399E6", "#4378D0", "#3256BA", "#2144A4", "#10328E", "#002076", "#001064"))

```
```{r}
totalP
```

- En este histograma, podemos observar el precio promedio que tienen cierto tipos de vivienda, versus el tipo de cada una, podemos notar que el tipo "Casa" y "Casas en condominio", suelen ser las más caras, con promedios de 71.11 y 71.32 miles de soles, respectivamente. Esto puede estar influenciado por el tamaño, ubicación y exclusividad que pueden llegar a tener.

```{r}
#Gráfico de barras DORMITORIOS-PRECIO
NDor <- urbania_data %>%
  group_by(Dormitorios) %>% 
  summarise(PRECIO= mean(Precio))
# Crear la paleta de colores azules
colors <- colorRampPalette(c("lightblue", "darkblue"))(length(levels(factor(NDor$Dormitorios))))
# Crear el gráfico de barras en tonos azules
ggplot(NDor, aes(x = factor(Dormitorios), y = PRECIO, fill = factor(Dormitorios))) +
  geom_bar(stat = "identity") +
  labs(title = "Promedio Promedio Según el Número de Dormitorios", x = "Número de Dormitorios", y = "Precio(miles)") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_fill_manual(values = colors)
```
```{r}
# Cálculo de la variabilidad de precios dentro de cada grupo de dormitorios
# Agrupar los datos por dormitorios y calcular las medidas de dispersión
variability <- urbania_data %>%
  group_by(Dormitorios) %>%
  summarise(
    Rango = max(Precio) - min(Precio),
    Desviacion_estandar = sd(Precio),
    Coeficiente_variacion = sd(Precio) / mean(Precio) * 100
  )
# Mostrar los resultados
variability
```
- El gráfico de barras y los resultados del análisis de variabilidad nos muestran que los precios de las propiedades varían dentro de cada grupo de dormitorios. Los grupos de mayor número de dormitorios tienden a tener una mayor dispersión de precios, mientras que los grupos de menor número de dormitorios muestran una mayor variabilidad en relación con la media. Estos resultados resaltan la importancia de considerar el número de dormitorios al analizar y comparar los precios de las propiedades.
```{r}
#Gráfico de barras agrupadas LUMINOSISDAD-TIPO
# Obtener los niveles únicos de Tipo en urbania_dataf
urbania_dataf <- urbania_data %>%
  count(Luminosidad, Tipo, name = "Frecuencia")
unique_tipos <- unique(urbania_dataf$Tipo)
# Crear la paleta de colores con la longitud adecuada
colors <- colorRampPalette(c("darkblue", "lightblue"))(length(unique_tipos))
# Crear el gráfico de barras agrupadas sin el sector "NoEspecifica"
ggplot(urbania_dataf, aes(x = Luminosidad, y = Frecuencia, fill = Tipo)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Relación Entre Luminosidad y Tipo", x = "Luminosidad", y = "Frecuencia") +
  scale_fill_manual(values = setNames(colors, unique_tipos)) +
  theme(plot.title = element_text(hjust = 0.5))
```
```{r}
urbania_dataf
```
- La luminosidad parece tener una influencia en la distribución de los diferentes tipos de propiedad. El nivel de luminosidad "Muy luminoso" muestra una mayor variabilidad en las frecuencias, mientras que el nivel de luminosidad "Luminoso" muestra una variabilidad algo menor. Estos datos nos proporcionan información sobre las características comunes y la variabilidad asociada con cada nivel de luminosidad en relación con los diferentes tipos de propiedad.


```{r}
colors <- colorRampPalette(c("lightblue", "darkblue"))(length(unique(urbania_data$`Estado de Inmueble`)))

# Crear el histograma en tonos azules
ggplot(data = urbania_data, aes(x = `Estado de Inmueble`, fill = `Estado de Inmueble`)) +
  geom_bar() +
  labs(title = "Estado de Inmueble", x = "Estado de Inmueble", y = "Frecuencia") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_fill_manual(values = colors)
```
```{r}
summary(urbania_data$`Estado de Inmueble`)
```
- El gráfico muestra la distribución de los estados de los inmuebles mencionados por las personas. Se observa que muchas personas optaron por no mencionar el estado de su inmueble, lo que podría indicar falta de información o preferencia por no revelar esta información. Entre aquellos que sí mencionaron el estado, la categoría más frecuente es "Muy bueno". Sin embargo, debemos ser cautelosos al interpretar estos resultados, ya que podría existir un sesgo debido a que las personas tienden a calificar positivamente sus propiedades. Es importante considerar que el estado real de los inmuebles puede variar y que se requiere una evaluación más detallada y objetiva para obtener una comprensión precisa de los estados de los inmuebles en cuestión.

```{r}
#gráfico de burbujas AREA TOTAL- PRECIO - NUMERO DE PISOS - ANTIGUEDAD
# Crear el gráfico de burbujas en diferentes tonos de azul
ggplot(data = urbania_data, aes(x = Area_total_m2, y = Precio, size = Antiguedad, color = Nro_pisos)) +
  geom_point(alpha = 0.7) +
  scale_size_continuous(range = c(1, 10)) +
  scale_color_gradient(low = "lightblue", high = "darkblue") +
  labs(title = "Relación entre Área Total, Precio, Nro de Pisos y Antigüedad", x = "Área Total (m^2)", y = "Precio(miles)", size = "Antigüedad") +
  theme(plot.title = element_text(hjust = 0.5))
```
```{r}
# Cálculo de la media del área total
mean_area_total <- round(mean(urbania_data$Area_total_m2), 2)
print(paste("Media del área total:", mean_area_total))

# Cálculo de la desviación estándar del área total
sd_area_total <- round(sd(urbania_data$Area_total_m2), 2)
print(paste("Desviación estándar del área total:", sd_area_total))

# Valor mínimo y máximo del área total
min_area_total <- round(min(urbania_data$Area_total_m2), 2)
max_area_total <- round(max(urbania_data$Area_total_m2), 2)
print(paste("Valor mínimo del área total:", min_area_total))
print(paste("Valor máximo del área total:", max_area_total))

# Cálculo de la media del precio
mean_precio <- round(mean(urbania_data$Precio), 2)
print(paste("Media del precio:", mean_precio))

# Cálculo de la desviación estándar del precio
sd_precio <- round(sd(urbania_data$Precio), 2)
print(paste("Desviación estándar del precio:", sd_precio))

# Valor mínimo y máximo del precio
min_precio <- round(min(urbania_data$Precio), 2)
max_precio <- round(max(urbania_data$Precio), 2)
print(paste("Valor mínimo del precio:", min_precio))
print(paste("Valor máximo del precio:", max_precio))

# Frecuencia de cada número de pisos
freq_nro_pisos <- table(urbania_data$Nro_pisos)
print("Frecuencia de cada número de pisos:")
print(freq_nro_pisos)

# Cálculo de la media de la antigüedad
mean_antiguedad <- round(mean(urbania_data$Antiguedad), 2)
print(paste("Media de la antigüedad:", mean_antiguedad))

# Cálculo de la desviación estándar de la antigüedad
sd_antiguedad <- round(sd(urbania_data$Antiguedad), 2)
print(paste("Desviación estándar de la antigüedad:", sd_antiguedad))

# Valor mínimo y máximo de la antigüedad
min_antiguedad <- round(min(urbania_data$Antiguedad), 2)
max_antiguedad <- round(max(urbania_data$Antiguedad), 2)
print(paste("Valor mínimo de la antigüedad:", min_antiguedad))
print(paste("Valor máximo de la antigüedad:", max_antiguedad))
```

- El gráfico de burbujas muestra la relación entre las características de las viviendas y su tamaño en metros cuadrados. Se observa que las viviendas más antiguas tienden a ser más amplias, mientras que las viviendas modernas son más pequeñas. La mayoría de las propiedades tienen un tamaño cercano al promedio de 428.36 metros cuadrados, con una dispersión de aproximadamente 323.19 metros cuadrados. El precio promedio de las propiedades es de alrededor de 66.53 miles de soles, con una dispersión de aproximadamente 44.84 unidades monetarias, lo que indica una variabilidad significativa en los precios. La mayoría de las propiedades tienen 1 o 2 pisos, aunque también hay una diversidad de propiedades con diferentes números de pisos, incluyendo 3, 4, 5, 6, 7 y 8 pisos, aunque en menor cantidad. En promedio, las propiedades tienen una antigüedad de aproximadamente 3.07 años, con una dispersión de aproximadamente 1.89 años, lo que sugiere que las propiedades en el mercado suelen ser relativamente nuevas.

```{r}
#Box plot indexado PRECIO-DORMITORIOS
ggplot(urbania_data) +
  geom_boxplot(aes(x = Dormitorios, y = Precio, fill = Dormitorios)) +
  labs(title = "Boxplot de Precio por Dormitorios", x = "Dormitorios", y = "Precio(miles)") +
  scale_fill_manual(values = c("#5399E6", "#4378D0", "#3256BA", "#2144A4", "#10328E", "#002076", "#001064")) +
  theme(plot.title = element_text(hjust = 0.5))
```
```{r}
# Estadísticas descriptivas para cada grupo de dormitorios
stats <- urbania_data %>%
  group_by(Dormitorios) %>%
  summarise(
    Mediana = median(Precio),
    Cuartil_1 = quantile(Precio, 0.25),
    Cuartil_3 = quantile(Precio, 0.75),
    Valor_Minimo = min(Precio),
    Valor_Maximo = max(Precio))
stats
```
- El precio de las viviendas tiende a aumentar a medida que aumenta el número de dormitorios. 
- Esto indica una relación positiva entre el número de dormitorios y el precio. Las viviendas con tres y cuatro dormitorios presentan una mayor dispersión de precios, como se evidencia por los cuartiles más alejados de la mediana y el mayor rango de precios.
- Las viviendas con uno o dos dormitorios muestran una menor dispersión de precios, con cuartiles más cercanos a la mediana y un rango de precios más estrecho. Existen valores atípicos en el grupo de viviendas con cuatro dormitorios, ya que se extienden más allá del tercer cuartil.
- En general, el número de dormitorios es un factor importante a considerar al determinar el precio de una vivienda. Cuantos más dormitorios tenga una propiedad, es más probable que su precio sea más alto y que haya una mayor variabilidad en los precios dentro de ese grupo.

### 4.2. **ANÁLISIS EN LIMA METROPOLITANA:**

```{r}
# Definir los distritos para cada sector y crear nueva variables SECTOR
lima_norte <- c("LosOlivos", "PuentePiedra", "Comas", "Independencia", "SanMartinDePorres", "Ancon", "SantaRosa", "Carabayllo")
lima_sur <- c("VillaElSalvador", "SanJuanDeMiraflores", "VillaMariaDelTriunfo", "Lurin", "Chorrillos", "Pachacamac", "PuntaNegra", "PuntaHermosa", "Pucusana", "SantaMariaDelMar", "SanBartolo")
lima_este <- c("LaMolina", "Ate", "SantaAnita", "SanJuanDeLurigancho", "Lurigancho", "ElAgustino", "Chaclacayo", "Cieneguilla")
lima_centro <- c("SantiagoDeSurco", "MagdalenaDelMar", "SanMiguel", "CercadoDeLima", "JesusMaria", "LaVictoria", "Rimac", "SanLuis", "SanBorja", "SanIsidro", "Lince", "PuebloLibre", "Miraflores", "Surquillo", "Barranco", "Brenia")
# Agregar la columna "Sector" al data frame
urbania_data$Sector <- ""
# Asignar los sectores a los distritos correspondientes
urbania_data$Sector[urbania_data$Distrito %in% lima_norte] <- "LIMA NORTE"
urbania_data$Sector[urbania_data$Distrito %in% lima_sur] <- "LIMA SUR Y BALNEARIOS"
urbania_data$Sector[urbania_data$Distrito %in% lima_este] <- "LIMA ESTE"
urbania_data$Sector[urbania_data$Distrito %in% lima_centro] <- "LIMA CENTRO"
# Asignar "OTROS" a los distritos no clasificados
urbania_data$Sector[urbania_data$Sector == ""] <- "OTROS"
```

```{r}
#box plot indexado PRECIO-SECTOR
# Obtener los niveles únicos en la variable "Sector"
sectores <- unique(na.omit(urbania_data$Sector))
# Definir los colores para cada sector
colores <- c("#5083fa", "#2062fa", "#2438d4", "#152582", "#b0b0b0")  # Asegúrate de tener un color para cada sector
ggplot(na.omit(urbania_data), aes(x = Sector, y = Precio, fill = Sector)) +
  geom_boxplot(color = "#3d3d3d") +
  labs(title = "Distribución de Precios Por Sector en Lima Metropolitana", x = "Sector", y = "Precio (miles)") +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5)) +
  scale_fill_manual(values = colores, breaks = sectores) +
  theme(plot.title = element_text(hjust = 0.5))
```
```{r}
# Calcular estadísticas descriptivas por sector
stats_por_sector <- urbania_data %>%
  group_by(Sector) %>%
  summarise(
    Media = mean(Precio),
    Mediana = median(Precio),
    Cuartil_1 = quantile(Precio, 0.25),
    Cuartil_3 = quantile(Precio, 0.75),
    Valor_Minimo = min(Precio),
    Valor_Maximo = max(Precio)
  )
stats_por_sector
```
- **LIMA CENTRO** presenta la mediana más alta, con un valor de 61 miles, seguido de LIMA ESTE con una mediana de 69.5 miles. Estos sectores muestran una mayor concentración de precios elevados en comparación con los demás.
- **LIMA NORTE** tiene la mediana más baja, con 16.5 miles, lo que indica que los precios en esta zona tienden a ser más accesibles. Sin embargo, también se observa una menor variabilidad en los precios, con un rango intercuartílico más estrecho.
- **LIMA SUR Y BALNEARIOS y OTROS** sectores presentan medianas intermedias, indicando una distribución de precios más equilibrada. Sin embargo, LIMA SUR Y BALNEARIOS muestra una mayor dispersión, con un rango intercuartílico más amplio y valores máximos más altos.
- Estos resultados sugieren que los precios de las propiedades varían significativamente según el sector geográfico en Lima Metropolitana. Es importante considerar estos patrones al tomar decisiones de compra o inversión inmobiliaria, ya que cada sector ofrece diferentes características y rangos de precios.

```{r}
#Gráfico de barras PRECIO-SECTOR
#creando nuevo DF
grouped_data <- urbania_data %>%
  group_by(Sector) %>%
  summarise(Media_Precio = mean(Precio))
# Crear la paleta de colores azules
colors <- colorRampPalette(c("lightblue", "darkblue"))(length(unique(grouped_data$Sector)))
# Crear el gráfico de barras apiladas en tonos azules
ggplot(grouped_data, aes(x = Sector, y = Media_Precio, fill = Sector)) +
  geom_bar(stat = "identity") +
  labs(title = "Valores Medios de Precio Por Sector", x = "Sector", y = "Precio (miles)") +
  scale_fill_manual(values = setNames(colors, unique(grouped_data$Sector))) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) +
  theme(plot.title = element_text(hjust = 0.5))
```
```{r}
# Calcular la media del precio por sector
mean_price <- urbania_data %>%
  group_by(Sector) %>%
  summarise(Media_Precio = mean(Precio))
# Calcular la mediana del precio por sector
median_price <- urbania_data %>%
  group_by(Sector) %>%
  summarise(Mediana_Precio = median(Precio))
# Calcular el valor mínimo del precio por sector
min_price <- urbania_data %>%
  group_by(Sector) %>%
  summarise(Valor_Minimo = min(Precio))
# Calcular el valor máximo del precio por sector
max_price <- urbania_data %>%
  group_by(Sector) %>%
  summarise(Valor_Maximo = max(Precio))
mean_price
median_price
min_price
max_price
```
- En cuanto a la media de precios, se observa que los sectores de Lima Este y Lima Centro tienen los valores medios más altos, con 79.61 y 73.63 respectivamente. Por otro lado, Lima Norte presenta el valor medio más bajo con 18.03.
- La mediana de precios muestra una tendencia similar, donde los sectores de Lima Este y Lima Centro tienen las medianas más altas, con 69.5 y 61.0 respectivamente, mientras que Lima Norte tiene la mediana más baja con 16.5.
- En cuanto al valor mínimo de precios, Lima Norte muestra el valor mínimo más bajo con 3.10, seguido de Lima Centro, Lima Este, Lima Sur y Balnearios, y Otros.
- Por último, en cuanto al valor máximo de precios, todos los sectores tienen valores máximos similares, siendo 210 para Lima Centro, Lima Este y Otros, 90 para Lima Norte, y 193 para Lima Sur y Balnearios.
- Estos resultados nos dan una idea de la variabilidad de precios en cada sector, así como de las diferencias entre ellos.

```{r}
#Gráfico de barras agrupado ESTADO DE INMUEBLE-SECTOR
# Obtener los niveles únicos de Sector
urbania_dataf1 <- urbania_data %>%
  count(`Estado de Inmueble`, Sector, name = "Frecuencia")
urbania_dataf1 <- slice(urbania_dataf1, -c(31,32,33,34))
unique_tipos1 <- unique(urbania_dataf1$Sector)
# Crear la paleta de colores con la longitud adecuada
colors <- colorRampPalette(c("darkblue", "lightblue"))(length(unique_tipos1))
ggplot(urbania_dataf1, aes(x = `Estado de Inmueble`, y = Frecuencia, fill = Sector)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Relación Entre Luminosidad y Tipo", x = "Estado de Inmueble", y = "Frecuencia") +
  scale_fill_manual(values = setNames(colors, unique_tipos1)) +
  theme(plot.title = element_text(hjust = 0.5))
```
```{r}
urbania_dataf1
```
- Para la categoría **Excelente**, se observa que hay un número significativo de inmuebles en todos los sectores, con una mayor concentración en LIMA CENTRO y LIMA ESTE.
- La categoría "Muy bueno" también presenta una distribución similar en todos los sectores, con una mayor cantidad de inmuebles en LIMA ESTE.
- En la categoría **Bueno**, se observa una distribución más equitativa en los sectores, aunque LIMA CENTRO tiene la mayor cantidad de inmuebles en esta categoría.
- La categoría **Remodelado** muestra una cantidad moderada de inmuebles en todas las zonas, con LIMA CENTRO liderando en términos de frecuencia.
- La categoría **A Remodelar** tiene una cantidad relativamente baja de inmuebles en general, con LIMA CENTRO y LIMA ESTE mostrando los números más altos.

```{r}
#Mosaico USO PROFESIONAL - TIPO DE VIVIENDA - SECTOR
# Filtrar los datos para eliminar filas con valores NA
filtered_data <- na.omit(urbania_data)
# Generar una paleta de colores con suficientes valores para los sectores únicos
colors <- colorRampPalette(c("#5399E6", "#001064"))(length(unique(filtered_data$Sector)))
# Crear el gráfico de mosaico con la escala manual y datos filtrados
ggplot(filtered_data) +
  geom_tile(aes(x = Uso_profesional, y = Tipo, fill = Sector)) +
  labs(title = "Uso Profesional Según el Tipo de Vivienda", x = "Uso Profesional", y = "Tipo") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_fill_manual(values = colors, na.value = "white")
```
```{r}
frequenciesP <- table(urbania_data$Uso_profesional, urbania_data$Tipo, urbania_data$Sector)
frequenciesP
```
- En el sector **LIMA CENTRO**:
  - El uso profesional "No" se asocia principalmente con las categorías de vivienda "Casa" y "Departamento".
  - El uso profesional "Si" está presente en menor medida y se asocia principalmente con la categoría de vivienda "Casa en quinta".
- En el sector **LIMA ESTE**:
  - El uso profesional "No" es común en las categorías de vivienda "Casa" y "Casa en condominio".
  - El uso profesional "Si" también se encuentra, pero en menor proporción.
- En el sector **LIMA NORTE**:
  - La presencia de uso profesional es relativamente baja en este sector.
  - Las categorías de vivienda "Casa" y "Casa en condominio" son las más comunes.
- En el sector **LIMA SUR Y BALNEARIOS**:
  - Hay una presencia significativa de uso profesional en las categorías de vivienda "Casa" y "Casa de Playa".
  - Las categorías de vivienda "Casa en condominio" y "Casa de campo" también tienen cierta presencia.
```{r}
#Mosaico USO COMERCIAL - TIPO DE VIVIENDA - SECTOR
# Filtrar los datos para eliminar filas con valores NA
filtered_data <- na.omit(urbania_data)
# Generar una paleta de colores con suficientes valores para los sectores únicos
colors <- colorRampPalette(c("#5399E6", "#001064"))(length(unique(filtered_data$Sector)))
# Crear el gráfico de mosaico con la escala manual y datos filtrados
ggplot(filtered_data) +
  geom_tile(aes(x = Uso_comercial, y = Tipo, fill = Sector)) +
  labs(title = "Uso Comercial Según el Tipo de Vivienda", x = "Uso Comercial", y = "Tipo") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_fill_manual(values = colors, na.value = "white")
```
```{r}
frequenciesC <- table(urbania_data$Uso_comercial, urbania_data$Tipo, urbania_data$Sector)
frequenciesC
```
- En el sector **LIMA CENTRO**:
  - La presencia de uso comercial es notable en la categoría de vivienda "Casa".
  - La categoría de vivienda "Casa en condominio" también muestra cierta presencia de uso comercial.
  - Las categorías "Casa de campo" y "Casa en quinta" tienen una presencia mínima de uso comercial.
- En el sector **LIMA ESTE**:
  - El uso comercial se encuentra principalmente en las categorías de vivienda "Casa" y "Casa en condominio".
  - Las categorías "Casa de campo" y "Casa en quinta" tienen una presencia mínima de uso comercial.
- En el sector **LIMA NORTE**:
  - El uso comercial es menos común en este sector.
  - La categoría de vivienda "Casa" muestra una presencia significativa de uso comercial, mientras que las otras categorías tienen una presencia mínima o nula.
- En el sector **LIMA SUR Y BALNEARIOS**:
  - La categoría de vivienda "Casa" es la que tiene la presencia más destacada de uso comercial.
  - Las categorías "Casa de campo" y "Casa de Playa" también muestran cierta presencia de uso comercial, aunque en menor medida.
```{r}
#Mosaico AMOBLADO - SECTOR
urbania_data$Amoblado[urbania_data$Amoblado == "0"] <- "No"
urbania_data$Amoblado[urbania_data$Amoblado == "1"] <- "Sí"
color_palette <- colorRampPalette(c("lightblue", "darkblue"))(length(unique(urbania_data$Sector)))
mosaicplot(table(urbania_data$Amoblado, urbania_data$Sector)[-2, 1:4], las = 2, color = color_palette, main = "Amoblado vs Sector", xlab = "Amoblado", ylab = "Sector", border = "NA")
```
```{r}
# Filtrar los datos para eliminar filas con valores NA
filtered_data <- na.omit(urbania_data)
# Calcular los porcentajes de propiedades con y sin piscina en cada sector
amoblado_sector <- prop.table(table(filtered_data$Amoblado, filtered_data$Sector), margin = 2)
# Mostrar los porcentajes en forma de tabla
amoblado_sector
```
- **Lima Centro:** El 54.5% de las propiedades en Lima Centro no están amobladas, mientras que solo el 4.7% están amobladas. Esto indica que la mayoría de las propiedades en esta zona no se ofrecen con mobiliario.
- **Lima Este:** En Lima Este, el 62.5% de las propiedades no están amobladas, mientras que solo el 6.9% están amobladas. Al igual que en Lima Centro, la mayoría de las propiedades en esta zona no se ofrecen con mobiliario.
- **Lima Norte:** En Lima Norte, el 47.8% de las propiedades no están amobladas, mientras que solo el 3.8% están amobladas. Nuevamente, la mayoría de las propiedades en esta zona no se ofrecen con mobiliario.
- **Lima Sur y Balnearios:** En esta zona, el 46.4% de las propiedades no están amobladas, mientras que el 15.8% están amobladas. Existe una proporción significativa de propiedades amobladas en comparación con otras áreas.
```{r}
#Mosaico PISCINA - SECTOR
urbania_data$Piscina[urbania_data$Piscina == "0"] <- "No"
urbania_data$Piscina[urbania_data$Piscina == "1"] <- "Sí"
color_palette <- colorRampPalette(c("lightblue", "darkblue"))(length(unique(urbania_data$Sector)))
mosaicplot(table(urbania_data$Piscina,urbania_data$Sector)[-2,1:4], las = 2, color = color_palette, main="Piscina vs Sector", xlab="Piscina", ylab = "Sector", border = "NA")
```
```{r}
# Filtrar los datos para eliminar filas con valores NA
filtered_data <- na.omit(urbania_data)
# Calcular los porcentajes de propiedades con y sin piscina en cada sector
piscina_sector <- prop.table(table(filtered_data$Piscina, filtered_data$Sector), margin = 2)
# Mostrar los porcentajes en forma de tabla
piscina_sector
```
- **Lima Centro:** El 43.5% de las propiedades en Lima Centro no tienen piscina, mientras que el 11.3% sí tienen piscina. Esto sugiere que la presencia de piscinas en las propiedades de esta zona es relativamente baja en comparación con otras áreas.
- **Lima Este:** En Lima Este, el 29.6% de las propiedades no cuentan con piscina, mientras que un significativo 43.5% sí tienen piscina. Esto indica que en esta zona existe una mayor proporción de propiedades con piscina en comparación con otras áreas.
- **Lima Norte:** En Lima Norte, el 14.9% de las propiedades no tienen piscina, mientras que solo el 5.8% cuentan con piscina. Esto muestra que la presencia de piscinas en las propiedades de esta zona es bastante baja en comparación con otras áreas.
- **Lima Sur y Balnearios:** En esta zona, el 30.5% de las propiedades no tienen piscina, mientras que el 30.6% sí tienen piscina. Esto indica una distribución relativamente equilibrada en términos de la presencia de piscinas en las propiedades.

## 4. **CONCLUSIONES** 

Basado en el estudio realizado sobre la relación entre los precios de los inmuebles y sus características principales, se han obtenido las siguientes conclusiones:

- Existe una relación significativa entre la ubicación del inmueble y su precio. Los precios tienden a ser más altos en áreas consideradas como deseables o de alta demanda.

- Contrario a las expectativas, la antigüedad del inmueble no es un factor determinante en los precios. Otros aspectos, como la amplitud y los bienes incluidos dentro del inmueble, tienen una mayor influencia en la determinación del precio.

- Se ha identificado un sector específico en Lima con una mayor concentración de viviendas con precios elevados. Esta información permite comparar el valor relativo de las propiedades en esa área particular.

El estudio confirma que la ubicación del inmueble influye significativamente en su precio, mientras que la antigüedad no es un factor determinante. Además, se ha identificado un sector en Lima con una mayor concentración de viviendas de alto precio, lo que proporciona información relevante sobre la dinámica de precios en esa área específica.

