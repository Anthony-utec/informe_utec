---
title: "S8 Análisis de la factibilidad de una implementación de bus"
date: "2023-06-03"
output: 
  html_document:
    toc: true
    toc_float: true
    df_print: paged
    toc_depth: 4
    theme: yeti
    css: "style.css"
---

# Tema 

::: {#tema-container}
Análisis de la percepción del estudiante respecto a una propuesta de implementación de buses para el traslado de estudiantes de la Universidad de Ingeniería y Tecnología (UTEC) en el periodo 2023-1.
:::

------------------------------------------------------------------------

# Introducción

## Relevancia

En Lima, desde hace muchos años existe la congestión vehicular trayendo consigo problemas socioeconómicos. Por ello, en este estudio nos enfocaremos en analizar la viabilidad de implementar un sistema de trasporte para la universidad UTEC basado en la percepción de los mismos estudiantes. Considerando varios aspectos relacionados con la percepción en el gasto en pasaje, tiempo que emplean para trasladarse, el rendimiento académico de los estudiantes y las inasistencias a clases a causa del tipo de transporte que usa. Con este estudio queremos obtener datos relevantes que pueden servir como base para la toma de decisiones por parte de la universidad, como también brindar información a las autoridades para implementar nuevas normas que mejoren la calidad del sistema de transporte en Lima.

## Objetivos

### Generales

Analizar la percepción del estudiante sobre  la implementación del sistema de transporte para los estudiantes de la UTEC en el periodo 2023-1.

### Específicos

1.  Identificar si la implementación de un sistema de transporte por la UTEC disminuiría los gastos en pasaje de los estudiantes según el pasaje que estarían dispuestos a pagar por el servicio de transporte en el periodo 2023-1.

2.  Evaluar la relación del tiempo en transporte de los estudiantes de UTEC para llegar a la universidad con sus horas de sueño y su rendimiento académicoen el periodo 2023-1.

3.  Identificar si las faltas a clases debido al transporte afectan el rendimiento académico de los estudiantes (UTEC) en el periodo 2023-1.

4.  Identificar los medios de transporte más comunes utilizados por los estudiantes para llegar a la universidad y cómo estos afectan el tiempo que tardan en llegar a UTEC en el periodo 2023-1.

5.  Identificar los horarios donde la mayor cantidad de estudiantes salen de la universidad (UTEC), en el periodo 2023-1.


------------------------------------------------------------------------

## Variables

| Variable                                   | Tipo               |
|--------------------------------------------|--------------------|
| Edad                                       | Numérica Discreta  |
| Sexo                                       | Categórica Nominal |
| Ciclo                                      | Categórica Ordinal |
| Tiempo de viaje hasta UTEC                 | Numérica Discreta  |
| Gasto máximo en pasaje                     | Numérica Continua  |
| Gasto mínimo en pasaje                     | Numérica Continua  |
| Hora de salida de hogar más frecuente      | Numérica Discreta  |
| Hora de salida de UTEC más frecuente       | Numérica Discreta  |
| Distrito de residencia                     | Categórica Nominal |
| Medio de transporte                        | Categórica Nominal |
| Promedio ponderado del ciclo 2022-2        | Numérica Continua  |
| DF de sueño                             | Numérica Discreta  |
| Cantidad de faltas a clases por transporte | Categórica Nominal |
| Gasto máximo en transporte privado         | Numérica Continua  |
| Gasto mínimo en transporte privado         | Numérica Continua  |
| Pasaje mínimo dispuesto a pagar            | Numérica Continua  |
| Pasaje máximo dispuesto a pagar            | Numérica Continua  |


### Clasificación de variables

-   **Edad:** Medida en años. Variable numérica discreta que representa una característica de una persona cuya restricción es que no puede ser negativo.

-   **Sexo:** Variable categórica nominal que representa una categórica que clasifica a una persona según su género cuya restricción
 es que no puede tomar valores que no sean masculino o femenino.
 
-   **Ciclo:** Variable categórica ordinal que representa una clasificación a partir de la etapa académica que está cursando un estudiante de universidad cuya restricción es que no puede ser negativo y debe estar en el rango de calificaciones de la institución educativa. 

-   **Promedio:** Variable numérica continua que representa una medida obtenida al sumar las calificaciones de un estudiante obtenidas en un conjunto de evaluaciones y dividirla entre el número de calificaciones cuya restricción es que no puede ser negativo.

-   **Distrito:** Variable categórica nominal que representa una subdivisión geográfica dentro de una ciudad donde una persona vive cuya restricción es que puede tomar como únicos valores los nombres de los distintos distritos de lima.

-   **Transporte:** Variable categórica nominal que representa el medio de transporte que una persona utiliza para movilizarse de un lugar a otro cuya restricción es que solo puede tomar como valor el nombre de medios de transporte.

-   **Tiempo transporte:** Medida en horas. Variable numérica continua que representa el tiempo que se demora una persona en movilizarse de un punto a otro cuya restricción es que no puede tomar un valor negativo.

-   **Horas dormir:** Medida en horas. Variable numérica continua que representa la cantidad de horas de sueño de una persona en un día cuya restricción es que no puede tomar un valor negativo.

-   **Min pasaje:** Medida en soles. Variable numérica continua que representa el precio mínimo que está obligado a pagar un estudiante para trasladarse hasta la universidad cuya restricción es que no puede tomar un valor negativo y debe ser menor o igual al pasaje máximo. 

-   **Max pasaje:** Medida en soles. Variable numérica continua que representa el precio máximo que está obligado a pagar un estudiante para trasladarse hasta la universidad cuya restricción es que no puede tomar un valor negativo y debe ser mayor o igual al pasaje mínimo. 

-   **Hora salida del hogar:** Medida en horas. Variable numérica discreta que representa la hora a la que un estudiante sale de su hogar hacia la universidad cuya restricción es que no puede tomar un valor negativo y su valor debe encontrarse en el rango de horas de 0 a 24. 

-   **Hora salida de UTEC:** Medida en horas. Variable numérica discreta que representa la hora a la que un estudiante sale de la universidad hacia su hogar cuya restricción es que no puede tomar un valor negativo y su valor debe encontrarse en el rango de horas de 0 a 24. 

-   **Faltas:** Variable categórica nominal que representa la cantidad de faltas o número de veces que un estudiante ha llegado tarde a clases a causa del transporte público cuya restricción es que no puede tomar un valor negativo.
-   **Max pasaje no planeado:** Medida en soles. Variable numérica continua que representa el precio máximo que un estudiante ha llegado a pagar por el uso de un transporte privado no planeado cuya restricción es que no puede tomar un valor negativo y debe ser mayor o igual al pasaje mínimo no planeado.

-   **Min_pasaje_no_planeado:** Medida en soles. Variable numérica continua que representa el precio mínimo que un estudiante ha llegado a pagar por la utilización de un transporte privado no planeado cuya restricción es que no puede tomar un valor negativo y debe ser menor o igual al pasaje máximo no planeado.

-   **Max_pasaje_bus_UTEC:** Medida en soles. Variable numérica continua que representa el precio máximo que un estudiante está dispuesto a pagar por un transporte de UTEC cuya restricción es que no puede tomar un valor negativo y debe ser mayor o igual al pasaje mínimo de bus de UTEC.

-   **Min_pasaje_bus_UTEC:** Medida en soles. Variable numérica continua que representa el precio mínimo que un estudiante está dispuesto a pagar por un transporte de UTEC cuya restricción es que no puede tomar un valor negativo y debe ser menor o igual al pasaje máximo de bus de UTEC.



------------------------------------------------------------------------


# Datos

## Instrumentos de recolección

Para el proyecto, se decidió recolectar los datos mediante un cuestionario dirigido a los estudiantes de UTEC utilizando Google Forms. Se optó por este método debido a que es gratuito y permite restringir los dominios de las variables, lo que facilita la limpieza de los datos. El cuestionario fue compartido con el grupo de Telegram que incluye a todos los estudiantes de Estadística y Probabilidades 1 en el ciclo 2023-1, así como también se compartió en grupos de WhatsApp. Para incentivar la participación de los estudiantes, se implementó la estrategia de entregar dulces a aquellos que completaran el cuestionario.Una vez recolectadas las respuestas, se descargaron en un archivo .csv para su posterior análisis en R.

## Población, muestra, muestreo

-   **Población:** Estudiantes de pregrado de la Universidad de Ingeniería y Tecnología en el periodo 2023-I que usen habitualmente algún tipo de transporte para trasladarse desde su hogar hasta la universidad o viciversa.
-   **Muestra:** Estudiantes de UTEC que accedieron a responder al formulario.
-   **Muestreo:** El tipo de muestreo es no aleatorio por conveniencia porque obtendremos los datos de los estudiantes que accedieron a responder al formulario y que cumplen con el criterio de la población.

---

## Limpieza de datos

La limpieza de datos es fundamental dentro del análisis estadístico, ya que durante el proceso de recolección pudimos haber obtenido datos incompletos, erróneos o inconsistentes. De esta manera, podemos mejorar la calidad y precisión de nuestras conclusiones, trabajando con valores correctos. A continuación, desarrollaremos la limpieza de los datos recopilados.

### 1. Instalamos librerias
```{r}
# Lista de librerías necesarias
librerias <- c("ggplot2", "readr", "dplyr", "lubridate", "gridExtra", "funModeling")

# Verificar si las librerías están instaladas y, si no lo están, instalarlas
for (libreria in librerias) {
  if (!requireNamespace(libreria, quietly = TRUE)) {
    install.packages(libreria)
  }
}
```


### 2. Descargamos las librerías

```{r message = FALSE }
library(ggplot2)
library(readr)
library(dplyr)
library(funModeling)
```

------------------------------------------------------------------------

### 3. Cargamos la data y asignamos correctamente las variables

En este paso cargamos el archivo .csv en una variable DF (DataFrame) y asignamos los tipos de variable según si son categóricas o numéricas.

```{r}
DF <- read_csv("Datos_encuesta_.csv", col_types = "cnccnccnnnncccnnnnn")
DF
```

Corregimos el tipo de variable de las horas de salida del data frame con ayuda de la librería "lubridate".

```{r}
library(lubridate)
```

Las variables "DF de salida", primero las asignamos como categóricas para así convertirlas en formato "hms" (hora-minuto-segundos) con el comando "hms()" y de esto obtener solo la hora con el comando "hour()".

```{r}
DF %>% mutate(
  Hora_salida_hogar = hour(hms(Hora_salida_hogar)))-> DF
```

```{r}
DF %>% mutate(
  Hora_salida_de_UTEC = hour(hms(Hora_salida_de_UTEC)))-> DF
```

Para finalizar, asignamos las variables "horas de salida" como numéricas.

```{r}
DF <- read_csv("Datos_encuesta_.csv", col_types = "cnccnccnnnnnncnnnnn")
DF1 <- DF
DF
```

**Ahora podemos visualizar nuestras variables con su respectivo tipo:**

```{r}
str(DF)
```

```{r}
problems()
```

------------------------------------------------------------------------

### 3. Eliminamos columnas que no sirven

Como hicimos las encuestas a través de Formularios de Google, este automáticamente agrega una columna de "Marca temporal" que registra la fecha y hora en que se ingreso cada observación. Sin embargo, esta no es relevante para nuestro análisis, por lo que procedemos a eliminarla.

```{r}
DF <- DF[,-1]
DF
```

Vemos si existen filas vacías, es decir, sin ningún dato.

```{r}
filas_inservibles <- which( rowSums(is.na(DF)) >= 17 ) 
filas_inservibles
```

------------------------------------------------------------------------

### 4. Analizar variables

Primero, utilizamos la función "df_status" para resumir la información del conjunto de datos en cuanto a la cantidad de observaciones, variables, valores faltantes, tipo de datos, entre otros.

```{r}
df_status(DF)
```

Seguidamente, empleamos la función count de la librería "dplyr", importada previamente, para obtener la frecuencia de valores para las variables: "Promedio_ponderado", "Tiempo_transporte" y "Min_pasaje_bus", "Hora_salida", "Hora_salida_de_UTEC". De esta manera podemos tener una idea de la distribución de datos para a posteriormente tratar estas columnas de manera adecuada. Además, escogimos estas variables numéricas porque en general notamos que son aquellas con irregularidades, las cuales subsanaremos en el siguiente paso.

```{r}
DF %>% count(Promedio_ponderado)
DF %>% count(Tiempo_transporte)
DF %>% count(Min_pasaje_bus)
DF %>% count(Max_pasaje_bus)
DF %>% count(Hora_salida_hogar)
DF %>% count(Hora_salida_de_UTEC)
```

------------------------------------------------------------------------

### 5. Realizar restricciones

Como mencionamos anteriormente, las variables de "Promedio_ponderado", "Tiempo_transporte" y "Min_pasaje_bus" son aquellas con irregularidades.

En primer lugar, aplicaremos restricciones a "Tiempo_transporte", en este caso reemplazaremos los valores menores a 5 minutos con NA; ya que consideramos que es poco factible que alguien pueda llegar a la universidad en menos de ese tiempo.

```{r}
DF %>% mutate(Tiempo_transporte =
        ifelse(Tiempo_transporte < 5, NA, round(Tiempo_transporte)))-> DF

```

Segundo, modificamos los datos del promedio ponderado; en este caso identificamos observaciones donde la variable era muy baja, por ejemplo: 2 de promedio, y lo más probable es que alguien con ese ponderado ya se haya retirado de la universidad. Asimismo, encontramos casos opuestos como un ponderado de 20, el cuál es prácticamente imposible.

```{r}
DF %>% mutate(Promedio_ponderado =
        ifelse(Promedio_ponderado < 10 | Promedio_ponderado > 19 , NA, Promedio_ponderado))-> DF
```

Por último, en el caso de las variable "Hora_salida_de_UTEC", debido a que estamos trabajando con el formato de 24 horas optamos por corregir aquellos casos de hora de salida de UTEC a las 2:00 o 5:00, lo cual no es posible y lo corregimos aumentándoles 12 horas.

```{r}
DF %>% mutate(Hora_salida_de_UTEC =
        ifelse(Hora_salida_de_UTEC < 8, Hora_salida_de_UTEC + 12, Hora_salida_de_UTEC))-> DF
```

```{r}
DF %>% mutate(Hora_salida_hogar =
        ifelse(Hora_salida_hogar < 5, Hora_salida_hogar + 12, Hora_salida_hogar))-> DF
DF
```

------------------------------------------------------------------------

### 6. Creamos las variables

A continuación, creamos 3 nuevas columnas en nuestro conjunto de datos a partir de las variables que tienen un máximo y mínimo como descriptor. Ya que, nuestro formulario lo desarrollamos considerando ambos límites para posteriormente calcular la media entre los dos valores y así tener un dato más preciso.

```{r}
DF %>% mutate(
  Promedio_pasaje = round((Max_pasaje+Min_pasaje)/2, 2))-> DF
```

```{r}
DF %>% mutate(
  Promedio_pasaje_no_planeado = round((Max_pasaje_no_planeado+Min_pasaje_no_planeado)/2, 2)) -> DF
```

```{r}
DF %>% mutate(
  Promedio_pasaje_bus = round((Max_pasaje_bus + Min_pasaje_bus)/2, 2)) -> DF
```


Visualizamos las nuevas variables en nuestro DataFrame:

```{r}
DF
```

Luego, analizamos la información importante referente al nuevo conjunto de datos.

```{r}
df_status(DF)
```
```{r}
cantidad_nas <- sum(is.na(DF))
print(cantidad_nas)  # Imprimir la cantidad de NAs

# Calcular el porcentaje de NAs
porcentaje_nas <- sum(colMeans(is.na(DF)))
round(cantidad_nas / (nrow(DF)*ncol(DF))*100,2) # Imprimir el porcentaje de NAs
```

En la tabla podemos observar la cantidad y porcentaje de NAS. Estos se encuentran por debajo del 4% en cada variable involucrada, y entre todos los datos del dataframe solo hay 8 en total, lo que representa un 0.26%, una proporción que podemos considerar manejable para el estudio.

Por otro lado, se puede visualizar una gran cantidad de ceros en variables relacionadas con el pasaje. Esto es debido a que, no necesariamente todos los entrevistados usan un medio de transporte en el que paguen un pasaje, tales como "Bicicleta", "Caminando" o "Carro propio". Por lo que, en vez de inventar un número, simplemente colocaron cero, representando de esta forma que no lo usan.


------------------------------------------------------------------------

### 7. Exportar data

Finalmente, exportamos el nuevo DataFrame, nuestra data limpia, como un archivo .csv.

```{r}
DF
write_csv(DF, "Datos_encuesta_limpio.csv")

```


Ahora, podemos considerar a nuestra base de datos como limpia, debido a que le realizamos restricciones a las variables necesarias y explicamos las razones de ello. Asimismo, añadimos variables que vimos necesarias para nuestro análisis de la data. Recordemos que nuestra data no esta tan sucia, puesto que al usar el Google Forms como herramiento de recolección de datos podemos hacer uso de las restricciones que este nos brinda.

---

# Análisis descriptivo

## Análisis univariado

### Edad
```{r}

# Calcular los valores de la media, mediana y rango intercuartil
mean_val <- mean(DF$Edad)
median_val <- median(DF$Edad)
q1 <- quantile(DF$Edad, 0.25)
q3 <- quantile(DF$Edad, 0.75)

# Graficar la densidad
plot(density(DF$Edad), lwd = 2, col = "black", main = "Gráfica de densidad de las edades", xlab="Edades")

# Agregar líneas rojas para la media, mediana y rango intercuartil
abline(v = mean_val, col = "blue", lwd = 2)  # Media
abline(v = median_val, col = "red", lwd = 2)  # Mediana
segments(q1, 0, q3, 0, col = "green", lwd = 2)  # Rango intercuartil

legend("topright", legend = c("Media", "Mediana", "Rango intercuartil"),
       col = c("blue", "red", "green"), lwd = c(2, 2, 2, 2), bty = "n")
```

En la gráfica podemos observar que la distribución de los datos se concentra mayormente en la izquierda pues se puede ver como la cola se encuentra en el lado derecho, representando una asimetría negativa. Por lo que, podemos decir que nuestra población se concentra entre las edades de 18 a 20, es decir, poseemos una muestra de estudiantes jóvenes.

**Cálculo de los descriptores**

- **Mediana**, debido a que nuestra gráfica es asimétrica
- **Rango intercuartil**, para cuantificar el ancho en donde se concentran nuestras edades.
```{r}
print("Mediana:")
median(DF$Edad)
print("Rango Intercuartil:")
IQR(DF$Edad)
```

---

### Sexo y ciclo

Realizamos una tabla Cruzada o de doble entrada, para analizar a la nuestra población.

```{r}
tabla2 <- table(DF$Sexo, DF$Ciclo)
tabla2

```

Frecuencias relativas
```{r}
prop.table(tabla2)*100
```

Grafico de barras de tabla cruzada
```{r}
barplot(tabla2, col=c(36,10), border = "white", main = "Gráfica de barras de los ciclos", 
      xlab = "Ciclo", ylab = "Cantidad")
legend("topright",legend=c("Hombre","Mujer"), col=c(36,10), cex= 1, pch=20,title="Sexo")
```
En la gráfica podemos ver como nuestra muestra de estudiantes de la UTEC se concentra en el 2do, 3er y 4to ciclo. Por lo que, podemos decir que nuestra muestra esta bien representada pues estamos en el público objetivo, ya que tendríamos preferencia por los de primeros ciclos que seguro usarán más el sistema de transporte, si se llegase a implementar.
Así mismo, se puede distinguir que el porcentaje de mujeres y hombres es parecido, excepto en el 4to ciclo, donde el porcentaje de mujeres es mayor.

**Cálculo de los descriptores**

- **Moda.** para identificar al ciclo con mayor cantidad de estudiantes a que nuestra gráfica es asimétrica.

```{r}
ciclo_frec <- table(DF$Ciclo)
e <- which.max(ciclo_frec) 
moda <- names(ciclo_frec)[e]
porcentaje_ciclo<-(ciclo_frec[moda]/sum(ciclo_frec))*100

round(porcentaje_ciclo,2)

```
Podemos concluir que el 48.34% de los estudiantes encuestados son del segundo ciclo.

---

### Medio de transporte
```{r}
n.i_trans <- table(DF$Transporte)
orden <- order(-n.i_trans)
n.i_Trans <- n.i_trans[orden]

# Colores para todas las barras
colores <- rep("skyblue", length(n.i_Trans))
# Color para la barra destacada
colores[1] <- "red"

# Graficar el gráfico de barras con la barra destacada
barras <- barplot(n.i_Trans, col = colores,
        ylab = "Número de alumnos",
        xlab = "Medio de transporte",
        main = "Medios de transporte más usados para llegar a la universidad",
        cex.axis = 0.75, cex.names = 0.5, ylim = c(0, 100),
        border = "gray1")

text(x=barras, y=n.i_Trans, pos=3, cex=0.8, label=round(n.i_Trans, 4))

```

El gráfico nos indica que el bus es el medio de transporte más usado por los alumnos, mientras que la bicicleta es menos usado. Así mismo, se observa como los alumnos usan en mayor medida transporte publico. 


**Cálculo de los descriptores**

- **Moda.** Para este caso la moda es el descriptor numérico optimo, siendo que lo más importante es el hecho de saber cual es el medio de transporte más usado.

```{r}
#Descriptores numéricos que vas a usar para la variable medio de transporte
i <- which.max(n.i_trans) 
moda <- names(n.i_trans)[i]
porcentaje_bus<-(n.i_trans[moda]/sum(n.i_trans))*100

round(porcentaje_bus,2)
```       

A partir de lo hallado, podemos decir que el 43.71% de los estudiantes usan el bus para transporte a la universidad.

---

### Tiempo en transporte

```{r}
DF %>% ggplot(., aes(Tiempo_transporte)) + geom_boxplot(fill = "skyblue") + theme_classic() +  xlab("Tiempo en transporte") + ggtitle("Distribución del tiempo en el transporte") 
```

Al analizar la variable de distribución del tiempo en transporte, podemos notar que no se observan valores atípicos o extremos que puedan sesgar nuestros resultados. En esta situación, la media y la mediana se convierten en medidas descriptivas relevantes para caracterizar esta variable.

**Cálculo de los descriptores**

- **Media.** Representa un punto de referencia central que indica el tiempo promedio que las personas emplean en sus desplazamiento hacia la universidad.
```{r}
media <- mean(DF$Tiempo_transporte, na.rm = TRUE)
round(media)
```

El cálculo de la media revela que los encuestados tienen un tiempo promedio de transporte de 58 minutos.

- **Mediana.** Es el valor que divide a la muestra en dos partes iguales, donde el 50% de las personas tardan menos que la mediana y el otro 50% tardan más
```{r}
mediana <- median(DF$Tiempo_transporte, na.rm = TRUE)
mediana
```

Podemos concluir que la mitad de los encuestados tardan menos de 50 minutos en sus desplazamientos hacia la universidad.

- **Cuartiles.** A partir de la gráfica, podemos utilizar los descriptores numéricos de posición, como los cuartiles, para obtener información sobre la cantidad de tiempo que tarda el 50% de las personas en su viaje.

El primer cuartil indica el valor por debajo del cual se encuentra aproximadamente el 25% de los datos

```{r}
Q1 <- quantile(DF$Tiempo_transporte, 0.25, na.rm = TRUE)  # Primer cuartil
Q1
```

El tercer cuartil implica que el 75% restante de los datos se encuentra por encima del primer cuartil.

```{r}
Q3 <- quantile(DF$Tiempo_transporte, 0.75, na.rm = TRUE)  # Tercer cuartil
Q3
```

Al calcular los cuantiles, podemos concluir que el 50% de los encuestados demoran entre 20 y 90 minutos en su viaje hacia la universidad.
 
- **Rango intercuartil.** El rango intercuartil es una medida que abarca el rango medio del conjunto de datos, excluyendo el 50% de los valores extremos más altos y bajos. Proporciona una medida de la variabilidad de los tiempos de transporte centrada en la parte central de la distribución.
 
```{r}
IQR <- Q3- Q1  # Rango intercuartil
print(IQR)
```
Al calcular el cuantil Q1 (primer cuartil) y el cuantil Q3 (tercer cuartil), hemos obtenido el rango intercuartil, el cual nos indica que la mayoría de los tiempos de transporte se encuentran dentro de un rango de 70 minutos.

Adicionalmente, si queremos identificar la **cantidad de encuestados entre dos instantes**, en este caso entre el cuartil 1 y 3, realizamos lo siguiente:
```{r}
instante_tiempo_1 <- 20 # Primer instante de tiempo
instante_tiempo_2 <- 90  # Segundo instante de tiempo

datos_instantes <- DF %>% 
  filter(Tiempo_transporte >= instante_tiempo_1 & Tiempo_transporte <= instante_tiempo_2)

num_personas <- nrow(datos_instantes)
num_personas 

```
Finalmente, realizamos un cálculo para determinar cuántas personas se demoraron en un intervalo de tiempo comprendido entre 20 y 90 minutos, y encontramos que un total de 80 personas requieren ese tiempo para llegar a la universidad.

---

### Hora de salida de UTEC

Se crea un variable que almacene la columna de hora de salida de UTEC.
```{r}
Salida_U <- t(select(DF, Hora_salida_de_UTEC))
```

Se asignan rangos de "mañana", "tarde" y "noche" dependiendo la hora.
```{r}
asignar_intervalo <- function(hora) {
  if (hora >= "00:00:00" && hora < "12:00:00") {
    return("Mañana")
  } else if (hora >= "12:00:00" && hora < "18:00:00") {
    return("Tarde")
  } else {
    return("Noche")
  }
}

```

Se crea una nueva columna, para asignar el turno de salida.
```{r}
DF%>%mutate(Turnos=sapply(Salida_U, asignar_intervalo))
DF%>% mutate(
  Turnos = sapply(Salida_U, asignar_intervalo)) -> DF

```


Se realizar un gráfico de barras

```{r}
library(gridExtra)
```


```{r}
tabla <- prop.table(table(DF$Turnos))
table(DF$Turnos)
```


```{r}
bar <- barplot(tabla * 100, col = "yellow", xlab = "Turno de salida de los estudiantes", ylab = "Frecuencia porcentual", main = "Distribución del turno de salida", ylim = c(0, 100))

# Obtener los porcentajes

porcentajes <- round(tabla * 100,2)

# Agregar el texto con los porcentajes encima de cada barra

text(x = bar, y = porcentajes, labels = paste0(porcentajes, "%"), pos = 3)

```

Al analizar la variable Turno de salida de los estudiantes podemos concluir lo siguiente:

1. El turno de salida más frecuente es el de tarde, representando aproximadamente el 58.45% del total de estudiantes. Esto significa que una mayoría considerable de los estudiantes suele regresar a sus hogares desde la universidad en horas de la tarde. Este dato resalta la preferencia de los estudiantes por salir en ese turno.

2. Al examinar detenidamente el gráfico de barras, notamos que aproximadamente el 32.45% de los estudiantes tiende a regresar a sus hogares en horarios nocturnos. Este dato revela que una proporción considerable de estudiantes tiene un turno de salida tardío, posiblemente debido a diversas actividades académicas, extracurriculares o laborales que los mantienen ocupados hasta altas horas de la noche.

3. Finalmente, observamos que un porcentaje minoritario, específicamente el 9.27% de los estudiantes, suele regresar exclusivamente a sus hogares en horarios matutinos. Esto indica que solo un pequeño grupo de estudiantes tiene un turno de salida temprano y opta por regresar directamente a sus hogares desde la universidad en la mañana.

**Cálculo de los descriptores**

- **Moda**. Para identificar la mayor cantidad de datos.
```{r}

j <- which.max(tabla) 
moda <- names(tabla)[j]
porcentaje_turno<-(tabla[moda]/sum(tabla))*100

round(porcentaje_turno,2)
```

### Pasaje promedio
```{r}
boxplot(DF$Promedio_pasaje, main = "Pasaje promedio en transporte", ylab = "Pasaje promedio", col = "green")

```

Al analizar la variable "pasaje promedio", podemos observar la presencia de valores atípicos, lo cual indica que existen personas que gastan en pasaje diario entre 20 y 30 soles. Esto puede deberse a que estas personas vivan lejos de su lugar de destino y utilicen servicios de transporte como taxis de forma frecuente.

Además, el descriptor más relevante para caracterizar esta variable es la mediana. La mediana nos brinda una medida de tendencia central que nos indica el valor que se encuentra en la mitad de la distribución de los gastos en pasaje promedio:

**Cálculo de los descriptores**

- **Mediana.** Para poder conocer la distribución de pasaje promedio en el transporte hacia la universidad.
```{r}
mediana <- median(DF$Promedio_pasaje, na.rm = TRUE)
mediana
```
La mediana de 3.5 soles indica que la mitad de los valores de pasaje promedio se sitúan por encima de ese valor y la otra mitad se sitúa por debajo. Esto significa que 3.5 soles es el punto central de la distribución de los precios de los pasajes. Ademas nos indica que aproximadamente el 50% de los valores de pasaje promedio están por encima de 3.5 soles y el otro 50% están por debajo.


Por otro lado podemos decir que A partir de la gráfica, podemos utilizar los descriptores numéricos de posición, como los cuartiles, para obtener información entre que rango se encuetran el 50% de pasaje promedio

- **Cuartiles**
El primer cuartil indica el valor por debajo del cual se encuentra aproximadamente el 25% de los datos

```{r}
Q1_1 <- quantile(DF$Promedio_pasaje, 0.25, na.rm = TRUE)  # Primer cuartil
round(Q1_1, 0)
```

El tercer cuartil implica que el 75% restante de los datos se encuentra por encima del primer cuartil.

```{r}
Q3_1 <- quantile(DF$Promedio_pasaje, 0.75, na.rm = TRUE)  # Tercer cuartil
round(Q3_1, 0)
```

A partir de lo hallado, podemos concluir que el 50% de los encuestados gastan entre 2 y 6 soles en promedio en pasaje
 

- **Rango intercuartil.** 
 
```{r}
IQR_1 <- Q3_1- Q1_1  # Rango intercuartil
round(IQR_1, 0)
 
```

Al calcular el cuantil Q1 (primer cuartil) y el cuantil Q3 (tercer cuartil), hemos obtenido el rango intercuartil, que nos proporciona información sobre la dispersión de los datos. En este caso, el rango intercuartil de 4 soles indica que el 50% de los encuestados tiene un gasto en pasaje promedio que se encuentra dentro de ese intervalo. En otras palabras, aproximadamente la mitad de los encuestados gastan entre 4 soles en promedio en el transporte hacia la universidad.


Adicionalmente, si queremos identificar la **cantidad de encuestados entre dos instantes**, en este caso entre el cuartil 1 y 3, realizamos lo siguiente:

```{r}
cantidad_soles_1 <- 2  # Primera cantidad de soles
cantidad_soles_2 <- 6  # Segunda cantidad de soles
personas_gasto <- subset(DF, Promedio_pasaje >= cantidad_soles_1 & Promedio_pasaje <= cantidad_soles_2)
num_personas_1 <- nrow(personas_gasto)
num_personas_1

```

Finalmente, realizamos el cálculo para determinar cuántas personas gastan diariamente entre 2 y 6 soles en promedio, y obtuvimos un total de 75 personas.

---

## Análisis bivariado

### Análisis entre variables numéricas

#### Promedio ponderado- Tiempo en transporte- Horas dormidas

```{r}

# Crear el gráfico pairs con nombres de variables personalizados
pairs(~ Promedio_ponderado + Tiempo_transporte + Horas_dormidas, data = DF,
      labels = c("Promedio ponderado", "Tiempo transporte", "Horas dormidas"))
```

Al analizar la garfica podemos concluir lo siguiente

1. Al analizar la variable 'Promedio ponderado' de los estudiantes y el 'Tiempo en transporte' hasta la universidad, se puede concluir que no existe ninguna tipo de relación entre ambas variables.

2. Al analizar la variable 'Tiempo de transporte hacia la universidad' y 'Horas de descanso' de los estudiantes, se puede concluir que no se observa ninguna relación significativa entre ambas variables.

3. Al analizar la variable 'Promedio ponderado' de los estudiantes y las 'Horas de sueño' de los estudiantes, se puede concluir que no existe ninguna tipo de relación entre ambas.


Aunque podría parecer que existe alguna relación entre la variable 'Horas de sueño' de los estudiantes  y 'Tiempo de transporte' hasta la universidad, al analizar los datos se observa que no hay ninguna tipo de conexión entre ambas. Por lo tanto, no podemos concluir que una variable afecte a la otra.

**Cálculo de los descriptores**

- **Correlación**
Correlacion entre Horas dormidas y Promedio ponderado

```{r}
correlation <- cor(DF$Horas_dormidas, DF$Promedio_ponderado, use = "complete.obs")
round(correlation, 2)
```


- Podemos concluir que  no existe relación alguna entre las horas dormidas de los estudiantes con su promedio ponderado, debido a que la correalción esta muy cercana al cero. Es decir, los estudiantes que duermen menos horas no tienden a tener un promedio ponderado mayor o menor, puesto este no se ve afectado.


Correlacion entre Tiempo transporte y Horas dormidas

```{r}
correlacion_1 <- cor(DF$Tiempo_transporte, DF$Horas_dormidas, use = "complete.obs")
round(correlacion_1, 2)

```

- Podemos concluir que a medida que el tiempo de transporte aumenta, las horas de dormida tienden a disminuir. Es decir, las personas que pasan más tiempo en el transporte tienden a dormir menos horas, y aquellos que pasan menos tiempo en el transporte tienden a dormir más horas.


---

### Análisis entre variable categóricas y numéricas

#### Gastos en pasaje ahorrado- Medio de transporte

Se crea una nueva variable que representa la diferencia entre el pasaje que gastan los estudiantes actualmente y el pasaje que gastarían usando el bus, la cual representaría el pasaje que se ahorrarian en caso el bus se implemente con el costo promedio propuesto por los mismos estudiantes.
```{r}
DF %>% mutate(
  Pasaje_ahorrado = abs(Promedio_pasaje- Promedio_pasaje_bus))-> DF
```


Quitamos las variables que no implequen el uso de un servicio de transporte.
```{r}
DF_trns_ahorro <- aggregate(DF[,c("Pasaje_ahorrado")],by = list(Transporte = DF$Transporte), FUN = mean, na.rm = TRUE)
DF_trns_ahorro <- DF_trns_ahorro[-c(4,5,2),]
DF_trns_ahorro

DF_moment <- DF[DF$Transporte != "Caminando",]
DF_moment <- DF_moment[DF_moment$Transporte != "Bicicleta",]
DF_moment <- DF_moment[DF_moment$Transporte != "Carro propio",]

DF_moment
```


Se realiza un gráfico de barra del pasaje ahorrado en por medio de transporte.
```{r}
DF_trns_ahorro$Transporte <- reorder(DF_trns_ahorro$Transporte,-DF_trns_ahorro$Pasaje_ahorrado)


# Establecer el color deseado para una barra específica
color_barra_destacada <- "red"

recuento <- table(DF_moment$Transporte)

# Graficar el gráfico de barras con etiquetas de observaciones
ggplot(DF_trns_ahorro, aes(x = Transporte, y = Pasaje_ahorrado)) +
  geom_bar(stat = "identity", fill = ifelse(DF_trns_ahorro$Transporte == "Bus", color_barra_destacada, "steelblue")) +
  geom_text(aes(label = recuento), vjust =-0.5, color = "black", size = 3) +
  xlab("Medio de transporte") +
  ylab("Pasaje ahorrado") +
  ggtitle("Pasaje ahorrado por medio de transporte")



```

1. El medio de transporte que presenta el mayor pasaje ahorrado es "Otros", seguido por "Metropolitano" y "tren eléctrico". La gran diferencia en ahorro con "Otros" podría darse al costo de los demás medios de transporte, los cuales son más accesibles.

2. El medio de transporte "Bus" tiene un pasaje ahorrado ligeramente menor en comparación con los medios "Alimentador". Aunque está resaltado en color rojo en la gráfica, su diferencia de ahorro no es tan distante de este ni de los otros medios, a excepción del máximo.

A continuación, calculamos el ahorro global según el medio de transporte.
```{r}
DF_trns_ahorro_global <- aggregate(DF[,c("Pasaje_ahorrado")],by = list(Transporte = DF$Transporte), FUN = sum, na.rm = TRUE)
DF_trns_ahorro_global <- DF_trns_ahorro_global[-c(4,5,2),]
DF_trns_ahorro_global
```
```{r}
ggplot(DF_trns_ahorro_global, aes(x = reorder(Transporte,-Pasaje_ahorrado), y = Pasaje_ahorrado)) +
  geom_bar(stat = "identity", fill = ifelse(DF_trns_ahorro_global$Transporte == "Metropolitano", color_barra_destacada, "steelblue")) +
  xlab("Medio de transporte") +
  ylab("Pasaje ahorrado Global") +
  ggtitle("Pasaje ahorrado global por medio de transporte")
```

Comparando las gráficas de ahorro promedio del estudiante según el medio de transporte con el ahorro global, podemos caer en cuenta que si bien es cierto hay medios de transporte con el que de manera individual se ahorraría más, al ver el monto general de quienes lo usan la relevancia cambia. 

Por ejemplo, el ahorro de pasaje en el bus, está penúltimo en la primera gráfica; sin embargo, como varias personas usan este medio, su ahorro global está en segunda posición. Caso contrario sucede con el ahorro de "Otros", el cual se encontraba como el mayor en la primera gráfica, pero en la segunda su ahorro global no es tan significante. 

Por lo tanto, podemos concluir que el medio de transporte en el cuál más personas se ahorran el pasaje es el metropolitano.

Ahora respecto a los **descriptores numéricos**, utilizaremos a la media y la mediana, ya que no hay valores atípicos. Así mismo, utilizaremos los descriptores de la desviación estándar y el máximo y mínimo para observar la dispersión de el pasaje ahorrado.
```{r}
#Descriptores numéricos que vas a usar este análisis
# Promedio
promedio_pasaje_ahorrado <- mean(DF_trns_ahorro$Pasaje_ahorrado)

# Mediana
mediana_pasaje_ahorrado <- median(DF_trns_ahorro$Pasaje_ahorrado)

# Desviación estándar
desviacion_estandar <- sd(DF_trns_ahorro$Pasaje_ahorrado)

# Mínimo y máximo
minimo_pasaje_ahorrado <- min(DF_trns_ahorro$Pasaje_ahorrado)
maximo_pasaje_ahorrado <- max(DF_trns_ahorro$Pasaje_ahorrado)

descrip_num <- data.frame(Promedio = promedio_pasaje_ahorrado,
                           Mediana = mediana_pasaje_ahorrado,
                           Desviación_estándar = desviacion_estandar,
                           Mínimo = minimo_pasaje_ahorrado,
                           Máximo = maximo_pasaje_ahorrado)

round(descrip_num, 2)
```

- La media de pasaje ahorrado es de 4.25, lo cual indica el ahorro potencial diario promedio de los estudiantes si usaran un posible bus de la universidad.

- La mediana del pasaje ahorrado es de 3.89, lo que significa que la mitad de los estudiantes presenta un ahorro igual o superior a este valor. Y analizando que el máximo y mínimo están tan distantes, sugiere que hay una gran variabilidad en los posibles ahorros. 

- Por otro lado, la desviación estándar del pasaje ahorrado es de 2.21, lo que indica una dispersión moderado en los ahorros entre los estudiantes. Algunos estudiantes podrían estar obteniendo ahorros significativos, mientras que otros podrían estar ahorrando menos.

---

#### Transporte- Tiempo en Transporte
Comenzamos analizando la variable, a través de un gráfica de boxplot para comparar las distribuciones del tiempo en transporte por medio de transporte.
```{r}
DF %>% ggplot(.,aes(`Tiempo_transporte`,fill=Transporte))+ geom_boxplot() + ggtitle("Distribución del tiempo de transporte por transporte") + xlab("Tiempo en el transporte")
```

**Cálculo de los descriptores**

```{r}
#Descriptores numéricos que vas a usar este análisis
t_trans_summary <- DF %>%
  group_by(Transporte) %>%
  summarise(
    Min. = min(Tiempo_transporte, na.rm = TRUE),
    `1st Qu.` = quantile(Tiempo_transporte, probs = 0.25, na.rm = TRUE),
    Median = median(Tiempo_transporte, na.rm = TRUE),
    Mean = round(mean(Tiempo_transporte, na.rm = TRUE), 2),
    `3rd Qu.` = quantile(Tiempo_transporte, probs = 0.75, na.rm = TRUE),
    Max. = max(Tiempo_transporte, na.rm = TRUE),
    `Desviación estándar` = round(sd(Tiempo_transporte, na.rm = TRUE), 2),
    
  ) %>%
  arrange(desc(Median))

t_trans_summary

```

Como se puede observar en la tabla, ordenamos el tiempo de transporte en relación al medio, según la mediana, ya que en la gráfica nos dimos cuenta que la mayoría de las distribuciones no son simétricas, a excepción de "Alimentador" y "Otros", donde sus quantiles se encuentran a distancias similares.

A partir de ello, podemos concluir que lo siguiente:
- El menor tiempo de transporte es caminando, esto puede darse debido a la proximidad del estudiante a la universidad y por ende decide ir a pie. Aunque, el segundo medio es "Carro propio", un transporte con el que se pueden recorrer mayores distancias en menos tiempo; a comparación de los transportes públicos, su único obstáculo es el tráfico y no el tiempo o filas de espera en el paradero como sería en un bus, tren eléctrico, etc.

- El medio de transporte con el que los estudiantes se demoran más es el tren eléctrico, seguido del Alimentador y Metropolitano.

No obstante, es importante considerar la desviación estándar de cada entrada, ya que si bien es cierto el tren eléctrico es el medio con más tiempo de transporte, tiene una desviación estándar elevada, incluso si analizamos su mínimo y máximo, podemos ver que algunas personas solo se demoran 5 minutos, mientras que otras 100 min. En el caso del alimentador, su desviación estándar es alta, pero no tanto como el "Tren eléctrico", además su mínimo y máximo no distan mucho uno del otro, 55 y 80 minutos, respectivamente; debido a ello, podriamos decir que de manera general quienes se trasladan en "Alimentador" son quienes se demoran más en llegar a la universidad.

También, en los datos podemos encontrar picos de tiempo de transporte, por ejemplo, en el "Metropolitano" con un máximo de 180 minutos o "Colectivo" con 125 min. Al igual que en el anterior caso, es importante mencionar que estos valores son extremos, con una alta desviación estándar y adicionalemnte se encuentran fuera del rango intercuartil; por lo que no son situaciones estándar.

---

#### Promedio- Faltas

Creamos una nueva variable "Has faltado" donde se indicará si el alumno, falto o no falto debido al trasporte.
```{r}
DF <- DF %>% mutate(Has_faltado = ifelse(Faltas == "0", "NO", "SI"))
```

Realizamos la gráfica de caja de bigotes para comparar las distribucionnes.
```{r}
DF %>% ggplot(.,aes(`Promedio_ponderado`,fill=Has_faltado))+ geom_boxplot() +
  xlab("Promedio Ponderado") +  ggtitle("Distribución del promedio ponderado de estudiantes respecto a las faltas") + labs(fill = "¿Has faltado?    ")

```

A partir del gráfico, podemos darnos cuenta lo siguiente:
- La mediana del promedio ponderado de los estuiantes que no han faltado a clase por culpa del transporte, es menor que la de los que si faltaron.
- La diferencia entre los promedios de los estudiantes que faltan y los que faltan es mínima, y estadísticamente insignificativa, debido a que las cajas se solapan.
- El rango intercuartil de los que faltan es mayor de los que no, esto puede ser seguramente por que hay más personas que faltan que las que no.

**Cálculo de los descriptores**

- **Media** y **Mediana**. Se calculan la media y la mediana, debido a que no hay una excesiva cantidad de datos atípicos.

Descriptores numéricos del promedio ponderado de aquellos quienes si han faltado por culpa del medio de transporte.
```{r}
prom_si <- DF$Promedio_ponderado[DF$Has_faltado=="SI"]
descrip_num_si <- data.frame(Promedio = mean(prom_si, na.rm = TRUE),
                           Mediana = median(prom_si, na.rm = TRUE))
round(descrip_num_si, 2)
```

Descriptores numéricos del promedio ponderado de aquellos quienes no han faltado por culpa del medio de transporte.
```{r}
prom_no <- DF$Promedio_ponderado[DF$Has_faltado=="NO"]
descrip_num_no <- data.frame(Promedio = mean(prom_no),
                           Mediana = median(prom_no))
round(descrip_num_no, 2)
```

Diferencia en los descriptores numéricos del promedio ponderado de quienes no y si han faltado.

```{r}
round(descrip_num_no- descrip_num_si, 2)
```

Analizando los descriptores numéricos, podemos observar que existen ligares variaciones en los promedios ponderados de aquellas personas que han faltado o no a clase debido a medio de transporte:

Promedio: El promedio ponderado de los estudiantes que han faltado debido al medio de transporte es de 15.1, mientras que el de aquellos que no han faltado es un poco mayor, con un valor de 15.66

Mediana: La mediana del promedio ponderado muestra una diferencia similar. Los estudiantes que han faltado debido al medio de transporte tienen una mediana de 15, mientras que aquellos que no, tienen una mediana un levemente más alta de 15.95.


Valores de los quantiles del Promedio ponderado si el estudiante ha faltado a clases a causa del transporte:

```{r}
has_faltado_si <- subset(DF, Has_faltado=="SI")
summary(has_faltado_si$Promedio_ponderado)
print(IQR(has_faltado_si$Promedio_ponderado, na.rm=TRUE))
```

Valores de los quantiles del Promedio ponderado si el estudiante no ha faltado a clases a causa del transporte:
```{r}
has_faltado_no <- subset(DF, Has_faltado=="NO")
summary(has_faltado_no$Promedio_ponderado)
print(IQR(has_faltado_no$Promedio_ponderado))
```

Calculamos diferencia entre las dispersiones
```{r}
2.25- 1.53
```

A partir de la información de los quantiles y del rango intercuártil podemos afirmar que la dispersión del promedio ponderado de aquellos estudiantes que han faltado debido al medio de transporte es 0.72 mayor a quienes no.



---

### Análisis entre dos variables categóricas

#### Faltas- Trasporte

```{r}

mosaicplot(DF$Transporte ~ DF$Has_faltado,
           col=2:5,
           main="Gráfico de cantidad de faltas a clases por transporte",
           xlab="Transporte",
           ylab="Faltan a clase",
           cex.axis=0.4,
           las=1)
```
Al analizar las variables de "Transpote y Faltas a clase" se puede observar lo siguiente:

- Se evidencia que en los transportes publicos como el bus, metropolitano y colectivo existe un alto índice de estudiantes que no asisten o llegan tarde a la universidad, estos problemas podrian ser principalmente por el trafico.

- Existe una tendencia significativa en aquellos que utilizan el autobús como medio de transporte, debido a que son los que más faltan a clase, mientras que los que se desplazan en su propio automóvil tienen menos probabilidades de faltar.

- Generalmente, las personas que utilizan el bús como medio de transporte son las que presentan un mayor índice de ausencias a las clases.

**Cálculo de descriptores** 
Se decidio que la mejor manera de describir al gráfica es mediante una tabla de proporciones, donde podremos cuantificar lo que observamos.

Tabla de proporciones de si han faltado a clase debido al medio de transporte:

```{r}
#Descriptores numéricos que vas a usar este análisis
trans_faltas <- table(DF$Transporte, DF$Has_faltado)

prop_trans_faltas <- prop.table(trans_faltas, margin = 1)

prop_trans_faltas <- prop_trans_faltas[order(prop_trans_faltas[, "SI"], decreasing = TRUE), ]

# Mostrar los porcentajes
round(prop_trans_faltas, 2)
```

A partir de la visualización de la tabla, podemos concluir que los estudiantes afectados son los que usan transporte público. Por otro lado, los que usan transporte privado (movilidad propia), cuentan con una menor proporción de inasistencia con respecto al primero. 
