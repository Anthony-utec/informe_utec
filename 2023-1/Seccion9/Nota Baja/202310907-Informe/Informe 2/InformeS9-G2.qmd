---
title: "Estadisticas sobre los aeropuertos"
author: "Grupo 2, Sección 9"
date: "`r format(Sys.time(), '%d %B, %Y')`"
editor: visual
format: html
output:
  html_notebook:
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: yes
    number_sections: no
    toc_depth: 2

  html_document:
    toc: yes
    df_print: paged
---

# **Alumnos del grupo:**

| Alumno                            | **Código**    | **Correo**                     | **Porcentaje de Trabajo** |
|---------------------|----------------|-------------------|----------------|
|                                   |               |                                |                           |
| **Milton Esteban Robles Reyes**   | **202210416** | **milton.robles\@utec.edu.pe** |                           |
| **Camilo Ernesto Soto Cristóbal** | **202210484** | **camilo.soto\@utec.edu.pe**   |                           |
| **Karen**                         | **201610002** |                                |                           |
|                                   |               |                                |                           |

# **Introducción**

## Tema

Análisis mensual de la relación entre número de pasajeros e ingresos totales por aeropuerto del Perú (2020-2022).

## Relevancia

Nuestro proyecto analiza el impacto de la pandemia en el transporte aéreo y sus ingresos en diferentes aeropuertos. Buscamos información valiosa para la toma de decisiones en el sector turístico y la recuperación económica en el Perú.

# **Objetivo**

Evaluar los factores que influyen en los ingresos totales (US\$) por mes y año en cada aeropuerto en el Perú.

## Objetivo Secundarios

-   Comparar los ingresos totales con los rubros en los aeropuertos del Perú

-   Comparar los ingresos totales con el número de pasajeros en los aeropuertos del Perú evaluando su influencia

-   Determinar el aeropuerto con mayor afluencia de pasajeros y el de mayor ingresos del Perú

-   Comparar los ingresos totales (US\$) durante la pandemia y pos-pandemia en el Perú

## Tabla de variables

# Librerías

```{r echo=FALSE}
rm(list=ls())
library(plyr)
library(dplyr)
library(readr)
library(tidyr)
```

# Base de datos

Extraída del OSITRAN (ver referencias), la base de datos cuenta con el tráfico de pasajeros en aeropuertos del Perú divididos por mes y año y los ingresos totales de cada aeropuerto así como el rubro de donde se obtiene dicho importe.

```{r echo=FALSE}
ITS <- read_csv("RecaudacionIngresosTotales.csv")
TP <- read_csv("TraficoPasajeros.csv")
```

# **Datos**

## Tabla de variables

Año: Variable categórica que indica el año de la recolección de información.

Mes: Variable categórica que indica el mes de la recolección de información.

Aeropuerto: Variable cualitativa que indica el aeropuerto del cual se recolecta la información

Infraestructura: Variable cualitativa que indica a que entidad pertenece la infraestructura del aeropuerto del cual se recolecta la información.

IT: Variable cuantitativa que representa los ingresos totales en dolares que ha registrado el aeropuerto

TUUAN: Variable cuantitativa que representa el ingreso en dolares que ha generado la TARIFA UNIFICADA POR USO DE AEROPUERTO de tipo nacional.

TUUAN: Variable cuantitativa que representa el ingreso en dolares que ha generado la TARIFA UNIFICADA POR USO DE AEROPUERTO de tipo internacional.

NPI: Variable cuantitativa que representa el numero de pasajeros internacionales que ha registrado el aeropuerto

NPN: Variable cuantitativa que representa el numero de pasajeros nacionales que ha registrado el aeropuerto

IRAD_VER: Variable categórica que representa si el aeropuerto obtiene ingresos por aterrizaje y despegue.

IRAD: Variable cuantitativa que representa el ingreso en dolares del aeropuerto por aterrizaje y despegue.

AADM_VER: Variable categórica que representa si el aeropuerto obtiene ingresos por el alquiler de áreas de mantenimiento.

AADM: Variable cuantitativa que representa el ingreso en dolares por el alquiler de áreas de mantenimiento.

ADEP_VER: Variable categórica que representa si el aeropuerto obtiene ingresos por el alquiler de espacios de publicidad.

ADEP: Variable cuantitativa que representa el ingreso en dolares por el alquiler de espacios de publicidad.

ALC_VER: Variable categórica que representa si el aeropuerto obtiene ingresos por el alquiler de locales comerciales.

ALC: Variable cuantitativa que representa el ingreso en dolares por el alquiler de locales comerciales.

AOOA_VER: Variable categórica que representa si el aeropuerto obtiene ingresos por el alquiler de oficinas de operaciones de aerolíneas.

AOOA: Variable cuantitativa que representa el ingreso en dolares por el alquiler de oficinas de operaciones de aerolíneas.

ADAH_VER: Variable categórica que representa si el aeropuerto obtiene ingresos por el alquiler de almacenes/hangares.

ADAH: Variable cuantitativa que representa el ingreso en dolares por el alquiler de almacenes/hangares.

AEHE_VER: Variable categórica que representa si el aeropuerto obtiene ingresos por la atención en horas extras.

AEHE: Variable cuantitativa que representa el ingreso en dolares por la atención en horas extras.

IREA_VER: Variable categórica que representa si el aeropuerto obtiene ingresos por el estacionamiento de aeronaves.

IREA: Variable cuantitativa que representa el ingreso en dolares por el estacionamiento de aeronaves.

IRIF_VER: Variable categórica que representa si el aeropuerto obtiene ingresos por reembolso en ingresos financieros.

IRIF: Variable cuantitativa que representa el ingreso en dolares por reembolso en ingresos financieros.

IRR_VER: Variable categórica que representa si el aeropuerto obtiene ingresos por reembolsos.

IRR: Variable cuantitativa que representa el ingreso en dolares por reembolsos.

NP: Variable cuantitativa que representa el numero de pasajeros totales que ha registrado el aeropuerto.

# Creación del Dataframe

Creando el DataFrame a partir de la variable Ingresos Totales (IT)

```{r}
ITS <- filter(ITS, Año %in% c("2020","2021","2022"))
ITS %>% group_by(Año,Mes,Aeropuerto,Infraestructura) %>% summarise(IT = sum(`Importe por Servicios`)) -> DF
```

Uniendo la variable Numero de Pasajeros Internacionales (NPI)

```{r}
PI <- filter(TP, `Tipo de Pasajero` == "INTERNACIONAL")
PI <- filter(PI,Año %in% c(2020,2021,2022))
PI <- select(PI, -Periodo)
PI <- select(PI, -`Tipo de Pasajero`)
```

```{r}
DF <- merge(DF,PI, by = c("Año","Mes","Aeropuerto","Infraestructura"), all = TRUE)
DF <- rename(DF, "NPI" = "Nro Pasajeros")
```

```{r eval=TRUE}
DF$NPI[is.na(DF$NPI)] <- 0

#Reemplazo de N/A's por 0
```

Uniendo la variable Numero de Pasajeros Nacionales (NPN)

```{r}
PN <- filter(TP, `Tipo de Pasajero` == "NACIONAL")
PN <- filter(PN,Año %in% c(2020,2021,2022))
PN <- select(PN, -Periodo)
PN <- select(PN, -`Tipo de Pasajero`)
```

```{r}
DF <- merge(DF,PN, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "NPN" = "Nro Pasajeros")
```

```{r eval=TRUE}
DF$NPN[is.na(DF$NPN)] <- 0

#Reemplazo de N/A's por 0
```

Uniendo la variable Ingreso Rubro T U U A NACIONAL (TUUAN)

```{r}
TUUAN <- filter(ITS, `Rubro Ingreso` == "T U U A NACIONAL")
TUUAN <- filter(TUUAN,Año %in% c(2020,2021,2022))
TUUAN <- select(TUUAN, -'Tipo Ingreso')
TUUAN <- select(TUUAN, -'Rubro Ingreso')
TUUAN <- select(TUUAN, -'Periodo')
```

```{r}
#Creación de variable de verificación para reemplazo de N/A's
DF <- merge(DF, TUUAN, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "TUUAN_VER" = "Importe por Servicios")
```

```{r}
DF <- merge(DF, TUUAN, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "TUUAN" = "Importe por Servicios")
```

```{r eval=TRUE}
DF$TUUAN_VER[is.na(DF$TUUAN_VER)] <- 0
DF$TUUAN_VER[DF$TUUAN_VER != 0] <- "Si"
DF$TUUAN_VER[DF$TUUAN_VER == "0"] <- "No"
DF$TUUAN[is.na(DF$TUUAN)] <- 0
#Reemplazo de N/A's por 0
```

Uniendo la variable Ingreso Rubro T U U A INTERNACIONAL (TUUAI)

```{r}
TUUAI <- filter(ITS, `Rubro Ingreso` == "T U U A INTERNACIONAL")
TUUAI <- filter(TUUAI,Año %in% c(2020,2021,2022))
TUUAI <- select(TUUAI, -'Tipo Ingreso')
TUUAI <- select(TUUAI, -'Rubro Ingreso')
TUUAI <- select(TUUAI, -'Periodo')
```

```{r}
DF <- merge(DF, TUUAI, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "TUUAI_VER" = "Importe por Servicios")#Creación de variable de verificación para reemplazo de N/A's
```

```{r}
DF <- merge(DF, TUUAI, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "TUUAI" = "Importe por Servicios")
```

```{r eval=TRUE}

DF$TUUAI_VER[is.na(DF$TUUAI_VER)] <- 0
DF$TUUAI_VER[DF$TUUAI_VER != 0] <- "Si"
DF$TUUAI_VER[DF$TUUAI_VER == "0"] <- "No"
DF$TUUAI[is.na(DF$TUUAI)] <- 0
#Reemplazo de N/A's por 0
```

Uniendo la variable Ingreso Rubro ATERRIZAJE Y DESPEGUE (IRAD)

```{r}
IRAD <- filter(ITS, `Rubro Ingreso` == "ATERRIZAJE Y DESPEGUE")
IRAD <- filter(IRAD,Año %in% c(2020,2021,2022))
IRAD <- select(IRAD, -'Tipo Ingreso')
IRAD <- select(IRAD, -'Rubro Ingreso')
IRAD <- select(IRAD, -'Periodo')
```

```{r}

DF <- merge(DF, IRAD, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "IRAD_VER" = "Importe por Servicios")
#Creación de variable de verificación para reemplazo de N/A's
```

```{r}
DF <- merge(DF, IRAD, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "IRAD" = "Importe por Servicios")
```

```{r eval=TRUE}

DF$IRAD_VER[is.na(DF$IRAD_VER)] <- 0
DF$IRAD_VER[DF$IRAD_VER != 0] <- "Si"
DF$IRAD_VER[DF$IRAD_VER == "0"] <- "No"
DF$IRAD[is.na(DF$IRAD)] <- 0
#Reemplazo de N/A's por 0
```

Uniendo la variable Ingreso Rubro ALQUILER AREAS DE MANTENIMIENTO (AADM)

```{r}
AADM <- filter(ITS, `Rubro Ingreso` == "ALQUILER AREAS DE MANTENIMIENTO")
AADM <- filter(AADM,Año %in% c(2020,2021,2022))
AADM <- select(AADM, -'Tipo Ingreso')
AADM <- select(AADM, -'Rubro Ingreso')
AADM <- select(AADM, -'Periodo')
```

```{r}

DF <- merge(DF, AADM, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "AADM_VER" = "Importe por Servicios")
#Creación de variable de verificación para reemplazo de N/A's
```

```{r}
DF <- merge(DF, AADM, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "AADM" = "Importe por Servicios")
```

```{r eval=TRUE}

DF$AADM_VER[is.na(DF$AADM_VER)] <- 0
DF$AADM_VER[DF$AADM_VER != 0] <- "Si"
DF$AADM_VER[DF$AADM_VER == "0"] <- "No"
DF$AADM[is.na(DF$AADM)] <- 0
#Reemplazo de N/A's por 0
```

Uniendo la variable Ingreso ALQUILER DE ESPACIOS PUBLICITARIOS (ADEP)

```{r}
ADEP <- filter(ITS, `Rubro Ingreso` == "ALQUILER DE ESPACIOS PUBLICITARIOS")
ADEP <- filter(ADEP,Año %in% c(2020,2021,2022))
ADEP <- select(ADEP, -'Tipo Ingreso')
ADEP <- select(ADEP, -'Rubro Ingreso')
ADEP <- select(ADEP, -'Periodo')
```

```{r}

DF <- merge(DF, ADEP, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "ADEP_VER" = "Importe por Servicios")
#Creación de variable de verificación para reemplazo de N/A's
```

```{r}
DF <- merge(DF, ADEP, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "ADEP" = "Importe por Servicios")
```

```{r eval=TRUE}

DF$ADEP_VER[is.na(DF$ADEP_VER)] <- 0
DF$ADEP_VER[DF$ADEP_VER != 0] <- "Si"
DF$ADEP_VER[DF$ADEP_VER == "0"] <- "No"
DF$ADEP[is.na(DF$ADEP)] <- 0
#Reemplazo de N/A's por 0
```

Uniendo la variable Ingreso ALQUILER LOCALES COMERCIALES (ALC)

```{r}
ALC <- filter(ITS, `Rubro Ingreso` == "ALQUILER LOCALES COMERCIALES")
ALC <- filter(ALC,Año %in% c(2020,2021,2022))
ALC <- select(ALC, -'Tipo Ingreso')
ALC <- select(ALC, -'Rubro Ingreso')
ALC <- select(ALC, -'Periodo')
```

```{r}

DF <- merge(DF, ALC, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "ALC_VER" = "Importe por Servicios")
#Creación de variable de verificación para reemplazo de N/A's 
```

```{r}
DF <- merge(DF, ALC, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "ALC" = "Importe por Servicios")
```

```{r eval=TRUE}

DF$ALC_VER[is.na(DF$ALC_VER)] <- 0
DF$ALC_VER[DF$ALC_VER != 0] <- "Si"
DF$ALC_VER[DF$ALC_VER == "0"] <- "No"
DF$ALC[is.na(DF$ALC)] <- 0
#Reemplazo de N/A's por 0
```

Uniendo la variable Ingreso Rubro ALQUILER OFICINAS OPERACIONES AEROLÍNEAS (AOOA)

```{r}
AOOA <- filter(ITS, `Rubro Ingreso` == "ALQUILER OFICINAS OPERACIONES AEROLÍNEAS")
AOOA <- filter(AOOA,Año %in% c(2020,2021,2022))
AOOA <- select(AOOA, -'Tipo Ingreso')
AOOA <- select(AOOA, -'Rubro Ingreso')
AOOA <- select(AOOA, -'Periodo')
```

```{r}

DF <- merge(DF, AOOA, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "AOOA_VER" = "Importe por Servicios")
#Creación de variable de verificación para reemplazo de N/A's 
```

```{r}
DF <- merge(DF, AOOA, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "AOOA" = "Importe por Servicios")
```

```{r eval=TRUE}
DF$AOOA_VER[is.na(DF$AOOA_VER)] <- 0
DF$AOOA_VER[DF$AOOA_VER != 0] <- "Si"
DF$AOOA_VER[DF$AOOA_VER == "0"] <- "No"
DF$AOOA[is.na(DF$AOOA)] <- 0
```

Uniendo la variable Ingreso Rubro ALQUILERES DE ALMACEN/HANGAR (ADAH)

```{r}
ADAH <- filter(ITS, `Rubro Ingreso` == "ALQUILERES DE ALMACEN/HANGAR")
ADAH <- filter(ADAH,Año %in% c(2020,2021,2022))
ADAH <- select(ADAH, -'Tipo Ingreso')
ADAH <- select(ADAH, -'Rubro Ingreso')
ADAH <- select(ADAH, -'Periodo')
```

```{r}

DF <- merge(DF, ADAH, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "ADAH_VER" = "Importe por Servicios")
#Creación de variable de verificación para reemplazo de N/A's 
```

```{r}
DF <- merge(DF, ADAH, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "ADAH" = "Importe por Servicios")
```

```{r eval=TRUE}
DF$ADAH_VER[is.na(DF$ADAH_VER)] <- 0
DF$ADAH_VER[DF$ADAH_VER != 0] <- "Si"
DF$ADAH_VER[DF$ADAH_VER == "0"] <- "No"
DF$ADAH[is.na(DF$ADAH)] <- 0
```

Uniendo la variable Ingreso Rubro ATENCIÓN EN HORAS EXTRAS (AEHE)

```{r}
AEHE <- filter(ITS, `Rubro Ingreso` == "ATENCIÓN EN HORAS EXTRAS")
AEHE <- filter(AEHE,Año %in% c(2020,2021,2022))
AEHE <- select(AEHE, -'Tipo Ingreso')
AEHE <- select(AEHE, -'Rubro Ingreso')
AEHE <- select(AEHE, -'Periodo')
```

```{r}

DF <- merge(DF, AEHE, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "AEHE_VER" = "Importe por Servicios")
#Creación de variable de verificación para reemplazo de N/A's 
```

```{r}
DF <- merge(DF, AEHE, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "AEHE" = "Importe por Servicios")
```

```{r eval=TRUE}
DF$AEHE_VER[is.na(DF$AEHE_VER)] <- 0
DF$AEHE_VER[DF$AEHE_VER != 0] <- "Si"
DF$AEHE_VER[DF$AEHE_VER == "0"] <- "No"
DF$AEHE[is.na(DF$AEHE)] <- 0
```

Uniendo la variable Ingreso Rubro ESTACIONAMIENTO AERONAVES (IREA)

```{r}
IREA <- filter(ITS, `Rubro Ingreso` == "ESTACIONAMIENTO AERONAVES")
IREA <- filter(IREA,Año %in% c(2020,2021,2022))
IREA <- select(IREA, -'Tipo Ingreso')
IREA <- select(IREA, -'Rubro Ingreso')
IREA <- select(IREA, -'Periodo')
```

```{r}

DF <- merge(DF, IREA, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "IREA_VER" = "Importe por Servicios")
#Creación de variable de verificación para reemplazo de N/A's 
```

```{r}
DF <- merge(DF, IREA, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "IREA" = "Importe por Servicios")
```

```{r eval=TRUE}
DF$IREA_VER[is.na(DF$IREA_VER)] <- 0
DF$IREA_VER[DF$IREA_VER != 0] <- "Si"
DF$IREA_VER[DF$IREA_VER == "0"] <- "No"
DF$IREA[is.na(DF$IREA)] <- 0
```

Uniendo la variable Ingreso Rubro INGRESOS FINANCIEROS (IRIF)

```{r}
IRIF <- filter(ITS, `Rubro Ingreso` == "INGRESOS FINANCIEROS")
IRIF <- filter(IRIF,Año %in% c(2020,2021,2022))
IRIF <- select(IRIF, -'Tipo Ingreso')
IRIF <- select(IRIF, -'Rubro Ingreso')
IRIF <- select(IRIF, -'Periodo')
```

```{r}

DF <- merge(DF, IRIF, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "IRIF_VER" = "Importe por Servicios")
#Creación de variable de verificación para reemplazo de N/A's 
```

```{r}
DF <- merge(DF, IRIF, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "IRIF" = "Importe por Servicios")
```

```{r eval=TRUE}
DF$IRIF_VER[is.na(DF$IRIF_VER)] <- 0
DF$IRIF_VER[DF$IRIF_VER != 0] <- "Si"
DF$IRIF_VER[DF$IRIF_VER == "0"] <- "No"
DF$IRIF[is.na(DF$IRIF)] <- 0
```

Uniendo la variable Ingreso Rubro REEMBOLSOS (IRR)

```{r}
IRR <- filter(ITS, `Rubro Ingreso` == "REEMBOLSOS")
IRR <- filter(IRR,Año %in% c(2020,2021,2022))
IRR <- select(IRR, -'Tipo Ingreso')
IRR <- select(IRR, -'Rubro Ingreso')
IRR <- select(IRR, -'Periodo')

IRR <- filter(IRR, `Importe por Servicios` != 0)
```

```{r}

DF <- merge(DF, IRR, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "IRR_VER" = "Importe por Servicios")
#Creación de variable de verificación para reemplazo de N/A's 
```

```{r}
DF <- merge(DF, IRR, by = c("Año","Mes","Aeropuerto","Infraestructura"), all=TRUE)
DF <- rename(DF, "IRR" = "Importe por Servicios")
```

```{r eval=TRUE}
DF$IRR_VER[is.na(DF$IRR_VER)] <- 0
DF$IRR_VER[DF$IRR_VER != 0] <- "Si"
DF$IRR_VER[DF$IRR_VER == "0"] <- "No"
DF$IRR[is.na(DF$IRR)] <- 0
```

Creando la variable Numero de Pasajeros totales (NP)

```{r}
DF %>% mutate(NP = NPN + NPI) -> DF
#Numero de pasajeros totales
```

Organizando el DF

```{r}
DF$Mes = factor(DF$Mes, levels =c("Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Setiembre","Octubre","Noviembre","Diciembre"))
DF <- arrange(DF, Año, Mes)
```

## Limpieza de datos

Si no se dispone del nombre del aeropuerto o de su infraestructura, la unidad muestral será excluida del análisis, ya que la información sobre los ingresos de un aeropuerto desconocido no es relevante y será eliminada.

```{r}

DF$Aeropuerto[DF$Aeropuerto == 'No precisa'] <- NA
DF$Aeropuerto[DF$Aeropuerto == '-'] <- NA
DF$Infraestructura[DF$Infraestructura == '-'] <- NA

DF <- filter(DF, Infraestructura != is.na("Infraestructura") & Aeropuerto != is.na("Aeropuerto"))
```

Cambiamos los nombres de la variable Infraestructura:

```{r}

DF %>% mutate("Infraestructura" =
                  ifelse(Infraestructura=="ADP", "Aeropuertos del Perú S.A.",
                  ifelse(Infraestructura=="AAP", "Aeropuertos Andinos del Perú S.A.",
                  ifelse(Infraestructura=="COR", "CORPAC S.A.",
                  ifelse(Infraestructura=="LAP", "Lima Airport Partners S.R.L.",Infraestructura))))) -> DF
```

Eliminamos las variables temporales:

```{r}
rm(list = c("AADM","ADAH","ADEP","AEHE","ALC","AOOA","IRAD","IREA","IRIF","ITS","PI","PN","TP","TUUAI","TUUAN","IRR"))
```

Para finalizar, Eliminaremos las observaciones con valores faltantes (NA's), lo que resultará en la exclusión de los aeropuertos de la infraestructura "CORPAC S.A." que no han reportado sus ingresos totales del análisis.

```{r}
DF <- drop_na(DF)
```

```{r}
sum(complete.cases(DF))
```

## Exportando la base de datos

```{r}
write_csv(DF,"BaseLimpiav2.csv")

```

# Importando la base datos limpia

```{r}

rm(list = ls())
library(readr)
library(plyr)
library(dplyr)
library(plotly)
library(tidyr)

DF <- read_csv("BaseLimpiav2.csv")
```

# Descriptores Numéricos y Gráficos

## Tabla de descriptores numéricos

```{r}
cv <- function(x){
    return(sd(x, na.rm=T)/mean(x, na.rm=T)*100)
}
```

```{r}
tabla <- data.frame(Variables = c('IT', 'NPN', 'NPI', 'TUUAN','TUUAI'),
                    Media = c(mean(DF$IT, na.rm=T), 
                              mean(DF$NPN, na.rm = T), 
                              mean(DF$NPI, na.rm= T),
                              mean(DF$TUUAN, na.rm= T),
                              mean(DF$TUUAI, na.rm= T)),
                    
                    Mediana = c(median(DF$IT, na.rm=T), 
                                median(DF$NPN, na.rm = T), 
                                median(DF$NPI, na.rm= T),
                                median(DF$TUUAN, na.rm = T), 
                                median(DF$TUUAI, na.rm= T)), 
                    
                    Desviacion = c(sd(DF$IT, na.rm=T), 
                                   sd(DF$NPN, na.rm = T), 
                                   sd(DF$NPI, na.rm= T), 
                                   sd(DF$TUUAN, na.rm = T), 
                                   sd(DF$TUUAI, na.rm= T)), 
                    
                    Varianza = c(var(DF$IT, na.rm = T), 
                                 var(DF$NPN, na.rm = T), 
                                 var(DF$NPI, na.rm = T), 
                                 var(DF$TUUAN, na.rm = T), 
                                 var(DF$TUUAI, na.rm = T)),
                    
                    RangoIntercuartil = c(IQR(DF$IT, na.rm = T), 
                                        IQR(DF$NPN, na.rm = T), 
                                        IQR(DF$NPI, na.rm = T), 
                                        IQR(DF$TUUAN, na.rm = T), 
                                        IQR(DF$TUUAI, na.rm = T)),
                    
                    CoeficienteVariacion = c(cv(DF$IT), 
                                 cv(DF$NPN), 
                                 cv(DF$NPI),
                                 cv(DF$NPN), 
                                 cv(DF$NPI)))
tabla
```

La tabla muestra que los datos de ingresos totales, número de pasajeros nacionales e internacionales tienen una alta dispersión y variación, con muchas variables mostrando una mediana y rango intercuartil de 0, lo que indica la ausencia de pasajeros internacionales en varios aeropuertos. Además, los coeficientes de variación son muy altos, especialmente en el caso del tráfico de usuarios de aerolíneas internacionales (TUUAI) que supera el 500%.

## Objetivo 1

Se realizará un coeficiente de correlación y un modelo lineal para cada variable en relación con los ingresos totales, lo que permitirá resumir la información de las 12 variables en un solo gráfico.

```{r}
coefcor <- c(1:12)

# TUUAN 
coefcor[1] <-cor(DF$IT, DF$TUUAN, use="complete.obs")

# TUUAI
coefcor[2] <-cor(DF$IT, DF$TUUAI, use="complete.obs")

# IRAD
coefcor[3] <-cor(DF$IT, DF$IRAD, use="complete.obs")


# AADM
coefcor[4] <-cor(DF$IT, DF$AADM, use="complete.obs")

# ADEP
coefcor[5] <-cor(DF$IT, DF$ADEP, use="complete.obs")

# ALC
coefcor[6] <-cor(DF$IT, DF$ALC, use="complete.obs")

# AOOA
coefcor[7] <-cor(DF$IT, DF$AOOA, use="complete.obs")


# ADAH
coefcor[8] <-cor(DF$IT, DF$ADAH, use="complete.obs")

# AEHE
coefcor[9] <-cor(DF$IT, DF$AEHE, use="complete.obs")


# IREA
coefcor[10] <-cor(DF$IT, DF$IREA, use="complete.obs")

# IRIF
coefcor[11] <-cor(DF$IT, DF$IRIF, use="complete.obs")

# IRR
coefcor[12] <-cor(DF$IT, DF$IRR, use="complete.obs")

```

Ahora se procederá a la revisión de los coeficientes de correlación, si estos tienen un número mayor a 0.75 o menor a -0.75 se considerará que tienen un modelo lineal válido.

```{r}
coefcor
```

Se encontró que los coeficientes de correlación de las variables 4, 5, 6, 7, 8, 9, 11 y 12 no cumplen con el criterio requerido, lo que indica que no tienen una correlación lineal con los ingresos totales y sus datos están dispersos. Sin embargo, se procederá a realizar y graficar los modelos lineales de las variables que presentan una buena correlación positiva con los ingresos totales. Esto tiene sentido, ya que a mayor cantidad de dinero en esos rubros, mayor será el ingreso total.

```{r}

pendientes <- c(1:4)
interceptos <- c(1:4)

# TUUAN 
modelo <- lm(DF$IT ~ DF$TUUAN, data=DF)
pendientes[1] <- as.numeric(modelo$coefficients[2])
interceptos[1] <- as.numeric(modelo$coefficients[1])


# TUUAI
modelo <- lm(DF$IT ~ DF$TUUAI, data=DF)
pendientes[2] <- as.numeric(modelo$coefficients[2])
interceptos[2] <- as.numeric(modelo$coefficients[1])


# IRAD
modelo <- lm(DF$IT ~ DF$IRAD, data=DF)
pendientes[3] <- as.numeric(modelo$coefficients[2])
interceptos[3] <- as.numeric(modelo$coefficients[1])

# IRIF
modelo <- lm(DF$IT ~ DF$IREA, data=DF)
pendientes[4] <- as.numeric(modelo$coefficients[2])
interceptos[4] <- as.numeric(modelo$coefficients[1])

```

```{r}
fig <- plot_ly(DF, x = ~TUUAN, y = ~IT, 
               type = "scatter", 
               mode = "markers",
               name="TUUAN",
               marker = list(color = '#ef476f')
               ) %>%
        add_trace(x = ~c(-interceptos[1]/pendientes[1],9000000), y = c(0,pendientes[1]*9000000+interceptos[1]), 
               type = "scatter",
               mode = "lines",
               name="TUUAN-model",
               marker = list(color = '#ef476f')
               ) %>%
        add_trace(DF, x = ~TUUAI, y = ~IT, 
                  type = "scatter", 
                  mode = "markers",
                  name="TUUAI",
                  marker = list(color = '#ffd166')
                  ) %>%
        add_trace(x = ~c(-interceptos[2]/pendientes[2],9000000), y = c(0,pendientes[2]*9000000+interceptos[2]), 
                  type = "scatter", 
                  mode = "lines",
                  name="TUUAI-model",
                  marker = list(color = '#ffd166')
                  ) %>%
        add_trace(DF, x = ~IRAD, y = ~IT, 
                  type = "scatter", 
                  mode = "markers",
                  name="IRAD",
                  marker = list(color = '#06d6a0')
                  ) %>%
        add_trace(x = ~c(-interceptos[3]/pendientes[3],9000000), y = c(0,pendientes[3]*9000000+interceptos[3]), 
                  type = "scatter", 
                  mode = "lines",
                  name="IRAD-model",
                  marker = list(color = '#06d6a0')
                  ) %>%
        add_trace(DF, x= ~IREA, y = ~IT, 
                  type="scatter", 
                  mode="markers",
                  name="IREA",
                  marker = list(color = '#118ab2')
                  ) %>%
        add_trace(x = ~c(-interceptos[4]/pendientes[4],9000000), y = c(0,pendientes[4]*9000000+interceptos[4]), 
                  type="scatter", 
                  mode="lines",
                  name="IREA-model",
                  marker = list(color = '#118ab2')
                  ) %>%
        layout(xaxis = list( title = "Ingresos US$"),
        yaxis = list( title = "Ingresos totales US$"))


fig
    
```

El análisis de los gráficos interactivos revela que el modelo de regresión lineal para el rubro IREA no se ajusta correctamente a los datos, a pesar de tener un coeficiente de correlación superior a 0.75. Esto demuestra que el coeficiente de correlación lineal no es el único factor a considerar al construir un modelo de regresión lineal. Sin embargo, al dejar de lado a IREA, se observa que los modelos y los datos de TUUAN, TUUAI e IRAD se ajustan bastante bien, destacando IRAD como el rubro con la mayor pendiente. Por lo tanto, se concluye que la mayor parte de los ingresos totales dependen de los ingresos generados por los servicios de aterrizaje y despegue.

## Objetivo 2

```{r}

plot(DF$IREA, DF$IT, xlab = "Numero de pasajeros (miles)", ylab = "Ingresos totales (millones de US$)", col="darkgreen", pch="•")
abline(a=interceptos[4], b= pendientes[4])


```

```{r}
library(plotly)

fig <- plot_ly(DF, y = ~IT, x = ~IREA, type = "scatter", mode = "markers") %>%
  layout(xaxis = list(title = "IREA"), yaxis = list(title = "Ingresos totales US$"))

fig

    
```

### Numero de Pasajeros vs Ingresos Totales

```{r}
plot(DF$NP/1000, DF$IT/1000000, xlab = "Numero de pasajeros (miles)", ylab = "Ingresos totales (millones de US$)", col="darkgreen", pch="•", xlim = c(0,2000))

```

Comenzamos comparando el numero de pasajeros en miles totales, suma de pasajeros internacionales y nacionales, con los ingresos totales de cada aeropuerto en determinado mes y año en millones de dolares. A simple vista se puede ver un cierto tipo de relación lineal, sin embargo tenemos que comprobarlo. Usaremos el coeficiente de correlación ya que este no toma en cuenta la escala de las unidades, perfecto para nuestro estudio.

```{r}
cor(DF$IT, DF$NP, use="complete.obs")
```

Con la información suministrada del coeficiente de correlación se deduce que la relación lineal entre el numero de pasajeros y los ingresos totales es buena, casi perfecta y ascendente. Es decir los ingresos totales aumentaran en cuanto aumente el numero de pasajeros.

Ahora crearemos un modelo de regresión lineal.

```{r}

modelo = lm(DF$IT ~ DF$NP, data=DF)
modelo

d <- data.frame("X"=DF$NP/1000, "Y"=DF$IT/1000000)
modelo = lm(d$Y ~ d$X, data=d)
modelo
```

Creamos dos modelos que utilizan diferentes escalas (número de pasajeros e ingresos totales en dólares vs. número de pasajeros en miles e ingresos totales en millones de dólares) para aproximar y predecir los ingresos totales de un aeropuerto en función de la cantidad de pasajeros.

```{r}
plot(DF$NP/1000, DF$IT/1000000, xlab = "Numero de pasajeros (miles)", ylab = "Ingresos totales (millones de US$)", col="darkgreen", pch="•", xlim = c(0,2000))
abline(a= -0.14890, b=0.01646, col="green")
```

### Numero de Pasajeros Nacionales e Internacionales vs Ingresos Totales

```{r}
par(mfrow=c(1,2))

plot(DF$NPN/1000, DF$IT/1000000, xlab = "Numero de pasajeros nacionales (miles)", ylab = "Ingresos totales (millones de US$)", col="red", pch="•")

plot(DF$NPI/1000, DF$IT/1000000, xlab = "Numero de pasajeros internacionales (miles)", ylab = "Ingresos totales (millones de US$)", col="blue", pch="•")
```

Ahora vamos a analizar la relación de los tipos de pasajeros con los ingresos totales. De nuevo usaremos el coeficiente de correlación tanto para los pasajeros nacionales como internacionales.

```{r}
cor(DF$IT, DF$NPN, use="complete.obs")
cor(DF$IT, DF$NPI, use="complete.obs")
```

Los coeficientes de correlación revelan que tanto los pasajeros nacionales como los pasajeros internacionales tienen una relación lineal positiva ascendente con los ingresos totales. Sin embargo, ambos coeficientes son menores que el coeficiente de correlación de los pasajeros totales con los ingresos totales, lo que indica que utilizar solo los pasajeros nacionales o internacionales para estimar los ingresos totales resultaría en una menor precisión que si se utilizara la suma de ambos. Además, el coeficiente de correlación de los pasajeros internacionales es ligeramente superior al de los pasajeros nacionales, lo que sugiere una relación lineal más fuerte y más acorde con los ingresos totales.

Ahora construyamos los modelos de regresión lineal para cada uno.

```{r}

modelo = lm(DF$IT ~ DF$NPN, data=DF)
modelo

d <- data.frame("X"=DF$NPN/1000, "Y"=DF$IT/1000000)
modelo = lm(d$Y ~ d$X, data=d)
modelo

modelo = lm(DF$IT ~ DF$NPI, data=DF)
modelo

d <- data.frame("X"=DF$NPI/1000, "Y"=DF$IT/1000000)
modelo = lm(d$Y ~ d$X, data=d)
modelo

rm(d)
```

Vemos que los modelos difieren en una cantidad considerable en cuanto a su pendiente, sin embargo, su intercepto es bastante similar, vamos a graficar estos modelos.

```{r}
par(mfrow=c(1,2))

plot(DF$NPN/1000, DF$IT/1000000, xlab = "Numero de pasajeros nacionales (miles)", ylab = "Ingresos totales (millones de US$)", col="red", pch="•")
abline(a= -0.36033, b=0.02451, col="#f72585")

plot(DF$NPI/1000, DF$IT/1000000, xlab = "Numero de pasajeros internacionales (miles)", ylab = "Ingresos totales (millones de US$)", col="blue", pch="•")
abline(a= 0.31996, b=0.04772, col="#0077b6")
```

## Objetivo 3

Para averiguar cual es el aeropuerto que mayor tráfico y el aeropuerto que mayores ingresos genera en el Perú en los años (2020, 2021 y 2022), analizaremos la distribución de Ingresos Totales planteando gráficos y relaciones.

### Analizando la distribución de Ingresos Totales

```{r}
plot_ly(x = ~DF$IT/1000000,
        type="histogram",
        color = ~DF$Infraestructura,
        nbinsx = 40
        )%>%
layout(yaxis = list( title = "Frecuencia" ),
    xaxis = list( title = "Ingresos totales (Millones de US$)",
                  nticks = 20))
```

Gracias al histograma se dice que los datos de los ingresos totales son totalmente asimétricos y se encuentran acumulados en un intervalo de 0 - 0.8 millones de dolares. Es decir la mayoría de aeropuertos determinados en cierto mes y cierto año posee unos ingresos totales de entre 0 y 0.8 millones de dolares. Esto puede ocurrir debido a datos atípicos, construyamos un Boxplot para que nos ayude.

```{r}
plot_ly(DF, x=~DF$IT/1000000,
            type = "box")%>%
layout(
    xaxis = list( title = "Ingresos totales (Millones de US$)"))
```

Usando un Boxplot simple se comprueba como los datos de los ingresos totales están demasiado dispersos gracias a cierta cantidad de datos atípicos. Ahora es necesario averiguar de donde provienen estos datos atípicos y que nos quieren decir. Para ello crearemos diferentes Boxplots basados en meses, infraestructuras y aeropuertos.

```{r}
plot_ly(DF, x = ~IT/1000000, 
        y = ~Mes, 
        color= ~Mes, 
        type="box") %>%
layout(yaxis = list( title = "Mes"),
    xaxis = list( title = "Ingresos totales (Millones de US$)"))
```

Con este gráfico podemos descartar que los datos atípicos provengan de un o varios meses en específico.

```{r}
plot_ly(DF, x = ~IT/1000000, 
        y = ~Infraestructura, 
        color= ~Infraestructura, 
        type="box") %>%
layout(yaxis = list( title = "Infraestructura"),
    xaxis = list( title = "Ingresos totales (Millones de US$)"))
```

En el gráfico, se destaca que Lima Airport Partners S.R.L tiene ingresos totales significativamente más altos que otras infraestructuras, lo que indica que la mayoría de los datos atípicos en términos de ingresos provienen de esa infraestructura. Además, se menciona que la infraestructura COR no aparece en el gráfico debido a que no ha declarado ingresos totales. Al analizar los boxplots de cada infraestructura, se observa que el de Lima Airport Partners S.R.L no tiene datos atípicos, mientras que Aeropuertos del Perú S.A tiene muchos datos atípicos por encima de la mediana y Aeropuertos Andinos del Perú S.A muestra datos inferiores similares en el 25% inferior y datos atípicos por encima de la mediana.

```{r}
plot_ly(DF, x = ~IT/1000000, 
        y = ~Aeropuerto, 
        color= ~Aeropuerto, 
        type="box"
        ) %>%
layout(yaxis = list( title = "Aeropuertos"),
    xaxis = list( title = "Ingresos totales (Millones de US$)"))
```

En resumen, los tres gráficos nos permiten concluir que el aeropuerto de Lima, administrado por Lima Airport Partners (LAP), es responsable de los datos atípicos y genera los ingresos totales más altos. Al aislar el boxplot de los ingresos totales de este aeropuerto, se observa la presencia de datos por debajo de la mediana, aunque su valor mínimo se acerca al cuartil inferior (25%). Es importante destacar que la infraestructura LAP se refiere al Aeropuerto Internacional Jorge Chávez, ubicado en Lima, Perú, lo que indica que este aeropuerto es el que genera mayores ingresos en el país.Numero de Pasajeros vs Aeropuertos

```{r}
plot_ly(DF,y = ~NP/1000,
        x = ~as.factor(Aeropuerto), 
        type="bar",
        marker = list(color=c("lightblue"))
        )%>%
    layout(xaxis = list( title = "Aeropuertos"),
    yaxis = list( title = "Numero de pasajeros (miles)"))
```

Con esta gráfico se corrobora que el Aeropuerto de Lima (Aeropuerto Internacional Jorge Chávez) genera la mayor cantidad de ingresos y además recibe a la mayor cantidad de pasajeros respecto al resto del Perú. Otros aeropuertos notables son Cusco, Arequipa e Iquitos donde Cusco es el que más pasajeros recibe fuera de Lima. Se procede a dibujar el numero de pasajeros, los ingresos totales y los aeropuertos.

```{r}
plot_ly(DF,x = ~NP/1000,
        y = ~IT/1000000, 
        type="scatter",
        color = ~as.factor(Aeropuerto)
        )
```

El gráfico nos deja en claro la estrecha relación de la cantidad de pasajeros con la de ingresos que posee el aeropuerto de Lima y como este sobresale por mucho del resto de aeropuertos. Se concluye que los datos atípicos provenientes de ingresos totales eran y nos contaban sobre las peculiaridades del caso Lima.

### Ingresos T U U A Total vs Ingresos Totales

Se eligió la comparación de las T U U A, porque esta es la TARIFA UNIFICADA POR USO DE AEROPUERTO, es decir es una tarifa que como consumidores debemos de pagar. El objetivo aquí es analizar cuanto de los ingresos totales provienen directamente de los bolsillos de los pasajeros.

```{r}
plot((DF$TUUAN/1000000 + DF$TUUAI/1000000), DF$IT/1000000, xlab = "Ingresos TUUA (millones de US$)", ylab = "Ingresos totales (millones de US$)", col="#926c15", pch="•")

```

Comenzamos comparando el numero de pasajeros en miles totales, suma de pasajeros internacionales y nacionales, con los ingresos totales de cada aeropuerto en determinado mes y año en millones de dolares. A simple vista se puede ver un cierto tipo de relación lineal, sin embargo tenemos que comprobarlo. Usaremos el coeficiente de correlación ya que este no toma en cuenta la escala de las unidades, perfecto para nuestro estudio.

```{r}
cor(DF$IT, DF$TUUAI + DF$TUUAN, use="complete.obs")
```

Tenemos un coeficiente de correlación que esta muy próximo a 1, es decir esta relación es casi perfectamente lineal y con tendencia ascendente.

Ahora crearemos un modelo de regresión lineal.

```{r}
TUUA <- DF$TUUAI+DF$TUUAN
modelo = lm(DF$IT ~ TUUA, data=DF)
modelo

d <- data.frame("X"= (DF$TUUAI + DF$TUUAN)/100000, "Y"=DF$IT/1000000)
modelo = lm(d$Y ~ d$X, data=d)
modelo

rm(d)
```

Del modelo creado se obtiene el intercepto, es decir cuando la TUUA valdrá cero y la pendiente, en este caso es relativamente baja pero ascendente.

```{r}
plot((DF$TUUAN+DF$TUUAI)/100000, DF$IT/1000000, xlab = "Ingresos TUUA total (millones de US$)", ylab = "Ingresos totales (millones de US$)", col="#926c15", pch="•")
abline(a= 0.1557, b=0.2190, col="#c9a227")
```

Detallamos entonces que los ingresos totales guardan una alta relación con los ingresos generados por las TUUA y dependen en gran medida de estas, ergo la cantidad de pasajeros.

## Objetivo 4

Ahora haremos un análisis de la pandemia y pos-pandemia de los ingresos totales en los aeropuertos del Perú en los años (2020,2021 y 2022)

### Pandemia vs Pos-pandemia

```{r}
DF2020 <- filter(DF, DF$Año=="2020")
DF2021 <- filter(DF, DF$Año=="2021")
DF2022 <- filter(DF, DF$Año=="2022")

DF2020 %>% group_by(Mes,Año) %>% summarise(IT = sum(IT, na.rm=TRUE), NP = sum(NP, na.rm = TRUE)) -> DF2020

DF2021 %>% group_by(Mes,Año) %>% summarise(IT = sum(IT, na.rm=TRUE), NP = sum(NP, na.rm = TRUE)) -> DF2021
                                           
DF2022 %>% group_by(Mes,Año) %>% summarise(IT = sum(IT, na.rm=TRUE), NP = sum(NP, na.rm = TRUE)) -> DF2022


```

```{r}
plot_ly(y = ~DF2020$IT/1000000,
        x = ~DF2020$Mes, 
        type="bar",
        name="2020",
        marker = list(color = '#57cc99')
        )%>% 

    
    add_trace(y = ~DF2021$IT/1000000,
        x = ~DF2021$Mes, 
        type="bar",
        name="2021",
        marker = list(color = '#38a3a5')
        )%>%
    
    
    add_trace(y = ~DF2022$IT/1000000,
        x = ~DF2022$Mes, 
        type="bar",
        name="2022",
        marker = list(color = '#22577a')
        )%>%
    
    
    layout(xaxis = list( title = "Meses"),
    yaxis = list( title = "Ingresos totales (Millones de US$)",
    nticks = 10,
    range = list(0,45)),
    
    barmode="group")
```

Del gráfico de barras podemos observar:

-   La distribución de los ingresos totales en base a los meses del año.

-   Existe una asimetria notable entre los datos en el año 2020. Esta asimetria se explica por el surgimiento del Covid-19. Los ingresos bajaron bastante en proporción a la media.

-   Un patrón de crecimiento sobre los ingresos totales dependiendo de los meses. En algunos meses los ingresos totales son esperado a ser mayores que en otros meses, uno de los factores que pueden influir en esto son las vacaciones pues están estrechamente relacionas con el número de pasajeros a abordar en un aeropuerto.

```{r}

plot_ly() %>%
    add_trace(y = ~DF2020$IT/1000000,
        x = ~DF2020$Mes, 
        type="scatter",
        mode="lines+markers",
        name="2020",
        marker = list(color = '#57cc99'),
        line = list(color = '#57cc99'),
        fill = "tonexty",
        fillcolor = 'rgba(197,237,211,0.3)'
        )%>%
    add_trace(DF2021, y = ~DF2021$IT/1000000,
        x = ~DF2021$Mes, 
        type="scatter",
        mode="lines+markers",
        name="2021",
        marker = list(color = '#38a3a5'),
        line = list(color = '#38a3a5'),
        fill = "tonexty",
        fillcolor = 'rgba(106,166,169,0.3)'
        )%>%
    add_trace(y = ~DF2022$IT/1000000,
        x = ~DF2022$Mes, 
        type="scatter",
        mode="lines+markers",
        name="2022",
        marker = list(color = '#22577a'),
        line = list(color = '#22577a'),
        fill = "tonexty",
        fillcolor = 'rgba(68,102,122,0.3)'
        )%>%
    
    layout(xaxis = list( title = "Meses"),
           title = "Evolutivo Ingresos",
    yaxis = list( title = "Ingresos totales (Millones de US$)", 
                  range = list(0,45))
    )

```

Del gráfico de barras, se observa lo siguiente: la distribución de los ingresos totales según los meses del año, una notoria asimetría en los datos durante el año 2020 debido al impacto del Covid-19 con una disminución significativa de los ingresos en comparación con la media, y un patrón de crecimiento en los ingresos totales que varía según los meses, posiblemente influenciado por factores como las vacaciones y la cantidad de pasajeros que utilizan el aeropuerto.

```{r}
plot_ly() %>%
    add_trace(y = ~DF2020$NP/1000,
        x = ~DF2020$Mes, 
        type="scatter",
        mode="lines+markers",
        name="2020",
        marker = list(color = '#E09F3E'),
        line = list(color = '#E09F3E'),
        fill = "tonexty",
        fillcolor = 'rgba(225,183,123,0.3)'
        )%>%
    add_trace(DF2021, y = ~DF2021$NP/1000,
        x = ~DF2021$Mes, 
        type="scatter",
        mode="lines+markers",
        name="2021",
        marker = list(color = '#9E2A2B'),
        line = list(color = '#9E2A2B'),
        fill = "tonexty",
        fillcolor = 'rgba(158,72,74,0.3)'
        )%>%
    add_trace(y = ~DF2022$NP/1000,
        x = ~DF2022$Mes, 
        type="scatter",
        mode="lines+markers",
        name="2022",
        marker = list(color = '#540B0E'),
        line = list(color = '#540B0E'),
        fill = "tonexty",
        fillcolor = 'rgba(87,45,47,0.3)'
        )%>%
    
    layout(xaxis = list( title = "Meses"),
           title = "Evolutivo Pasajeros",
    yaxis = list( title = "Numero de Pasajeros (Miles)"))
```

De los gráficos evolutivos podemos apreciar:

-   En los gráficos evolutivos, se observa que los ingresos totales experimentaron una caída drástica a partir de febrero de 2020, coincidiendo con la aparición del Covid-19 en Perú y la implementación de medidas de confinamiento. Esta reducción se refleja también en el número de pasajeros, que se acerca a cero durante ese periodo. La recuperación de los ingresos totales fue lenta, tomando 2 años y 5 meses para volver a niveles similares a los de febrero de 2020.

    ```{r}

    round(100 - ((filter(DF2020, Mes == "Abril")$IT/1000000 )/( filter(DF2020, Mes == "Febrero")$IT/1000000) * 100) ,2)

    round( - filter(DF2020, Mes == "Abril")$IT/1000000  + filter(DF2020,Mes == "Febrero")$IT/1000000, 2)
    ```

-   En abril de 2020, los ingresos totales tuvieron una pérdida del 86.68% en comparación con febrero de 2020, representando una diferencia de aproximadamente 31.76 millones de dólares. A partir de abril de 2020, los ingresos se estabilizaron a niveles bajos pero con una tendencia ascendente en los años 2021 y 2022, a medida que se levantaron las restricciones de confinamiento, se controló la pandemia y el número de pasajeros aumentó.

# Analisis Probablisticos

## Probabilidad Empirica

-   **Variable Ingresos Totales:**

    Partiendo de la variable de "ingresos totales" (TI) la cual es numérica y continua. 

    Se puede crear el siguiente experimento: De un estudio de análisis de los ingresos de los aeropuertos peruanos, determinar el nivel de ingreso para cada declaración mensual de ingreso total de los aeropuertos del Perú, del año 2020 al 2022.

    Debido a que en la base de datos no se tienen variables que sean ordinales, hemos creado intervalos de valores para agrupar el nivel de los ingresos.

    Los valores posibles en este experimento son: 0, 1, 2 y 3. 

    Donde:

    **0** representa un nivel de ingresos nulo, es decir, no tiene ingresos en esa declaración.

    **1** representa un nivel de ingresos bajo, el cuál está dado por el rango mayor a 0 y menor o igual a 11 000 000.

    **2** representa un nivel de ingresos medio, el cuál está dado por el rango mayor a 11 000 000 y menor o igual a 22 000 000.

    **3** representa un nivel de ingresos alto, el cuál está dado por el rango mayor a 22 000 000.

    Los rangos fueron obtenidos diviendo entre 3 la suma entre el mínimo y el máximo, para luego aproximarlo al número entero y múltiplo de 1000.

    Entonces, los eventos creados serán:

    **I0**, es el evento donde al seleccionar una declaración de ingresos mensuales, este debe tener un nivel de ingresos nulo, igual a 0.

    **I1**, es el evento donde al seleccionar una declaración de ingresos mensuales, este debe tener un nivel de ingresos bajo, dentro del rango de 0 a 11 000 000 dólares.

    **I2**, es el evento donde al seleccionar una declaración de ingresos mensuales, este debe tener un nivel de ingresos medio, dentro del rango de 11 000 000 a 22 000 000 dólares.

    **I3**, es el evento donde al seleccionar una declaración de ingresos mensuales, este debe tener un nivel de ingresos alto, dentro del rango donde los números son mayor a 22 000 000 dólares.

```{r}
n_total <- nrow(DF)

# Ingresos nulos
I0_freq <- nrow(DF[DF$IT == 0, ])

# Ingresos bajos
I1_freq <- nrow(DF[DF$IT > 0 & DF$IT <= 11000000, ])

# Ingresos medios
I2_freq <- nrow(DF[DF$IT > 11000000 & DF$IT <= 22000000, ])

# Ingresos altos
I3_freq <- nrow(DF[DF$IT > 22000000, ])

```

Para esto hay que saber el total de la población, luego obtener la frecuencia y por último, obtener la probabilidad de éxito p. Como se ve a continuación:

```{r}

# Probabilidad de ingresos nulos
p_I0 <- I0_freq / n_total
print(paste("La probabilidad de que un aeropuerto tenga ingresos nulos es", p_I0))

# Probabilidad de ingresos bajos
p_I1 <- I1_freq / n_total
print(paste("La probabilidad de que un aeropuerto tenga ingresos bajos (0 - 11,000,000) es", p_I1))

# Probabilidad de ingresos medios
p_I2 <- I2_freq / n_total
print(paste("La probabilidad de que un aeropuerto tenga ingresos medios (11,000,001 - 22,000,000) es", p_I2))

# Probabilidad de ingresos altos
p_I3 <- I3_freq / n_total
print(paste("La probabilidad de que un aeropuerto tenga ingresos altos (>22,000,000) es", p_I3))
```

Con esto podemos concluir que, la mayor probabilidad al momento de elegir al azar un aeropuerto, se la lleva los aeropuertos con ingresos totales bajos, por otro lado, tambien los aeropuertos con ingresos totales nulos ocupan una gran probabilidad y frecuencia, esto se puede deber al fin de operación en los aeropuertos de la provincias.

-   **Variable Número Pasajeros Nacionales:**

    Continuando con la probabilidad empírica, otra variable relevante para nuestro proyecto es el flujo de pasajeros en los aeropuertos, debido a observaciones mas completas se hará uso del número de pasajeros nacionales. Entonces la variable, numérica y discreta, de número de pasajeros nacionales, nos puede ayudar a realizar el siguiente experimento:

    En el mismo estudio sobre los ingresos de los aeropuertos, ahora se desea saber la afluencia de pasajeros nacionales según cada declaración mensual de los aeropuertos del Perú entre los años 2020 y 2022. 

    De la misma manera que los ingresos al no tener variables ordinales, debemos crear intervalos que sean considerados como escalas, por ello los posibles resultados para el experimento son 0, 1, 2, 3. 

    Donde:

    **0** representa un nivel de afluencia nulo, es decir, no se tuvo pasajeros nacionales en ese mes.

    **1** representa un nivel de afluencia  bajo, el cuál está dado por el rango mayor a 0 y menor o igual a 390 000.

    **2** representa un nivel de afluencia  medio, el cuál está dado por el rango mayor a 390 000 y menor o igual a 780 000.

    **3** representa un nivel de afluencia  alto, el cuál está dado por el rango mayor a 780 000.

    Tal como en lo anterior, los rangos fueron obtenidos diviendo entre 3 la suma entre el mínimo y el máximo, para luego aproximarlo al número entero y múltiplo de 1000.

    Entonces, los eventos creados serán:

    **NP0**, es el evento donde al seleccionar una declaración mensual aleatoriamente, este debe tener un nivel de afluencia nulo, igual a 0.

    **NP1**, es el evento donde al seleccionar una declaración mensual aleatoriamente, este debe tener un nivel de afluencia bajo, dentro del rango de 0 a  390 000 pasajeros nacionales.

    ```{r}
    # Fluencia de pasajeros nula
    NP0_freq <- nrow(datos[datos$NPN == 0, ])

    # Fluencia de pasajeros baja
    NP1_freq <- nrow(datos[datos$NPN > 0 & datos$NPN <= 390000, ])

    # Fluencia de pasajeros media
    NP2_freq <- nrow(datos[datos$NPN > 390000 & datos$NPN <= 780000, ])

    # Fluencia de pasajeros alta
    NP3_freq <- nrow(datos[datos$NPN > 780000, ])
    ```

    Ahora para cada evento se determinará la probabilidad, de la misma manera que en la variable anterior, se muestra a continuación:

    ```{r}
    # Probabilidad de fluencia de pasajeros nula
    p_NP0 <- NP0_freq / n_total
    print(paste("La probabilidad de que un aeropuerto tenga fluencia de pasajeros nula es", p_NP0))

    # Probabilidad de fluencia de pasajeros baja
    p_NP1 <- NP1_freq / n_total
    print(paste("La probabilidad de que un aeropuerto tenga fluencia de pasajeros media (0 - 390,000) es", p_NP1))

    # Probabilidad de fluencia de pasajeros media
    p_NP2 <- NP2_freq / n_total
    print(paste("La probabilidad de que un aeropuerto tenga fluencia de pasajeros media (390,001 - 780,000) es", p_NP2))

    # Probabilidad de fluencia de pasajeros alta
    p_NP3 <- NP3_freq / n_total
    print(paste("La probabilidad de que un aeropuerto tenga fluencia de pasajeros alta (>780,000) es", p_NP3))
    ```

    Similar a lo sucedido con la variable de Ingresos Totales, esta variable tiene una gran probabilidad en la fluencia de pasajeros bajos, seguida de la afluencia de pasajeros nula. De igual manera, puede sustentarse por el cierre de los aeropuertos pequeños y mayor posicionamiento de las grandes aerolíneas en las provincias principales.

## Probabilidad Condicional

```{r}
r <- function(x){
     return(round(x,digits=2))}
r2 <- function(x){
     return(round(x,digits=5))}
```

**1)**

A = Seleccionar un aeropuerto cuyos ingresos totales en un mes sean mayores a 100 000 dólares.

B = Seleccionar un aeropuerto que cuente con ingresos por el alquiler de locales comerciales.

Creamos una tabla:

```{r}
T1TT <- as.numeric(length(which(DF$IT > 100000 & DF$ALC_VER == "Si")))
T1TF <- as.numeric(length(which(DF$IT > 100000 & DF$ALC_VER == "No")))
T1FT <- as.numeric(length(which(DF$IT <= 100000 & DF$ALC_VER == "Si")))
T1FF <- as.numeric(length(which(DF$IT <= 100000 & DF$ALC_VER == "No")))

tab1 <- matrix(c(r2(T1TT),r2(T1TF),r2(T1TT+T1TF),r2(T1FT),r2(T1FF),r2(T1FT+T1FF),r2(T1TT+T1FT),r2(T1TF+T1FF),T1TT+T1TF+T1FT+T1FF), ncol=3, byrow=TRUE)
colnames(tab1) <- c('A > 100k', ' A <= 100k ', '     ')
rownames(tab1) <- c('B == Si ', 'B == No', ' ')
tab1 <- as.table(tab1)
tab1
```

Validamos la independencia de las 2 variables:

$$P(A\cap B) = P(A)P(B)$$

```{r}
342/753
(508/753)*(416/753)
```

$$P(A\setminus B) = P(A)$$

```{r}
342/416
508/753
```

Debido a que no se cumplen es una variable dependiente.

Aplicar diagrama de Bayes:

![](https://uploads.disquscdn.com/images/5ff8dc25f16c95a3d56bdc91bed9e1dd61e3ae17971a845bcee49d1f5c7242d1.png){fig-align="center"}

$$P(B\setminus A) = \frac{P(A\setminus B)P(B)}{P(A)}$$

```{r}
(342/416)*(416/753)/((342/416)*(416/753)+(166/416)*(416/753))
```

**2)**

A = Seleccionar un aeropuerto que obtenga ingresos por alquiler de áreas de mantenimiento.

B = Seleccionar un aeropuerto que cuente con ingresos por reembolsos.

Creamos una tabla:

```{r}
T2TT <- as.numeric(length(which(DF$AADM_VER == "Si" & DF$IRR_VER == "Si")))
T2TF <- as.numeric(length(which(DF$AADM_VER == "Si" & DF$IRR_VER == "No")))
T2FT <- as.numeric(length(which(DF$AADM_VER == "No" & DF$IRR_VER == "Si")))
T2FF <- as.numeric(length(which(DF$AADM_VER == "No" & DF$IRR_VER == "No")))

tab2 <- matrix(c(r2(T2TT),r2(T2TF),r2(T2TT+T2TF),r2(T2FT),r2(T2FF),r2(T2FT+T2FF),r2(T2TT+T2FT),r2(T2TF+T2FF),T2TT+T2TF+T2FT+T2FF), ncol=3, byrow=TRUE)
colnames(tab2) <- c('A == Si', ' A == No ', '     ')
rownames(tab2) <- c('B == Si ', 'B == No', ' ')
tab2 <- as.table(tab2)
tab2
```

Validamos la independencia de las 2 variables:

$$
P(A\cap B) = P(A)P(B)
$$

```{r}
6/753
(428/753)*(29/753)
```

$$P(A\setminus B) = P(A)$$

```{r}
6/29
428/753
```

Debido a que no se cumplen, es una variable independiente.

Aplicar diagrama de Bayes:

![](https://uploads.disquscdn.com/images/beef81c2e5bcb0fee9cb6553e32ddaaa53f04bf7c0d450a009d4647173339c17.png){fig-align="center"}

$$P(B\setminus A) = \frac{P(A\setminus B)P(B)}{P(A)}$$

```{r}
(6/29)*(29/753)/((6/29)*(29/753)+(422/29)*(29/753))
```

## Modelos Probabilisticos Discretos

### Distribución Binomial

```{r}
# Creamos una nueva variable que indica si un aeropuerto tuvo ingresos
DF$tuvo_ingresos <- ifelse(DF$IT > 0, 1, 0)

# Calculamos el número total de aeropuertos
num_total_aeropuertos <- nrow(DF)

# Calculamos el número de aeropuertos que tuvieron ingresos
num_aeropuertos_con_ingresos <- sum(DF$tuvo_ingresos)

# Calculamos la probabilidad de éxito (p)
p <- num_aeropuertos_con_ingresos / num_total_aeropuertos

# Calculamos la probabilidad de fracaso (q)
q <- 1 - p


print(paste("Número total de aeropuertos:", num_total_aeropuertos))
print(paste("Número de aeropuertos con ingresos:", num_aeropuertos_con_ingresos))
print(paste("Probabilidad de éxito (p):", p))
print(paste("Probabilidad de fracaso (q):", q))
```

### Distribución Geométrica:

```{r}
# Listas de aeropuertos por región
aeropuertos_costa <- c("Lima", "Chiclayo", "Pisco", "Piura", "Tacna", "Talara", "Trujillo", "Tumbes", "Ayacucho")
aeropuertos_sierra <- c("Andahuaylas", "Arequipa", "Cajamarca", "Chachapoyas", "Huaraz-Anta", "Juliaca", "Cusco")
aeropuertos_selva <- c("Iquitos", "Pucallpa", "Puerto Maldonado", "Tarapoto")

# Asumimos que el dataframe se llama 'datos', si tiene un nombre diferente, cambia 'datos' por el nombre correcto.
DF <- DF %>%
  mutate(Region = case_when(
    Aeropuerto %in% aeropuertos_costa ~ "Costa",
    Aeropuerto %in% aeropuertos_sierra ~ "Sierra",
    Aeropuerto %in% aeropuertos_selva ~ "Selva",
    TRUE ~ "Otro"  # Para cualquier aeropuerto no especificado en las listas
  ))

# Calcular la probabilidad de éxito
n_vuelos <- nrow(DF)
n_vuelos_costa <- nrow(DF[DF$Region == "Costa",])
p <- n_vuelos_costa / n_vuelos
q <- 1 - p

# Calcular la probabilidad de que el primer vuelo que parte de la costa sea el octavo aeropuerto
n <- 8
y <- n - 1
probabilidad <- (q^y) * p

print(paste("La probabilidad de que el octavo vuelo parta de un aeropuerto de la costa es de ", probabilidad))

```

## Modelos Probabilisticos Continuos

Definir las funciones:

```{r}
r <- function(x){
     return(round(x,digits=2))}
r2 <- function(x){
     return(round(x,digits=5))}
```

### **Distribución Exponencial**

```{r}
hist(DF$ALC, breaks = 70, prob = TRUE, main = "Histograma de los Ingresos Por Alquiler de Oficinas", ylab = "Densidad", ylim = c(0, 0.00035), xlab = "Ingresos por Alquiler de Oficinas de Operaciones (en dólares)")

x <- seq(min(as.numeric(DF$ALC), na.rm= TRUE), max(as.numeric(DF$ALC), na.rm = TRUE ), length = 40)

f <- dnorm(x, mean = mean(as.numeric(DF$ALC), na.rm = TRUE), sd = sd(as.numeric(DF$ALC), na.rm = TRUE))

lines(x, f, col = "blue", lwd = 4)
```

Si nos fijamos en el intervalo \[-2000,20000\]:

```{r}
hist(DF$ALC, breaks = 70, prob = TRUE, main = "Histograma de los Ingresos Por Alquiler de Oficinas", ylab = "Densidad", ylim = c(0, 0.00035), xlim = c(-2000,20000), xlab = "Ingresos por Alquiler de Oficinas de Operaciones (en dólares)")

x <- seq(min(as.numeric(DF$ALC), na.rm= TRUE), max(as.numeric(DF$ALC), na.rm = TRUE ), length = 40)

f <- dnorm(x, mean = mean(as.numeric(DF$ALC), na.rm = TRUE), sd = sd(as.numeric(DF$ALC), na.rm = TRUE))

lines(x, f, col = "blue", lwd = 4)
```

Podríamos observar que se trata de una distribución exponencial, por lo tanto para poder obtener la esperanza de nuestra distribución, es requerido hallar el promedio.

```{r}
prom <- mean(as.numeric(DF$ALC), na.rm = TRUE)
r(prom)
```

Ahora hemos hallado el promedio, por lo tanto si nuestro objetivo es calcular la probabilidad de que los ingresos por alquiler de oficinas de operaciones superen los 3000 dólares entonces debemos:

```{r}
pexp(3000,1/prom)
```
