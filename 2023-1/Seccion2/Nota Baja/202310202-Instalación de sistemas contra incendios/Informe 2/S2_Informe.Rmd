---
title: "S2 Instalación de sistemas contra incendios"
output:
  html_document:
    toc: yes
    df_print: paged
  html_notebook:
    toc: yes
    theme: united
    highlight: tango
---

<div style="text-align: justify">

## **Introducción**

### Relevancia
Contar con una base de datos que recolecta información sobre edificios en construcción o planificación para empresas que instalan sistemas contra incendios y genere una serie de análisis estadísticos de conveniencia a partir de ellos, es de suma importancia en el ámbito de la seguridad contra incendios para las empresas que instalan estos sistemas en el sector construcción .Nuestra base de datos proporciona a las empresas de sistemas contra incendios una valiosa herramienta para identificar y establecer contactos tempranos con los propietarios o desarrolladores de edificios para darle una mejor idea de cuales son los proyectos que tienen que tener mayor prioridad. Esto les brinda la oportunidad de presentar sus servicios y soluciones desde las primeras etapas del proyecto, lo que puede resultar en una relación comercial sólida y duradera. Al estar involucradas desde el principio, las empresas pueden ofrecer asesoramiento especializado y trabajar en estrecha colaboración con los responsables del proyecto para diseñar e implementar sistemas contra incendios efectivos y conformes con las normativas aplicables. En resumen, una base de datos que recolecta información sobre edificios en construcción o planificación para empresas de sistemas contra incendios es altamente relevante en el ámbito de la seguridad y el crecimiento empresarial.

### Objetivos
- Identificar y contactar con empresas constructoras que están trabajando en la mayor cantidad de proyectos, con el fin de establecer relaciones comerciales y ofrecer servicios de instalación de sistemas contra incendios. Esto permitirá a nuestra empresa maximizar las oportunidades de negocio y aumentar nuestra participación en el mercado de la seguridad contra incendios.

- Identificar la etapa de los edificios (planificación o construcción) para determinar cuáles tienen calendarios de entrega ajustados y probablemente ya hayan contratado a otra empresa de sistemas contra incendios. Esto nos permitirá focalizar nuestros esfuerzos en los edificios que aún no hayan contratado dichos servicios, maximizando así nuestras oportunidades de negocio. 

- Determinar qué edificios son más convenientes para trabajar, considerando una combinación de factores que incluyen el área del edificio, la cantidad de departamentos por piso y la cantidad de detectores que se instalarán. Buscamos identificar aquellos proyectos que presenten un alto potencial de ingresos en relación con la cantidad de trabajo y recursos necesarios. Al evaluar estos factores, podremos seleccionar los proyectos que nos brinden mayores ganancias en un tiempo óptimo, optimizando nuestra rentabilidad y eficiencia operativa.

### Contexto

Este proyecto recopila información sobre edificios en construcción o en  planificación, la cual adquiere una gran relevancia debido al crecimiento y desarrollo urbano continuo que experimenta el país. Esta expansión conlleva un aumento significativo en la construcción de diversos tipos de edificios, incluyendo residenciales, comerciales e industriales. A medida que se llevan a cabo más proyectos de construcción, surge la necesidad de garantizar la seguridad contra incendios en estos edificios, lo que aumenta la importancia de contar con información precisa y actualizada sobre cada proyecto. 


La base de datos es especialmente valiosa para las empresas especializadas en la instalación de sistemas contra incendios. Les brinda una visión panorámica de los edificios en construcción o planificación en todo el país, permitiéndoles identificar oportunidades comerciales estratégicas. Al tener acceso a datos detallados sobre la ubicación, tamaño, etapa de construcción y otros aspectos relevantes de los proyectos, estas empresas pueden evaluar de manera efectiva cuáles edificios son más convenientes para contactar y presentar sus soluciones en seguridad contra incendios. Además, en el contexto normativo peruano, existen requisitos específicos para la instalación de sistemas contra incendios en edificios de determinadas características y tamaños. La base de datos proporciona a las empresas información crucial para adaptar su enfoque y ofrecer soluciones que cumplan con las regulaciones locales. Esto garantiza que los sistemas contra incendios se implementen de manera adecuada y contribuye a la seguridad de los ocupantes de los edificios.


## **Datos**
### Recolección de datos

La recolección de datos se dio con la formación de una base de datos a partir de otras bases de datos que pertenecen a la empresa en la que uno de los integrantes del grupo trabaja, pero en esa recopilación, quedaron muchos espacios vacíos, y para rellenarlos contactamos con las inmobiliarias necesarias vía llamada telefónica o mensajes directos.

### Población, muestra y muestreo

La población son todos los edificios que están en etapa de construcción o planos en toda la región de Lima. Para poder reducir ese número a uno mas manejable, tomamos consideraciones como ubicación, en este caso eliminamos todos los proyectos no se encuentran dentro del perímetro que establecimos, el cual es hasta el aeropuerto por el norte, hasta Ate por el este y hasta Chorrillos por el sur, tomamos esta decisión porque una empresa mediana o pequeña que opera en Lima difícilmente se tomara la molestia de mandar personal, material y supervisores hasta una ubicación muy lejos de sus oficinas. También consideramos solo los edificios mayores a 7 pisos porque un edificio de pocos pisos genera muy poco ingreso para una empresa pequeña que no tiene la logística para realizar este tipo de proyectos de forma masiva, esto se debe a que estos edificios suelen tener estacionamientos al nivel del suelo los cuales no requieren este tipo de sistemas a diferencia de sótanos subterráneos.  Entonces en nuestra primera muestra quedaron aproximadamente 500 observaciones que cumplían con los requisitos que indicamos anteriormente.




### Variables


+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Variable                                                         | Tipo         | Clase        | Restricciones                                                                           |
+==================================================================+:=============+:=============+:========================================================================================+
| Cliente(Inmobiliaria o constructora)                             | Categórica   | Nominal      | No se puede realizar operaciones aritméticas, solo se puede seleccionar opciones dadas. |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Tipo de edificación                                              | Categórica   | Nominal      | No se puede realizar operaciones aritméticas, solo puede seleccionar opciones dadas.    |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Distrito                                                         | Categórica   | Nominal      | No se puede usar descriptores de posición, solo puede seleccionar opciones dadas.       |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Etapa de la Edificación                                          | Categórica   | Ordinales    | No se puede usar descriptores de posición, solo puede seleccionar opciones dadas.       |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Cantidad de pisos                                                | Cuantitativa | Discreta     | Solo acepta números enteros entre 1 y 34.                                               |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Cantidad de sótanos                                              | Cuantitativa | Discreta     | Solo acepta números enteros entre 0 y 7.                                                |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Departamentos por piso                                           | Cuantitativa | Discretas    | Solo acepta números enteros entre 1 y 15.                                               |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Cantidad de detectores de temperatura                            | Cuantitativa | Discretas    | Solo acepta números enteros entre 0 y 2000.                                             |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Cantidad de detectores de humo                                   | Cuantitativa | Discretas    | Solo acepta números enteros entre 1 y 600.                                              |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Área superficial de los edificios  (m^2^)                        | Cuantitativa | Continuas    | Solo acepta números entre 200 y 2500.                                                   |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Ingreso estimado                                                 | Cuantitativa | Continuas    | Solo acepta números entre 2 500 y 85 000.                                               |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+



### Limpieza de base de datos

A partir de los 500 edificios que recopilamos, había que conseguir una serie de datos importantes al respecto, lamentablemente la mayoría de estos edificios no se encuentran en Internet al estar en etapas muy tempranas de desarrollo y no pudimos establecer una conexión con las constructoras o inmobiliarias a cargo, por lo tanto limpiamos todas las observaciones que quedaron con datos vacíos, que fueron aproximadamente 150, dejándonos aproximadamente con 350 observaciones limpias y listas para analizar.


- Instalación y llamado a las librerías que usaremos :

```{r}
packages <- c("pacman")
installed_packages <- packages%in% rownames(installed.packages())
if (any(installed_packages == FALSE)) {
  install.packages(packages[!installed_packages])
}

pacman::p_load(ggplot2, dplyr, readr,plotrix, car)
```

- Carga de nuestra base de datos :
```{r}
DF <- read_csv("Database.csv")
```
- Seleccionamos las variables con las que vamos a trabajar, para ello utilizamos la función "select"
```{r}
DB <-select(DF, CLIENTE , `TIPO DE EDIFICACIÓN` , DISTRITO , `ETAPA DE LA EDIFICACIÓN` , PISOS , SÓTANOS , `DEPARTAMENTOS POR PISO` , `CANTIDAD DE DETECTORES DE HUMO` , `CANTIDAD DE DETECTORES DE TEMPERATURA` , `ÁREA DEL EDIFICIO` , INGRESO)
```

- Luego de aplicar "unique" a cada variable se encontró un error en la variable "ETAPA DE EDIFICACION" .

```{r}
unique(DB$`ETAPA DE LA EDIFICACIÓN`)

```
- Se procedió a corregir los errores de redacción que se presentaron durante la creación de la base de datos.

```{r}
DB %>% mutate(`ETAPA DE LA EDIFICACIÓN` = 
        ifelse(`ETAPA DE LA EDIFICACIÓN` == "ETAPA DE CONSTRUCCION", "ETAPA DE CONSTRUCCIÓN", `ETAPA DE LA EDIFICACIÓN`
       )) -> DB
DB %>% count(`ETAPA DE LA EDIFICACIÓN`)
```
Total de Observaciones:

-   Casos completos
```{r}
sum(complete.cases(DB))
```
-   Casos incompletos
```{r}
sum(!complete.cases(DB))
```
-   Total de Variables:
```{r}
ncol(DB)
```

## **Análisis descriptivo**

### Gráfico de barras de Clientes
```{r}
temp <- DB  %>% group_by(CLIENTE) %>% summarise(Total=n())
temp
```
Al haber 163 clientes , mostrar la data en un gráfico seria imposible , por eso filtraremos la data para mostrar cuales son las empresas que tienen un mayor numero de proyectos.
```{r}
Tabla_C <- DB %>% group_by(CLIENTE) %>% summarise(Total=n())   %>%      
    dplyr::mutate(Porcentaje = round(Total/sum(Total)*100, 1))
Tabla_C2 <- Tabla_C %>% filter (temp$Total > 4)
Tabla_C2

```
```{r}
ggplot(Tabla_C2) +
  geom_col(aes(reorder(CLIENTE, Total ), Porcentaje), fill='#BDF032' , width=0.7, position = position_nudge(y=1) ) +
  
  geom_text(aes(label=paste(Porcentaje, '%'), x=reorder(CLIENTE, Total), y=(Porcentaje/100) )  ,                     
            color="white",   
            hjust = 0.1,
            size=3.5 ) +
  labs(title='Constructuras e inmobiliarios', x='Nombre', y='') +
  theme_minimal() +
  coord_flip()+ 
  theme(legend.position = 'none',
        plot.background = element_rect(fill='#212121'),
        text=element_text(color='#FFFFFF'),
        axis.text = element_text(color='#FFFFFF' , size=10),
        axis.text.x = element_blank(),
        panel.grid = element_blank())
```
Gracias a la gráfica podemos identificar que las mejores opciones son "Tale Inmobiliaria" , "Edifica/Produktiva" y "EE Inmobiliaria" . Al tener una mayor numero de proyectos , las empresas preferirían contratar una única empresa que instale sistemas contra incendios para todos sus proyectos.

### Diagrama de Tarta de los Tipos de Edificación

```{r}
table(DB$`TIPO DE EDIFICACIÓN`)
```


```{r}
Tabla_E <- DB %>% group_by(`TIPO DE EDIFICACIÓN`) %>% summarise(Total=n()) %>%     
    dplyr::mutate(Porcentaje = round(Total/sum(Total)*100, 1))             
  
pie3D(Tabla_E$Porcentaje,labels=paste(Tabla_E$Porcentaje,'%'),
      main="Tarta de los tipos de edificación",
      col = heat.colors(length(Tabla_E$Porcentaje)),
      labelcex = 0.99)
legend(1,0.7,legend=Tabla_E$`TIPO DE EDIFICACIÓN`,cex=0.7,yjust=4.7, xjust = 2,
       fill = heat.colors(length(Tabla_E$Porcentaje)))
```
A partir de la gráfica se puede observar que el 97.7% de las edificaciones son Residenciales, esto es importante para el negocio de instalación de sistema contra incendios. Porque se podrá obtener una mayor ganancia cuando se trabaje con las residenciales.


### Gráfico de barra de los distritos.

```{r}
Tabla_D <- DB %>% group_by(DISTRITO) %>% summarise(Total=n()) %>%     
    dplyr::mutate(Porcentaje = round(Total/sum(Total)*100, 2)) 

ggplot(Tabla_D) +
  ylim(c(0,40))+ 
  geom_col(aes(reorder(DISTRITO, Total ), Porcentaje), fill='#14FFEC' , width=0.7, position = position_nudge(y=3) ) +
  
  geom_text(aes(label=paste(Porcentaje, '%'), x=reorder(DISTRITO, Total), y=(Porcentaje/100) )  ,                     
            color="white",   
            hjust = 0.4,
            size=3.5 ) +
  labs(title='Ubicacion de los proyectos inmobiliarios', x='Distrito', y='') +
  theme_minimal() +
  coord_flip()+ 
  theme(legend.position = 'none',
        plot.background = element_rect(fill='#212121'),
        text=element_text(color='#FFFFFF'),
        axis.text = element_text(color='#FFFFFF' , size=13),
        axis.text.x = element_blank(),
        panel.grid = element_blank())
```
Se puede observar que la mayor cantidad de proyectos inmobiliarios se encuentran en los distritos de Miraflores, Surco y San Isidro respectivamente.
```{r}
Tabla_D %>% filter (Porcentaje > 18)
```

### Gráfico de barras de las etapas de las edificaciones.

```{r}
table(DB$`ETAPA DE LA EDIFICACIÓN`)
```
```{r}
Tabla_F <- DB %>% group_by(`ETAPA DE LA EDIFICACIÓN`) %>% summarise(Total=n()) %>%     
    dplyr::mutate(Porcentaje = round(Total/sum(Total)*100, 2)) 

ggplot(Tabla_F) +
  ylim(c(0,100))+ 
  geom_col(aes(`ETAPA DE LA EDIFICACIÓN`, Porcentaje), fill='#6AED32' , width=0.7, position = position_nudge(y=3) ) +
  
  geom_text(aes(label=paste(Porcentaje, '%'), x=`ETAPA DE LA EDIFICACIÓN`, y=(Porcentaje/100) )  ,                     
            color="white",   
            hjust = 0.4,
            size=3.5 ) +
  labs(title='ETAPA DE LA EDIFICACIÓN', x='Etapa de la edificación', y='Cantidad \n (Porcentajes)') +
  theme_minimal() +
  theme(legend.position = 'none',
        plot.background = element_rect(fill='#212121'),
        text=element_text(color='#FFFFFF'),
        axis.text = element_text(color='#FFFFFF' , size=13),
        panel.grid = element_blank())
```
Se puede observar en el gráfico que la mayoría de las edificaciones en encuentran en la etapa de planos, esto es muy favorable para los objetivos del proyecto ya que al no estar con limites de tiempo tan estrictos, las empresas que instalan equipos y sistemas pueden tomarse el tiempo de hacer una buena presentación y ofrecer precios competitivos.

### Histograma de la cantidad de pisos.
```{r}
prom <- round(mean(DB$PISOS),digits= 2)
med <- round(median(DB$PISOS),digits= 2)
moda1 <- function(x) {return(as.numeric(names(which.max(table(x)))))}
moda <- moda1(DB$PISOS)
hist(DB$PISOS,breaks = 34, col= '#F6E396' , main = "Histograma de Pisos",xlab= "Pisos", ylab= "Frecuencia" )
abline(v = prom,col= "red", lwd=3)
abline(v = med, col = "blue", lwd=2, lty = 2)
abline(v = moda,col= '#3F8522', lwd=3,lty = 2.5)
legend("topright",bty= "n", legend = c("Media","Mediana","Moda"),col = c("red", "blue",'#3F8522'),lwd =3, lty= 1:3) 
```
Este gráfico nos indica que la cantidad de pisos esta uniformemente distribuida, por lo que las empresas se encontraran con todo tipo de proyectos para afrontar y no deberían hacer un único modelo de trabajo porque se verán perjudicados a la hora de buscar nuevos proyectos.
```{r}
summary(DB$PISOS)
```
### Histograma de la cantidad de sótanos.

```{r}
moda1 <- function(x) {return(as.numeric(names(which.max(table(x)))))}
moda <- moda1(DB$SÓTANOS)
hist(DB$SÓTANOS,breaks = 7, col= '#9BC5EB' , main = "Histograma de Sótanos",xlab= "Sótanos", ylab= "Frecuencia" )
abline(v = round(mean(DB$SÓTANOS),digits= 2),col= "red", lwd=3)
abline(v = round(median(DB$SÓTANOS),digits= 2), col = "blue", lwd=2, lty = 2)
abline(v = moda,col= "#3F8522", lwd=3,lty = 3)
legend("topleft",bty= "n", legend = c("Media","Mediana","Moda"),col = c("red", "blue","#3F8522"),lwd =3, lty= 1:3) 
```
Esta gráfica nos muestra que la mayoría de los edificios a entregarse tienen 7 sótanos, esto se debe a que a menos que el edificio sea un rascacielos, nunca se necesitaran mas de 7 sótanos, por lo tanto prácticamente todos los edificios que tienen mas de 20 pisos tendrán 7 sótanos.
```{r}
summary(DB$SÓTANOS)
```

### Boxplot de la cantidad de detectores de humo.

```{r}
boxplot(DB$`CANTIDAD DE DETECTORES DE HUMO`,main="Cantidad de detectores de humo",horizontal=TRUE,xlab="Cantidad")
abline(v=mean(DB$`CANTIDAD DE DETECTORES DE HUMO`),col="red")
legend("topright",bty= "n", legend = c("Media"),col = c("red"),lwd =3, lty= 1:3) 
```
La cantidad de detectores de humo esta uniformemente distribuida, esto se debe a que la distribución de pisos también es uniforme y esta variable tiene cierta relación con la mencionada.
```{r}
summary(DB$`CANTIDAD DE DETECTORES DE HUMO`)
```


### Boxplot de la cantidad de detectores de temperatura.

```{r}
boxplot(DF$`CANTIDAD DE DETECTORES DE TEMPERATURA`,main="Cantidad de detectores de temperatura",horizontal=TRUE,ylab="Cantidad")
abline(v=mean(DB$`CANTIDAD DE DETECTORES DE TEMPERATURA`),col="red")
legend("topright",bty= "n", legend = c("Media"),col = c("red"),lwd =3, lty= 1:3) 
```
En este caso también es uniforme a excepción de unos casos atípicos en edificios que ocupen una gran área superficial y necesiten muchos detectores en los sótanos.
```{r}
summary(DB$`CANTIDAD DE DETECTORES DE TEMPERATURA`)
```
### Histograma del tamaño de construccion del edificio.

```{r}
moda1 <- function(x) {return(as.numeric(names(which.max(table(x)))))}
moda <- moda1(DB$`ÁREA DEL EDIFICIO`)
prom <- round(mean(DB$`ÁREA DEL EDIFICIO`),digits= 2)
med <- round(median(DB$`ÁREA DEL EDIFICIO`),digits= 2)
hist(DB$`ÁREA DEL EDIFICIO`,breaks = 20, col= "#F5B377" , main = "Histograma de Área del edificio",xlab= "Área (m^2)", ylab= "Frecuencia" )
abline(v = prom,col= "red", lwd=3)
abline(v = med, col = "blue", lwd=2, lty = 2)
abline(v = moda,col= '#3F8522', lwd=3,lty = 2.5)
legend("topright",bty= "n", legend = c("Media","Mediana","Moda"),col = c("red", "blue",'#3F8522'),lwd =3, lty= 1:3) 
```
Al ser Lima una ciudad densamente poblada, los espacios que existen para construcciones nuevas no son muy amplios, por lo tanto los edificios que se construyen tendrán un área muy considerable.
```{r}
summary(DB$`ÁREA DEL EDIFICIO`)
```

### Boxplot del Ingreso monetario

```{r}
boxplot(DF$INGRESO,main="Ingreso",horizontal=TRUE,xlab="Cantidad")
abline(v=mean(DF$INGRESO),col="red")
```
El ingreso estimado también es uniformemente distribuido y podemos concluir que si se relaciona bien con la cantidad de proyectos que cada empresa podrá realizar simultáneamente sin perdidas significativas.
```{r}
summary(DB$INGRESO)
```
### Comparación entre la cantidad de detectores de humo y el número de departamentos por piso.
```{r}
ggplot(data = DB, 
       mapping = aes(y = `DEPARTAMENTOS POR PISO`, x = `CANTIDAD DE DETECTORES DE HUMO`)) +
  geom_point()+
  geom_smooth(formula = y ~ x,method = "lm")
```
La recta de tendencia sugiere que existe una asociación positiva entre las variables. A mayor cantidad de departamento por piso en una edificación, mayor sera la cantidad de detectores de humo que presentara esta.

### Comparación entre la cantidad de detectores de temperatura y el número de sótanos.
```{r}
ggplot(data = DB, 
       mapping = aes(y = SÓTANOS, x = `CANTIDAD DE DETECTORES DE TEMPERATURA`)) +
  geom_point()+
  geom_smooth(formula = y ~ x,method = "lm")
```

La recta de tendencia sugiere que existe una asociación positiva entre las variables. A mayor cantidad de sótanos por edificación, mayor sera la cantidad de detectores de temperatura.

### Comparación entre el ingreso y el tipo de edificación.
```{r}
ggplot(data = DB, aes(x = INGRESO, fill = `TIPO DE EDIFICACIÓN`)) +
  geom_histogram(binwidth = 5000, color = "white")
```
Podemos ver que hay más observaciones dentro del grupo de las residenciales.

Esto puede resultar más claro en un gráfico de densidad, ya que no depende de la cantidad de observaciones.
```{r}
ggplot(data = DB, aes(x = INGRESO, fill = `TIPO DE EDIFICACIÓN`)) +
  geom_density(alpha = 0.5, color = "darkblue")
```


## **Análisis Probabilístico**

### Probabilidad empírica

**VARIABLE 1: PISOS**

* Experimento: Seleccionar un edificio y observar la cantidad de pisos que tiene.

  + Eventos atómicos:

    - Edificio de altura baja o media: Edificios que tengan menos de 15 pisos.

    - Edificio de altura moderada o alta: Edificios que tengan 15 pisos o mas.



Imprimimos la tabla de frecuencias para ver el espacio de resultados
```{r}
# Obtener la tabla de frecuencia de los valores de la variable PISOS
tabla_frecuencia <- table(DB$PISOS)

# Iterar sobre los valores y frecuencias para imprimirlos de forma ordenada
for (valor in sort(unique(DB$PISOS))) {
  frecuencia <- tabla_frecuencia[as.character(valor)]
  mensaje <- paste(valor, "pisos:", frecuencia, "edificios")
  print(mensaje)
}

```

Asociaremos la cantidad de piso en 2 grupos porque la ley con respecto a la instalación de sistema contra incendios cambia a partir de los 15 pisos

Primero contamos cuantos edificios tienen menos de 15 pisos
```{r}
# Filtrar los registros con menos de 15 pisos
edificios_menos_15_pisos <- subset(DB, PISOS < 15)

# Contar el número de edificios resultantes
num_edificios_menos_15_pisos <- nrow(edificios_menos_15_pisos)

# Imprimir el resultado
print(num_edificios_menos_15_pisos)
```

Luego contamos cuantos edificios tienen 15 pisos o mas
```{r}
# Filtrar los registros con 15 pisos o más
edificios_15_o_mas_pisos <- subset(DB, PISOS >= 15)

# Contar el número de edificios resultantes
num_edificios_15_o_mas_pisos <- nrow(edificios_15_o_mas_pisos)

# Imprimir el resultado
print(num_edificios_15_o_mas_pisos)
```
 
Calcular la probabilidad de que estos dos eventos sucedan
```{r}
num_edificios_menos_15_pisos <- nrow(edificios_menos_15_pisos)
num_edificios_15_o_mas_pisos <- nrow(edificios_15_o_mas_pisos)

# Obtener el número total de edificios en la base de datos
num_total_edificios <- nrow(DB)

# Calcular la probabilidad de tener menos de 15 pisos
probabilidad_menos_15_pisos <- num_edificios_menos_15_pisos / num_total_edificios

# Calcular la probabilidad de tener 15 pisos o más
probabilidad_15_o_mas_pisos <- num_edificios_15_o_mas_pisos / num_total_edificios

# Imprimir los resultados
print(round(probabilidad_menos_15_pisos , 2))
print(round(probabilidad_15_o_mas_pisos , 2))
```

La probabilidad de que un edificio escogido aleatoriamente tenga menos de 15 pisos es 0.36 

La probabilidad de que un edificio escogido aleatoriamente tenga 15 pisos o mas es 0.64



**VARIABLE 2: Distrito**

* Experimento: Seleccionar un edificio y observar el distrito en el que se ubica.

  + Eventos atómicos:

```{r}
# Obtener los distritos únicos de la variable DISTRITO
distritos_unicos <- unique(DB$DISTRITO)

# Iterar sobre los distritos únicos e imprimirlos
for (distrito in distritos_unicos) {
  print(distrito)
}

```


Nuevamente imprimimos la tabla de frecuencias para ver el espacio de resultados
```{r}
# Obtener la tabla de frecuencias de los distritos
tabla_frecuencias <- table(DB$DISTRITO)

# Ordenar la tabla de frecuencias en orden descendente
tabla_ordenada <- sort(tabla_frecuencias, decreasing = TRUE)

# Imprimir los distritos y sus frecuencias ordenados
for (i in 1:length(tabla_ordenada)) {
  distrito <- names(tabla_ordenada)[i]
  frecuencia <- tabla_ordenada[i]
  mensaje <- paste(distrito, ":", frecuencia, "edificios")
  print(mensaje)
}

```

Calculamos la probabilidad de que un edificio elegido aleatoriamente se ubique en cada distrito

```{r}
# Obtener la tabla de frecuencias de los distritos
tabla_frecuencias <- table(DB$DISTRITO)

# Calcular el número total de edificios
num_total_edificios <- nrow(DB)

# Calcular y mostrar la probabilidad para cada distrito
for (i in 1:length(tabla_frecuencias)) {
  distrito <- names(tabla_frecuencias)[i]
  frecuencia <- tabla_frecuencias[i]
  probabilidad <- frecuencia / num_total_edificios
  mensaje <- paste(distrito, " : Probabilidad =", round(probabilidad, 4))
  print(mensaje)
}

```


### Probabilidad condicional

* Elegimos dos variables dependientes: Pisos - Ingreso


```{r}
# Calcular la probabilidad de A: P(A) (Edificios con más de 15 pisos)
prob_A <- sum(DB$PISOS >= 15) / nrow(DB)

# Calcular la probabilidad de B dado A: P(B|A) (Edificios con ingreso mayor a 37500 dado que tienen más de 15 pisos)
prob_B_dado_A <- sum(DB$INGRESO >= 37500 & DB$PISOS >= 15) / sum(DB$PISOS >= 15)

# Calcular la probabilidad de B: P(B) (Edificios con ingreso mayor a 37500)
prob_B <- sum(DB$INGRESO >= 37500) / nrow(DB)

# Calcular la probabilidad de A dado B: P(A|B) (Edificios con más de 15 pisos dado que tienen ingreso mayor a 37500)
prob_A_dado_B <- sum(DB$PISOS >= 15 & DB$INGRESO >= 37500) / sum(DB$INGRESO >= 37500)

# Verificar si se cumple P(B|A) = P(A) y P(A|B) = P(B)
if (prob_B_dado_A == prob_B && prob_A_dado_B == prob_A) {
  print("Los eventos Pisos - Ingreso son independientes.")
} else {
  print("Los eventos Pisos - Ingreso son dependientes.")
}
```


```{r}
# Calcular la probabilidad de A: P(A) (Edificios con más de 20 pisos)
prob_A <- sum(DB$PISOS >= 20) / nrow(DB)

# Calcular la probabilidad de B: P(B) (Edificios con ingreso mayor a 50000)
prob_B <- sum(DB$INGRESO >= 50000) / nrow(DB)

# Calcular la probabilidad de B dado A: P(B|A) (Edificios con ingreso mayor a 50000 dado que tienen más de 20 pisos)
prob_B_dado_A <- sum(DB$INGRESO >= 50000 & DB$PISOS >= 20) / sum(DB$PISOS >= 20)

# Calcular la probabilidad de A dado B: P(A|B) (Edificios con más de 20 pisos dado que tienen ingreso mayor a 50000)
prob_A_dado_B <- sum(DB$PISOS >= 20 & DB$INGRESO >= 50000) / sum(DB$INGRESO >= 50000)

# Verificar si se cumple P(B|A) = P(B) y P(A|B) = P(A)
if (prob_B_dado_A == prob_B && prob_A_dado_B == prob_A) {
  print("Los eventos Pisos - Ingreso son independientes.")
} else {
  print("Los eventos Pisos - Ingreso son dependientes.")
}
```



Al haber hecho dos pruebas, confirmamos que las variables son dependientes, esto era evidente porque el ingreso que se tendrá, depende del tamaño del edificio de una forma prácticamente lineal.


* Elegimos dos variables independientes: Área - Cantidad de detectores de humo
```{r}
# Calcular la probabilidad de A: P(A) (Edificios con área del edificio mayor o igual a 1000)
prob_A <- sum(DB$`ÁREA DEL EDIFICIO` >= 1000) / nrow(DB)

# Calcular la probabilidad de B: P(B) (Edificios con cantidad de detectores de humo mayor o igual a 500)
prob_B <- sum(DB$`CANTIDAD DE DETECTORES DE HUMO` >= 500) / nrow(DB)

# Calcular la probabilidad de B dado A: P(B|A) (Edificios con cantidad de detectores de humo mayor o igual a 500 dado que tienen área del edificio mayor o igual a 1000)
prob_B_dado_A <- sum(DB$`CANTIDAD DE DETECTORES DE HUMO` >= 500 & DB$`ÁREA DEL EDIFICIO` >= 1000) / sum(DB$`ÁREA DEL EDIFICIO` >= 1000)

# Calcular la probabilidad de A dado B: P(A|B) (Edificios con área del edificio mayor o igual a 1000 dado que tienen cantidad de detectores de humo mayor o igual a 500)
prob_A_dado_B <- sum(DB$`ÁREA DEL EDIFICIO` >= 1000 & DB$`CANTIDAD DE DETECTORES DE HUMO` >= 500) / sum(DB$`CANTIDAD DE DETECTORES DE HUMO` >= 500)

# Verificar si se cumple P(B|A) = P(B) y P(A|B) = P(A)
if (prob_B_dado_A == prob_B && prob_A_dado_B == prob_A) {
  print("Los eventos Área - Cantidad de detectores de humo son independientes.")
} else {
  print("Los eventos Área - Cantidad de detectores de humo son dependientes.")
}

```




```{r}
# Calcular la probabilidad de A: P(A) (Edificios con área del edificio mayor o igual a 1000)
prob_A <- sum(DB$`ÁREA DEL EDIFICIO` <= 300) / nrow(DB)

# Calcular la probabilidad de B: P(B) (Edificios con cantidad de detectores de humo mayor o igual a 500)
prob_B <- sum(DB$`CANTIDAD DE DETECTORES DE HUMO` <= 150) / nrow(DB)

# Calcular la probabilidad de B dado A: P(B|A) (Edificios con cantidad de detectores de humo mayor o igual a 150 dado que tienen área del edificio menor o igual a 300)
prob_B_dado_A <- sum(DB$`CANTIDAD DE DETECTORES DE HUMO` <= 150 & DB$`ÁREA DEL EDIFICIO` <= 300) / sum(DB$`ÁREA DEL EDIFICIO` <= 300)

# Calcular la probabilidad de A dado B: P(A|B) (Edificios con área del edificio menor o igual a 300 dado que tienen cantidad de detectores de humo menor o igual a 150)
prob_A_dado_B <- sum(DB$`ÁREA DEL EDIFICIO` <= 300 & DB$`CANTIDAD DE DETECTORES DE HUMO` <= 150) / sum(DB$`CANTIDAD DE DETECTORES DE HUMO` <= 150)

# Verificar si se cumple P(B|A) = P(B) y P(A|B) = P(A)
if (prob_B_dado_A == prob_B && prob_A_dado_B == prob_A) {
  print("Los eventos Área - Cantidad de detectores de humo son independientes.")
} else {
  print("Los eventos Área - Cantidad de detectores de humo son dependientes.")
}

```
En este caso, las variables Área y Cantidad de detectores de humo son independientes porque la cantidad de detectores de humo depende de la cantidad de departamentos, ya que solo se coloca un detector en cada departamento sin importar su área superficial y uno en el vestíbulo de cada piso.


```{r}
# Calcular la probabilidad de A: P(A) (Edificios con más de 15 pisos)
prob_A <- sum(DB$PISOS > 15) / nrow(DB)

# Calcular la probabilidad de B: P(B) (Edificios con ingreso mayor a 37500)
prob_B <- sum(DB$INGRESO > 37500) / nrow(DB)

# Calcular la probabilidad condicional de A dado B: P(A|B)
prob_A_dado_B <- sum(DB$PISOS > 15 & DB$INGRESO > 37500) / sum(DB$INGRESO > 37500)

# Calcular P(B|A) utilizando la fórmula de Bayes
prob_B_dado_A <- prob_A_dado_B * prob_B / prob_A

# Imprimir el resultado
print(paste("La probabilidad condicional P(B|A) es:", prob_B_dado_A))

```
Utilizando Bayes, nuevamente comprobamos la dependencia de las variables Ingreso y Pisos, al tener un valor de 1, concluimos que la relación es perfectamente lineal

```{r}
# Calcular la probabilidad de A: P(A) (Edificios con área del edificio mayor o igual a 1000)
prob_A <- sum(DB$`ÁREA DEL EDIFICIO` >= 1000) / nrow(DB)

# Calcular la probabilidad de B: P(B) (Edificios con cantidad de detectores de humo mayor o igual a 500)
prob_B <- sum(DB$`CANTIDAD DE DETECTORES DE HUMO` >= 250) / nrow(DB)

# Calcular la probabilidad condicional de A dado B: P(A|B)
prob_A_dado_B <- sum(DB$`ÁREA DEL EDIFICIO` >= 1000 & DB$`CANTIDAD DE DETECTORES DE HUMO` >= 250) / sum(DB$`CANTIDAD DE DETECTORES DE HUMO` >= 250)

# Calcular P(B|A) utilizando la fórmula de Bayes
prob_B_dado_A <- prob_A_dado_B * prob_B / prob_A

# Imprimir el resultado
print(paste("La probabilidad condicional P(B|A) es:", prob_B_dado_A))

```
En este caso comprobamos la independencia de estas dos variables ya que los umbrales dados solo coinciden en aproximadamente el 70% de los casos totales, lo cual, a nuestro criterio y considerando el contexto, no es suficiente para determinar que son dependientes.

```{r}
# Calcular la probabilidad de A: P(A) (Edificios con área del edificio mayor o igual a 1000)
prob_A <- sum(DB$`ÁREA DEL EDIFICIO` >= 500) / nrow(DB)

# Calcular la probabilidad de B: P(B) (Edificios con cantidad de detectores de humo mayor o igual a 500)
prob_B <- sum(DB$`CANTIDAD DE DETECTORES DE HUMO` >= 100) / nrow(DB)

# Calcular la probabilidad condicional de A dado B: P(A|B)
prob_A_dado_B <- sum(DB$`ÁREA DEL EDIFICIO` >= 500 & DB$`CANTIDAD DE DETECTORES DE HUMO` >= 100) / sum(DB$`CANTIDAD DE DETECTORES DE HUMO` >= 100)

# Calcular P(B|A) utilizando la fórmula de Bayes
prob_B_dado_A <- prob_A_dado_B * prob_B / prob_A

# Imprimir el resultado
print(paste("La probabilidad condicional P(B|A) es:", prob_B_dado_A))

```


### Variable aleatoria discretas

**Etapa de edificación **


Dada la siguiente variable aleatoria :

X : Numero de proyectos que no se encuentre en la etapa de planos dentro de nuestra base de datos 

Identificación de parámetros 

X - Bin(p,n)

p : la probabilidad de éxito esta definida como el numero de proyectos que no se encuentre en la etapa de planificación

n : la cantidad total de los proyectos


```{r}
frecuencias_edi <- table(DB$`ETAPA DE LA EDIFICACIÓN`)
probabilidades <- frecuencias_edi / sum(frecuencias_edi)
probabilidades <- round(probabilidades, 3)  

probabilidades[1]

result_edi <- dbinom(0:353, size = 353, prob = probabilidades[1])

# Crear el gráfico de barras
barplot(result_edi, names.arg = 0:353, xlab = "Número de éxitos", ylab = "Probabilidad",
        main = "Distribución Binomial", col = "blue")


cat("Varianza" , varianza <- var(frecuencias_edi), "\n")

desviacion_estandar <- sqrt(varianza)
cat("Coeficiente de Variacion" , coeficiente_variacion <- (desviacion_estandar / probabilidades[1]) * 100 , "\n")

```
Ahora para hallar la esperanza de X : 

Sera 0 cuando el proyecto se encuentra la etapa de planos 
Sera 1 cuando el proyecto se encuentra la etapa de construcción  

```{r}
cat("Esperanza" , 0 * probabilidades[2] + 1 * probabilidades[1] , "\n")
```

Ejemplo de aplicación : 

En una feria inmobiliaria se desea conocer la probabilidad de que mas del 30% de los proyectos están en etapa de planificación. Se saben que en esta feria hay 100 proyectos.

P ( Y > 30) = P (X < 30)

```{r}
pbinom(30 , 100, probabilidades[1], lower.tail = T )
```
El resultado obtenido durante el ejemplo es de 0.99 esto es la suma de todas la probabilidades de éxito hasta n = 30 , esto se puede observar en el gráfico anterior, pues hasta el valor 30 la probabilidad de que un proyecto no este en etapa de planificación no es alta.



**Cantidad de sensores de Temperatura** 

Dada la siguiente variable aleatoria :

X : Numero de proyectos que soliciten mas de 400 sensores de temperatura para su proyecto nuestra base de datos 

Identificación de parámetros 

X - Bin(p,n)

p : la probabilidad de éxito esta definida como el numero de proyectos que soliciten mas de 500 sensores de temperatura 

n : cantidad total de nuestras proyectos


```{r}

temp_5<- subset(DB, DB$`CANTIDAD DE DETECTORES DE TEMPERATURA` > 500)
temp_500 <- table(temp_5$`CANTIDAD DE DETECTORES DE TEMPERATURA`)



probabilidades1 <-  sum(temp_500)/ nrow(DB)
probabilidades1 <- round(probabilidades1, 3)  

probabilidades1

result_edi <- dbinom(0:159, size = 159, prob = probabilidades1[1])

# Crear el gráfico de barras
barplot(result_edi, names.arg = 0:159, xlab = "Número de éxitos", ylab = "Probabilidad",
        main = "Distribución Binomial", col = "green")


cat("Varianza" , varianza <- var(temp_500), "\n")

desviacion_estandar <- sqrt(varianza)
cat("Coeficiente de Variacion" , coeficiente_variacion <- (desviacion_estandar / probabilidades) * 100 , "\n")

```
Ahora para hallar la esperanza de X : 

Sera 0 cuando el proyecto necesita menos de 500 sensores de Temperatura (Fracaso)
Sera 1 cuando el proyecto necesita mas de 500 sensores de Temperatura (Éxito)  

```{r}
esperanza_temp <- 0 * (1 - probabilidades1) +  1 * probabilidades1 
cat("Esperanza" , esperanza_temp , "\n")
```

Ejemplo de aplicación : 

En una feria inmobiliaria se desea conocer la probabilidad de que mas del 30% de los proyectos están en etapa de planificación. Se saben que en esta feria hay 100 proyectos.

La empresa SecuFuego quiera saber la probabilidad de que mas del 50% de las empresas con que trabaja necesita menos de 500 sensores de temperatura. Actualmente esta trabajando con 160 empresas 


P ( Y > 80) = P (X < 80)

```{r}
pbinom(80 , 160, probabilidades1, lower.tail = T )
pbinom(80 , 160, probabilidades1, lower.tail = F )


```
El resultado obtenido durante el ejemplo es de 0.91 esto es la suma de todas la probabilidades de éxito hasta n = 80 , esto se puede observar en el gráfico anterior.

### Variable aleatoria continuas

 
**Analizamos "Área superficial de los edificios"**
 
```{r}
moda1 <- function(x) {return(as.numeric(names(which.max(table(x)))))}
moda <- moda1(DB$`ÁREA DEL EDIFICIO`)
prom <- round(mean(DB$`ÁREA DEL EDIFICIO`),digits= 2)
med <- round(median(DB$`ÁREA DEL EDIFICIO`),digits= 2)
hist(DB$`ÁREA DEL EDIFICIO`,breaks = 20, col= "#F5B377" , main = "Histograma de Área del edificio",xlab= "Área (m^2)", ylab= "Frecuencia" )
abline(v = prom,col= "red", lwd=3)
abline(v = med, col = "blue", lwd=2, lty = 2)
abline(v = moda,col= '#3F8522', lwd=3,lty = 2.5)
legend("topright",bty= "n", legend = c("Media","Mediana","Moda"),col = c("red", "blue",'#3F8522'),lwd =3, lty= 1:3) 
summary(DB$`ÁREA DEL EDIFICIO`)
```


Esta gráfica nos muestra una distribución F, la gráfica tiene una forma semejante a la obtenida.

Validación

```{r}
# Análisis exploratorio
mean_area <- mean(DB$`ÁREA DEL EDIFICIO`)
var_area <- var(DB$`ÁREA DEL EDIFICIO`)
sd_area <- sd(DB$`ÁREA DEL EDIFICIO`)


# Eliminar empates
AE_unique <- unique(DB$`ÁREA DEL EDIFICIO`)

# Prueba de normalidad

shapiro_test <- shapiro.test(AE_unique)
ks_test <- ks.test(AE_unique, "pnorm")


# Histograma
hist(DB$`ÁREA DEL EDIFICIO`, breaks = "FD", col = "lightblue", main = "Histograma del Área del Edificio")

# Gráfico Q-Q
qqnorm(DB$`ÁREA DEL EDIFICIO`)
qqline(DB$`ÁREA DEL EDIFICIO`)

# Resultados
cat("Análisis exploratorio:\n")
cat("Media:", mean_area, "\n")
cat("Varianza:", var_area, "\n")
cat("Desviación estándar:", sd_area, "\n\n")

cat("Prueba de normalidad:\n")
cat("Prueba de Shapiro-Wilk:\n")
print(shapiro_test)
cat("Prueba de Kolmogorov-Smirnov:\n")
print(ks_test)





```


**Analizamos "Ingreso estimado"**
  
```{r}
ingre <- table(DB$INGRESO)

summary(ingre)

hist(ingre, main = "Distribución del Ingreso Estimado", xlab = "Ingreso Estimado")


boxplot(DF$INGRESO,main="Ingreso",horizontal=TRUE,xlab="Cantidad")
abline(v=mean(DF$INGRESO),col="red")
```

```{r}
# Análisis exploratorio
mean_ingreso <- mean(DB$INGRESO)
var_ingreso <- var(DB$INGRESO)
sd_ingreso <- sd(DB$INGRESO)

# Eliminar empates
I_unique <- unique(DB$INGRESO)

# Prueba de normalidad
shapiro_test <- shapiro.test(I_unique)
ks_test <- ks.test(I_unique, "pnorm")


# Histograma
hist(DB$INGRESO, breaks = "FD", col = "lightblue", main = "Histograma de Ingresos")


# Resultados
cat("Análisis exploratorio:\n")
cat("Media:", mean_ingreso, "\n")
cat("Varianza:", var_ingreso, "\n")
cat("Desviación estándar:", sd_ingreso, "\n\n")

cat("Prueba de normalidad:\n")
cat("Prueba de Shapiro-Wilk:\n")
print(shapiro_test)
cat("Prueba de Kolmogorov-Smirnov:\n")
print(ks_test)

```

## **Conclusiones**

* Como conclusiones finales del proyecto, podemos destacar que hemos logrado identificar y seleccionar variables relevantes que determinan la viabilidad de proyectos de sistemas de detección y protección contra incendios en Lima. A través del análisis de datos, hemos descubierto relaciones importantes entre algunas de estas variables, lo que nos ha permitido aplicar filtros adicionales a nuestras observaciones y determinar cuáles proyectos son más viables.

* Este proceso de selección y filtrado nos proporciona una perspectiva más clara sobre los proyectos que presentan mayor potencial en términos de viabilidad y éxito. Al considerar factores como la ubicación, el tamaño del edificio y otros aspectos relevantes, hemos podido identificar las observaciones que cumplen con criterios más sólidos y se ajustan mejor a nuestras necesidades y capacidades empresariales.

* Estas conclusiones nos permiten optimizar nuestros recursos y enfocar nuestros esfuerzos en aquellos proyectos que tienen mayores posibilidades de generar resultados favorables. Al tener un conjunto de variables bien definido y encontrar relaciones significativas entre ellas, podemos tomar decisiones más informadas y estratégicas en cuanto a los proyectos que decidimos abordar.

* En resumen, este proyecto ha sido exitoso en la selección de variables clave y el análisis de relaciones relevantes, lo cual nos ha permitido refinar nuestras observaciones y determinar qué proyectos de sistemas contra incendios en Lima son más viables y prometedores para nuestro negocio. Estas conclusiones contribuyen a una toma de decisiones más fundamentada y nos posicionan de manera favorable para aprovechar las oportunidades de mercado en este campo.


## **BibliografÍa**
- RPubs - Gráficos univariados y bivariados. (n.d.). Rpubs.com. Retrieved June 5, 2023, from https://rpubs.com/jformoso/838661
- Soetewey, A. (s/f). An efficient way to install and load R packages. Stats and R. Recuperado el 4 de junio de 2023, de https://statsandr.com/blog/an-efficient-way-to-install-and-load-r-packages/



