---
title: "S2 Instalación de sistemas contra incendios"
output:
  html_document:
    toc: yes
    df_print: paged
  html_notebook:
    toc: yes
    theme: united
    highlight: tango
---

<div style="text-align: justify">

## **Introducción**

### Relevancia
Contar con una base de datos que recolecta información sobre edificios en construcción o planificación para empresas que instalan sistemas contra incendios y genere una serie de análisis estadísticos de conveniencia a partir de ellos, es de suma importancia en el ámbito de la seguridad contra incendios para las empresas que instalan estos sistemas en el sector construcción .Nuestra base de datos proporciona a las empresas de sistemas contra incendios una valiosa herramienta para identificar y establecer contactos tempranos con los propietarios o desarrolladores de edificios para darle una mejor idea de cuales son los proyectos que tienen que tener mayor prioridad. Esto les brinda la oportunidad de presentar sus servicios y soluciones desde las primeras etapas del proyecto, lo que puede resultar en una relación comercial sólida y duradera. Al estar involucradas desde el principio, las empresas pueden ofrecer asesoramiento especializado y trabajar en estrecha colaboración con los responsables del proyecto para diseñar e implementar sistemas contra incendios efectivos y conformes con las normativas aplicables. En resumen, una base de datos que recolecta información sobre edificios en construcción o planificación para empresas de sistemas contra incendios es altamente relevante en el ámbito de la seguridad y el crecimiento empresarial.

### Objetivos
- Identificar y contactar con empresas constructoras que están trabajando en la mayor cantidad de proyectos, con el fin de establecer relaciones comerciales y ofrecer servicios de instalación de sistemas contra incendios. Esto permitirá a nuestra empresa maximizar las oportunidades de negocio y aumentar nuestra participación en el mercado de la seguridad contra incendios.

- Identificar la etapa de los edificios (planificación o construcción) para determinar cuáles tienen calendarios de entrega ajustados y probablemente ya hayan contratado a otra empresa de sistemas contra incendios. Esto nos permitirá focalizar nuestros esfuerzos en los edificios que aún no hayan contratado dichos servicios, maximizando así nuestras oportunidades de negocio. 

- Determinar qué edificios son más convenientes para trabajar, considerando una combinación de factores que incluyen el área del edificio, la cantidad de departamentos por piso y la cantidad de detectores que se instalarán. Buscamos identificar aquellos proyectos que presenten un alto potencial de ingresos en relación con la cantidad de trabajo y recursos necesarios. Al evaluar estos factores, podremos seleccionar los proyectos que nos brinden mayores ganancias en un tiempo óptimo, optimizando nuestra rentabilidad y eficiencia operativa.

### Contexto

Este proyecto recopila información sobre edificios en construcción o en  planificación, la cual adquiere una gran relevancia debido al crecimiento y desarrollo urbano continuo que experimenta el país. Esta expansión conlleva un aumento significativo en la construcción de diversos tipos de edificios, incluyendo residenciales, comerciales e industriales. A medida que se llevan a cabo más proyectos de construcción, surge la necesidad de garantizar la seguridad contra incendios en estos edificios, lo que aumenta la importancia de contar con información precisa y actualizada sobre cada proyecto. 


La base de datos es especialmente valiosa para las empresas especializadas en la instalación de sistemas contra incendios. Les brinda una visión panorámica de los edificios en construcción o planificación en todo el país, permitiéndoles identificar oportunidades comerciales estratégicas. Al tener acceso a datos detallados sobre la ubicación, tamaño, etapa de construcción y otros aspectos relevantes de los proyectos, estas empresas pueden evaluar de manera efectiva cuáles edificios son más convenientes para contactar y presentar sus soluciones en seguridad contra incendios. Además, en el contexto normativo peruano, existen requisitos específicos para la instalación de sistemas contra incendios en edificios de determinadas características y tamaños. La base de datos proporciona a las empresas información crucial para adaptar su enfoque y ofrecer soluciones que cumplan con las regulaciones locales. Esto garantiza que los sistemas contra incendios se implementen de manera adecuada y contribuye a la seguridad de los ocupantes de los edificios.


## **Datos**
### Recolección de datos

La recolección de datos se dio con la formación de una base de datos a partir de otras bases de datos que pertenecen a la empresa en la que uno de los integrantes del grupo trabaja, pero en esa recopilación, quedaron muchos espacios vacíos, y para rellenarlos contactamos con las inmobiliarias necesarias vía llamada telefónica o mensajes directos.

### Población, muestra y muestreo

La población son todos los edificios que están en etapa de construcción o planos en toda la región de Lima. Para poder reducir ese número a uno mas manejable, tomamos consideraciones como ubicación, en este caso eliminamos todos los proyectos no se encuentran dentro del perímetro que establecimos, el cual es hasta el aeropuerto por el norte, hasta Ate por el este y hasta Chorrillos por el sur, tomamos esta decisión porque una empresa mediana o pequeña que opera en Lima difícilmente se tomara la molestia de mandar personal, material y supervisores hasta una ubicación muy lejos de sus oficinas. También consideramos solo los edificios mayores a 7 pisos porque un edificio de pocos pisos genera muy poco ingreso para una empresa pequeña que no tiene la logística para realizar este tipo de proyectos de forma masiva, esto se debe a que estos edificios suelen tener estacionamientos al nivel del suelo los cuales no requieren este tipo de sistemas a diferencia de sótanos subterráneos.  Entonces en nuestra primera muestra quedaron aproximadamente 500 observaciones que cumplían con los requisitos que indicamos anteriormente.




### Variables


+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Variable                                                         | Tipo         | Clase        | Restricciones                                                                           |
+==================================================================+:=============+:=============+:========================================================================================+
| Cliente(Inmobiliaria o constructora)                             | Categórica   | Nominal      | No se puede realizar operaciones aritméticas, solo se puede seleccionar opciones dadas. |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Tipo de edificación                                              | Categórica   | Nominal      | No se puede realizar operaciones aritméticas, solo puede seleccionar opciones dadas.    |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Distrito                                                         | Categórica   | Nominal      | No se puede usar descriptores de posición, solo puede seleccionar opciones dadas.       |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Etapa de la Edificación                                          | Categórica   | Ordinales    | No se puede usar descriptores de posición, solo puede seleccionar opciones dadas.       |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Cantidad de pisos                                                | Cuantitativa | Discreta     | Solo acepta números enteros entre 1 y 34.                                               |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Cantidad de sótanos                                              | Cuantitativa | Discreta     | Solo acepta números enteros entre 0 y 7.                                                |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Departamentos por piso                                           | Cuantitativa | Discretas    | Solo acepta números enteros entre 1 y 15.                                               |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Cantidad de detectores de temperatura                            | Cuantitativa | Discretas    | Solo acepta números enteros entre 0 y 2000.                                             |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Cantidad de detectores de humo                                   | Cuantitativa | Discretas    | Solo acepta números enteros entre 1 y 600.                                              |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Área superficial de los edificios  (m^2^)                        | Cuantitativa | Continuas    | Solo acepta números entre 200 y 2500.                                                   |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+
| Ingreso estimado                                                 | Cuantitativa | Continuas    | Solo acepta números entre 2 500 y 85 000.                                               |
+------------------------------------------------------------------+--------------+--------------+-----------------------------------------------------------------------------------------+



### Limpieza de base de datos

A partir de los 500 edificios que recopilamos, había que conseguir una serie de datos importantes al respecto, lamentablemente la mayoría de estos edificios no se encuentran en Internet al estar en etapas muy tempranas de desarrollo y no pudimos establecer una conexión con las constructoras o inmobiliarias a cargo, por lo tanto limpiamos todas las observaciones que quedaron con datos vacíos, que fueron aproximadamente 150, dejándonos aproximadamente con 350 observaciones limpias y listas para analizar.


- Instalación y llamado a las librerías que usaremos :

```{r}
packages <- c("pacman")
installed_packages <- packages%in% rownames(installed.packages())
if (any(installed_packages == FALSE)) {
  install.packages(packages[!installed_packages])
}

pacman::p_load(ggplot2, dplyr, readr,plotrix)
```

- Carga de nuestra base de datos :
```{r}
DF <- read_csv("Database.csv")
```
- Seleccionamos las variables con las que vamos a trabajar, para ello utilizamos la función "select"
```{r}
DB <-select(DF, CLIENTE , `TIPO DE EDIFICACIÓN` , DISTRITO , `ETAPA DE LA EDIFICACIÓN` , PISOS , SÓTANOS , `DEPARTAMENTOS POR PISO` , `CANTIDAD DE DETECTORES DE HUMO` , `CANTIDAD DE DETECTORES DE TEMPERATURA` , `ÁREA DEL EDIFICIO` , INGRESO)
```

- Luego de aplicar "unique" a cada variable se encontró un error en la variable "ETAPA DE EDIFICACION" .

```{r}
unique(DB$`ETAPA DE LA EDIFICACIÓN`)

```
- Se procedió a corregir los errores de redacción que se presentaron durante la creación de la base de datos.

```{r}
DB %>% mutate(`ETAPA DE LA EDIFICACIÓN` = 
        ifelse(`ETAPA DE LA EDIFICACIÓN` == "ETAPA DE CONSTRUCCION", "ETAPA DE CONSTRUCCIÓN", `ETAPA DE LA EDIFICACIÓN`
       )) -> DB
DB %>% count(`ETAPA DE LA EDIFICACIÓN`)
```
Total de Observaciones:

-   Casos completos
```{r}
sum(complete.cases(DB))
```
-   Casos incompletos
```{r}
sum(!complete.cases(DB))
```
-   Total de Variables:
```{r}
ncol(DB)
```

## **Análisis descriptivo**

### Gráfico de barras de Clientes
```{r}
temp <- DB  %>% group_by(CLIENTE) %>% summarise(Total=n())
temp
```
Al haber 163 clientes , mostrar la data en un gráfico seria imposible , por eso filtraremos la data para mostrar cuales son las empresas que tienen un mayor numero de proyectos.
```{r}
Tabla_C <- DB %>% group_by(CLIENTE) %>% summarise(Total=n())   %>%      
    dplyr::mutate(Porcentaje = round(Total/sum(Total)*100, 1))
Tabla_C2 <- Tabla_C %>% filter (temp$Total > 4)
Tabla_C2

```
```{r}
ggplot(Tabla_C2) +
  geom_col(aes(reorder(CLIENTE, Total ), Porcentaje), fill='#BDF032' , width=0.7, position = position_nudge(y=1) ) +
  
  geom_text(aes(label=paste(Porcentaje, '%'), x=reorder(CLIENTE, Total), y=(Porcentaje/100) )  ,                     
            color="white",   
            hjust = 0.1,
            size=3.5 ) +
  labs(title='Constructuras e inmobiliarios', x='Nombre', y='') +
  theme_minimal() +
  coord_flip()+ 
  theme(legend.position = 'none',
        plot.background = element_rect(fill='#212121'),
        text=element_text(color='#FFFFFF'),
        axis.text = element_text(color='#FFFFFF' , size=10),
        axis.text.x = element_blank(),
        panel.grid = element_blank())
```
Gracias a la gráfica podemos identificar que las mejores opciones son "Tale Inmobiliaria" , "Edifica/Produktiva" y "EE Inmobiliaria" . Al tener una mayor numero de proyectos , las empresas preferirían contratar una única empresa que instale sistemas contra incendios para todos sus proyectos.

### Diagrama de Tarta de los Tipos de Edificación

```{r}
table(DB$`TIPO DE EDIFICACIÓN`)
```


```{r}
Tabla_E <- DB %>% group_by(`TIPO DE EDIFICACIÓN`) %>% summarise(Total=n()) %>%     
    dplyr::mutate(Porcentaje = round(Total/sum(Total)*100, 1))             
  
pie3D(Tabla_E$Porcentaje,labels=paste(Tabla_E$Porcentaje,'%'),
      main="Tarta de los tipos de edificación",
      col = heat.colors(length(Tabla_E$Porcentaje)),
      labelcex = 0.99)
legend(1,0.7,legend=Tabla_E$`TIPO DE EDIFICACIÓN`,cex=0.7,yjust=4.7, xjust = 2,
       fill = heat.colors(length(Tabla_E$Porcentaje)))
```
A partir de la gráfica se puede observar que el 97.7% de las edificaciones son Residenciales, esto es importante para el negocio de instalación de sistema contra incendios. Porque se podrá obtener una mayor ganancia cuando se trabaje con las residenciales.


### Gráfico de barra de los distritos.

```{r}
Tabla_D <- DB %>% group_by(DISTRITO) %>% summarise(Total=n()) %>%     
    dplyr::mutate(Porcentaje = round(Total/sum(Total)*100, 2)) 

ggplot(Tabla_D) +
  ylim(c(0,40))+ 
  geom_col(aes(reorder(DISTRITO, Total ), Porcentaje), fill='#14FFEC' , width=0.7, position = position_nudge(y=3) ) +
  
  geom_text(aes(label=paste(Porcentaje, '%'), x=reorder(DISTRITO, Total), y=(Porcentaje/100) )  ,                     
            color="white",   
            hjust = 0.4,
            size=3.5 ) +
  labs(title='Ubicacion de los proyectos inmobiliarios', x='Distrito', y='') +
  theme_minimal() +
  coord_flip()+ 
  theme(legend.position = 'none',
        plot.background = element_rect(fill='#212121'),
        text=element_text(color='#FFFFFF'),
        axis.text = element_text(color='#FFFFFF' , size=13),
        axis.text.x = element_blank(),
        panel.grid = element_blank())
```
Se puede observar que la mayor cantidad de proyectos inmobiliarios se encuentran en los distritos de Miraflores, Surco y San Isidro respectivamente.
```{r}
Tabla_D %>% filter (Porcentaje > 18)
```

### Gráfico de barras de las etapas de las edificaciones.

```{r}
table(DB$`ETAPA DE LA EDIFICACIÓN`)
```
```{r}
Tabla_F <- DB %>% group_by(`ETAPA DE LA EDIFICACIÓN`) %>% summarise(Total=n()) %>%     
    dplyr::mutate(Porcentaje = round(Total/sum(Total)*100, 2)) 

ggplot(Tabla_F) +
  ylim(c(0,100))+ 
  geom_col(aes(`ETAPA DE LA EDIFICACIÓN`, Porcentaje), fill='#6AED32' , width=0.7, position = position_nudge(y=3) ) +
  
  geom_text(aes(label=paste(Porcentaje, '%'), x=`ETAPA DE LA EDIFICACIÓN`, y=(Porcentaje/100) )  ,                     
            color="white",   
            hjust = 0.4,
            size=3.5 ) +
  labs(title='ETAPA DE LA EDIFICACIÓN', x='Etapa de la edificación', y='Cantidad \n (Porcentajes)') +
  theme_minimal() +
  theme(legend.position = 'none',
        plot.background = element_rect(fill='#212121'),
        text=element_text(color='#FFFFFF'),
        axis.text = element_text(color='#FFFFFF' , size=13),
        panel.grid = element_blank())
```
Se puede observar en el gráfico que la mayoría de las edificaciones en encuentran en la etapa de planos, esto es muy favorable para los objetivos del proyecto ya que al no estar con limites de tiempo tan estrictos, las empresas que instalan equipos y sistemas pueden tomarse el tiempo de hacer una buena presentación y ofrecer precios competitivos.

### Histograma de la cantidad de pisos.
```{r}
prom <- round(mean(DB$PISOS),digits= 2)
med <- round(median(DB$PISOS),digits= 2)
moda1 <- function(x) {return(as.numeric(names(which.max(table(x)))))}
moda <- moda1(DB$PISOS)
hist(DB$PISOS,breaks = 34, col= '#F6E396' , main = "Histograma de Pisos",xlab= "Pisos", ylab= "Frecuencia" )
abline(v = prom,col= "red", lwd=3)
abline(v = med, col = "blue", lwd=2, lty = 2)
abline(v = moda,col= '#3F8522', lwd=3,lty = 2.5)
legend("topright",bty= "n", legend = c("Media","Mediana","Moda"),col = c("red", "blue",'#3F8522'),lwd =3, lty= 1:3) 
```
Este gráfico nos indica que la cantidad de pisos esta uniformemente distribuida, por lo que las empresas se encontraran con todo tipo de proyectos para afrontar y no deberían hacer un único modelo de trabajo porque se verán perjudicados a la hora de buscar nuevos proyectos.
```{r}
summary(DB$PISOS)
```
### Histograma de la cantidad de sótanos.

```{r}
moda1 <- function(x) {return(as.numeric(names(which.max(table(x)))))}
moda <- moda1(DB$SÓTANOS)
hist(DB$SÓTANOS,breaks = 7, col= '#9BC5EB' , main = "Histograma de Sótanos",xlab= "Sótanos", ylab= "Frecuencia" )
abline(v = round(mean(DB$SÓTANOS),digits= 2),col= "red", lwd=3)
abline(v = round(median(DB$SÓTANOS),digits= 2), col = "blue", lwd=2, lty = 2)
abline(v = moda,col= "#3F8522", lwd=3,lty = 3)
legend("topleft",bty= "n", legend = c("Media","Mediana","Moda"),col = c("red", "blue","#3F8522"),lwd =3, lty= 1:3) 
```
Esta gráfica nos muestra que la mayoría de los edificios a entregarse tienen 7 sótanos, esto se debe a que a menos que el edificio sea un rascacielos, nunca se necesitaran mas de 7 sótanos, por lo tanto prácticamente todos los edificios que tienen mas de 20 pisos tendrán 7 sótanos.
```{r}
summary(DB$SÓTANOS)
```

### Boxplot de la cantidad de detectores de humo.

```{r}
boxplot(DB$`CANTIDAD DE DETECTORES DE HUMO`,main="Cantidad de detectores de humo",horizontal=TRUE,xlab="Cantidad")
abline(v=mean(DB$`CANTIDAD DE DETECTORES DE HUMO`),col="red")
legend("topright",bty= "n", legend = c("Media"),col = c("red"),lwd =3, lty= 1:3) 
```
La cantidad de detectores de humo esta uniformemente distribuida, esto se debe a que la distribución de pisos también es uniforme y esta variable tiene cierta relación con la mencionada.
```{r}
summary(DB$`CANTIDAD DE DETECTORES DE HUMO`)
```


### Boxplot de la cantidad de detectores de temperatura.

```{r}
boxplot(DF$`CANTIDAD DE DETECTORES DE TEMPERATURA`,main="Cantidad de detectores de temperatura",horizontal=TRUE,ylab="Cantidad")
abline(v=mean(DB$`CANTIDAD DE DETECTORES DE TEMPERATURA`),col="red")
legend("topright",bty= "n", legend = c("Media"),col = c("red"),lwd =3, lty= 1:3) 
```
En este caso también es uniforme a excepción de unos casos atípicos en edificios que ocupen una gran área superficial y necesiten muchos detectores en los sótanos.
```{r}
summary(DB$`CANTIDAD DE DETECTORES DE TEMPERATURA`)
```
### Histograma del tamaño de construccion del edificio.

```{r}
moda1 <- function(x) {return(as.numeric(names(which.max(table(x)))))}
moda <- moda1(DB$`ÁREA DEL EDIFICIO`)
prom <- round(mean(DB$`ÁREA DEL EDIFICIO`),digits= 2)
med <- round(median(DB$`ÁREA DEL EDIFICIO`),digits= 2)
hist(DB$`ÁREA DEL EDIFICIO`,breaks = 20, col= "#F5B377" , main = "Histograma de Área del edificio",xlab= "Área (m^2)", ylab= "Frecuencia" )
abline(v = prom,col= "red", lwd=3)
abline(v = med, col = "blue", lwd=2, lty = 2)
abline(v = moda,col= '#3F8522', lwd=3,lty = 2.5)
legend("topright",bty= "n", legend = c("Media","Mediana","Moda"),col = c("red", "blue",'#3F8522'),lwd =3, lty= 1:3) 
```
Al ser Lima una ciudad densamente poblada, los espacios que existen para construcciones nuevas no son muy amplios, por lo tanto los edificios que se construyen tendrán un área muy considerable.
```{r}
summary(DB$`ÁREA DEL EDIFICIO`)
```

### Boxplot del Ingreso monetario

```{r}
boxplot(DF$INGRESO,main="Ingreso",horizontal=TRUE,xlab="Cantidad")
abline(v=mean(DF$INGRESO),col="red")
```
El ingreso estimado también es uniformemente distribuido y podemos concluir que si se relaciona bien con la cantidad de proyectos que cada empresa podrá realizar simultáneamente sin perdidas significativas.
```{r}
summary(DB$INGRESO)
```
### Comparación entre la cantidad de detectores de humo y el número de departamentos por piso.
```{r}
ggplot(data = DB, 
       mapping = aes(y = `DEPARTAMENTOS POR PISO`, x = `CANTIDAD DE DETECTORES DE HUMO`)) +
  geom_point()+
  geom_smooth(formula = y ~ x,method = "lm")
```
La recta de tendencia sugiere que existe una asociación positiva entre las variables. A mayor cantidad de departamento por piso en una edificación, mayor sera la cantidad de detectores de humo que presentara esta.

### Comparación entre la cantidad de detectores de temperatura y el número de sótanos.
```{r}
ggplot(data = DB, 
       mapping = aes(y = SÓTANOS, x = `CANTIDAD DE DETECTORES DE TEMPERATURA`)) +
  geom_point()+
  geom_smooth(formula = y ~ x,method = "lm")
```

La recta de tendencia sugiere que existe una asociación positiva entre las variables. A mayor cantidad de sótanos por edificación, mayor sera la cantidad de detectores de temperatura.

### Comparación entre el ingreso y el tipo de edificación.
```{r}
ggplot(data = DB, aes(x = INGRESO, fill = `TIPO DE EDIFICACIÓN`)) +
  geom_histogram(binwidth = 5000, color = "white")
```
Podemos ver que hay más observaciones dentro del grupo de las residenciales.

Esto puede resultar más claro en un gráfico de densidad, ya que no depende de la cantidad de observaciones.
```{r}
ggplot(data = DB, aes(x = INGRESO, fill = `TIPO DE EDIFICACIÓN`)) +
  geom_density(alpha = 0.5, color = "darkblue")
```



## **BibliografÍa**
- RPubs - Gráficos univariados y bivariados. (n.d.). Rpubs.com. Retrieved June 5, 2023, from https://rpubs.com/jformoso/838661
- Soetewey, A. (s/f). An efficient way to install and load R packages. Stats and R. Recuperado el 4 de junio de 2023, de https://statsandr.com/blog/an-efficient-way-to-install-and-load-r-packages/



