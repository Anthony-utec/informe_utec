---
title: "S3 AlturaCovid"
date: "14/12/2021"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Tema

Estudio del panorama de fallecidos por COVID-19 en el Perú.

## Introducción

Con el pasar del tiempo, hemos podido observar cómo se han ido creando múltiples cuestiones sobre el comportamiento del COVID-19 cuando influyen distintos factores sobre este. Uno de esos factores que nos interesó analizar fue la frecuencia de muertes a partir de su edad; conocer si influye o no la cantidad de vacunas en la probabilidad de que la persona esté hospitalizada; si la edad influye en su grado de hospitalización, etc. Estas son algunas cosas que nos interesa analizar para al fin y al cabo estudiar el panorama de de fallecidos por COVID-19.

## Objetivos

1 **Objetivo Principal**

* Analizar el comportamiento de los fallecidos por COVID-19 de acuerdo a su edad, la cantidad de dosis de vacuna que tenían, su grado de hospitalización y grado de defunción.

1.1 **Objetivos Específicos**

* Analizar cómo afecta la edad en los casos de personas hospitalizadas que posteriormente fallecieron por COVID-19. 
* Demostrar que las personas vacunadas conforman una pequeña parte de la población fallecida 
* Contrastar la cantidad de fallecidos con la tasa de letalidad de cada distrito del Perú.
* Conocer si las personas fallecidas no vacunadas conforman gran parte de la población con el grado de hospitalización más grave

## Preguntas

Estas son unas preguntas que como grupo nos hicimos:

1. ¿Qué tan probable es que una persona o más sean hospitalizadas?
2. En promedio, ¿la media de edad de los fallecidos pertenece al grupo de edad de adultos mayores (65 años o más)?
3. Entre la población de fallecidos vacunados, ¿la mayoría eran adultos o adultos mayores?
4. ¿Qué tan probable es que, de 100 personas, una o más haya tenido una sola dosis de vacuna?
5. ¿Qué tan probable es que, de 100 personas, una o más hayan tenido las dos dosis de vacuna?
6. ¿La mitad o más de los fallecidos se encontraban a 500 m.s.n.m o menos?
7. En promedio, ¿la Costa tuvo mayor cantidad de fallecidos por día a comparación de la Sierra y la Selva?


## Marco Teórico

El estudio se llevará a cabo con una base de datos pública. Utilizaremos los datos proporcionados por las entidades estatales o gubernamentales oficiales del Gobierno del Perú, como la plataforma de Datos Abiertos y Ministerio de Salud. La organización estatal ha puesto estos datos de forma pública para poner en conocimiento la situación de personas que están con afección de la enfermedad y ayudar a otras organizaciones con propósitos investigativos al proporcionar datos de posible comparación o análisis. Nuestro grupo ha encontrado algunas investigaciones e informes sobre las posibles relaciones de variables que se tiene en el proceso de recuperación los pacientes vacunados, hospitalizados o fallecidos en el Centro Nacional de Epidemiología, Prevención y Control de Enfermedades donde plantean una hipótesis de que el virus SARS COV-2 es dependiente a la relación que poseen ciertas variables principales. Por esa razón, es de nuestro interés analizar los comportamientos que guardan algunas de estas variables.

## Factibilidad

Respecto a la factibilidad del proyecto, tenemos que tomar varias cosas en cuenta que ya hemos cumplido. Primero, ya contamos con los datos completos, los tenemos a disposición y, por si fuera poco, ya los hemos procesado de tal manera que hemos logrado crear una base de datos donde todo está relacionado.

Es importante tener en cuenta cuáles serán nuestros siguientes pasos para llevar acabo con el proyecto.

Para la segunda entrega, iremos preparando el análisis de nuestro conjunto de datos, de tal manera que empezamos a hallar observaciones relevantes en el comportamiento de las variables para así formular hipótesis que servirán para las siguientes entregas. A su vez, prepararemos la presentación oral con tiempo y realizaremos las correcciones de las observaciones del profesor para la P1.

Para la tercera entrega, analizaremos las hipótesis que planteamos en la entrega anterior de manera que las evaluamos con pruebas de hipótesis o intervalos de confianza. También, prepararemos el análisis de fiabilidad con los niveles de confianza de los estimadores calculados por variable. Al igual que las anteriores entregas, prepararemos la presentación oral y las posteriores correcciones en base a las observaciones del profesor para la P2.

Para la cuarta entrega, presentaremos todo el proyecto y sus pasos a manera de resumen. Especialmente destacando las variables que hemos analizado de manera inferencial y predictiva. Junto a esto, vienen las conclusiones que responderán las preguntas que nos propusimos. De esa manera, prepararemos la presentación oral y las correcciones en base a lo que el profesor dé como corrección para la P3.

Con todo lo mencionado anteriormente, podemos concluir que nuestro proyecto tiene buena base y planificación que demuestran su factibilidad para ser llevado a cabo.

### Bases de datos

[Nuestros datos provienen de la Plataforma Nacional de los Datos Abiertos](www.datosabiertos.gob.pe), Ministerio de Salud del Perú MINSA, Centro Nacional de Epidemiología, Prevención y Control de Enfermedades (https://www.dge.gob.pe/portalnuevo/) brindadas por el Gobierno del Perú. Estas bases de datos nos brindan toda la información relacionada a los casos positivos y fallecidos por COVID-19, la provincia, departamento y distrito, etc.

1. [Fallecidos, hospitalizados y vacunados por COVID-19](https://www.datosabiertos.gob.pe/dataset/fallecidos-hospitalizados-y-vacunados-por-covid-19): Esta base de datos nos muestra el universo de fallecidos por el COVID-19, según el criterio del CDC, relacionan la información de los que estuvieron hospitalizados por COVID y si han recibido dosis de vacunas COVID.  Estamos trabajando con los datos del 03/03/2020 hasta el 29/10/2021.

2. [Altitud de cada distrito del Perú](http://usmp.edu.pe/idp/wp-content/uploads/2016/08/altituddistritos.xlsx): Esta base de datos, brindada por la Universidad de San Martín de Porres, nos permitirá relacionar cada distrito del Perú con su altitud sobre el nivel del mar, la cual, posteriormente trabajaremos por rango en vez de valor exacto.

Lo que se busca con estas bases de datos es unirlas de tal manera que se genere una nueva base de datos que contengan todos los datos del fallecimiento de cada persona, presentes en la primera base de datos, y la altitud a la que se encuentra el Centro Nacional de Epidemiología Prevención y Control de Enfermedades (CDC) con el que se ha registrado a dicha persona.

Estas bases de datos nos brindan toda la información útil relacionada a la fecha de fallecimiento de cada persona, su edad, sexo, criterio de fallecido, el departamento, provincia y distrito del CDC bajo el que fue registrado, el número de dosis de vacuna COVID que recibió, el fabricante de cada dosis (en caso se haya vacunado dos veces, ambas dosis deben ser del mismo fabricante), si fue hospitalizado o no, y todo lo relacionado a su grado de hospitalización (si entró a la Unidad de Cuidados Intermedios (UCIN), si entró a la Unidad de Cuidados Intensivos (UCI), si necesitó recibir oxígeno, si necesitó recibir ventilación, si fue dado de alta, indicando que falleció posterior a su hospitalización, o si falleció durante su hospitalización). 

Todos estos datos nos servirán para evaluar la relación entre el número de dosis de vacuna COVID y el grado de hospitalización y defunción por COVID-19.

### Población, Muestra y Unidad Muestral

La información que recopilamos se ha dado a través de bases de datos. Por esa razón, no estamos tomando muestra alguna, ya que estamos trabajando con todos los datos disponibles y registrados desde el 03/03/2020 hasta el 29/10/2021. Cada observación presente en el conjunto de datos es una persona registrada como fallecida.

### Procesamiento de datos

Se utilizó el R MarkDown para procesar los datos y producir la nueva data excluyendo algunas variables, de los 32 variables iniciales, las variables finales fueron 27. Cabe resaltar que la base de datos utilizada y que se encuentra en los archivos es data cruda y se cruzaron base de datos según los parámetro correspondientes en el R. Todos los datos fueron extraídos de base de datos confiables de la plataforma de Datos Abiertos de Perú. En total, nuestra base de datos cuenta con 195 087 personas fallecidas.

```{r echo=TRUE, message=FALSE, warning=FALSE}
library(readr)
library(dplyr)
library(ggplot2) 
filter <- dplyr::filter
select <- dplyr::select


#Base de datos original
D1 <- read_csv("./TB_FALLECIDO_HOSP_VAC.csv")

#Se elimina los datos mal digitados
D2 <- D1[!nchar(D1$id_persona, type = "bytes")>16, ]

#Se elimina las variables que no vamos a usar para el estudio
D3 <- dplyr::select(D2, -dep_domicilio, -prov_domicilio, -dist_domicilio,
             -ubigeo_cdc,-eess_renaes, -eess_diresa,
             -ubigeo_inei_domicilio)

#Se cargaron las altitudes
DA <- read_csv("./alt.csv")

#Se cargan las regiones
DR <- read_csv("./regions.csv")

#Se carga la población total
DP <- read_csv("./total_poblac.csv")

#Se carga la descripción de variables
DV <- read_csv("./Varia.csv")

#Se cargan las etapas según edad
DE <- read_csv("./Etapas.csv")
DE <- dplyr::select(DE, edad, etapa)

#Cruce de base de datos de altitudes y regiones con la base de datos original
DF <- full_join(D3,DA, by = c("dist_cdc", "prov_cdc", "dpt_cdc"))
DF1 <- full_join(DF,DR, by = c("dpt_cdc"))
DF2 <- full_join(DF1, DE, by = "edad")
DF3 <- dplyr::select(DF2, -dep_min)

#Asignamos TF como nuestra base de datos final
TF <- DF3[!is.na(DF3$id_persona), ]
TF$altitud <- strtoi(TF$altitud)

#Procedemos a cambiar todas las columnas que son fechas, como fecha_fallecimiento, fecha_dosis1, fecha_dosis2, etc. del tipo de dato char al tipo de dato date.
TF$fecha_fallecimiento <- as.Date(TF$fecha_fallecimiento, "%d/%m/%Y")
TF$fecha_dosis1 <- as.Date(TF$fecha_dosis1, "%d/%m/%Y")
TF$fecha_dosis2 <- as.Date(TF$fecha_dosis2, "%d/%m/%Y")
TF$fecha_ingreso_hosp <- as.Date(TF$fecha_ingreso_hosp, "%d/%m/%Y")
TF$fecha_ingreso_uci <- as.Date(TF$fecha_ingreso_uci, "%d/%m/%Y")
TF$fecha_ingreso_ucin <- as.Date(TF$fecha_ingreso_ucin, "%d/%m/%Y")
TF$fecha_segumiento_hosp_ultimo <- as.Date(TF$fecha_segumiento_hosp_ultimo, "%d/%m/%Y")
```

## Variables

```{r echo=FALSE, message=FALSE, warning=FALSE}
rmarkdown::paged_table(DV)
```

## Descriptores numéricos 
En la siguiente tabla se mostrará el análisis de las variables numéricas presentes, donde se muestra su media, mediana, mínimo, máximo, etc. Los datos se basan a la cantidad de negativos, positivos, fallecidos y si tuvieron una, dos o ninguna dosis de vacuna.

```{r echo=FALSE, message=FALSE}
library(moments)
frec_dep <- table(TF$dpt_cdc)
frec_dp <- table(TF$dpt_cdc, TF$cdc_positividad)
frec_dvac <- table(TF$dpt_cdc, TF$flag_vacuna)

dn <- matrix(0, 12, 6)
colnames(dn) <- c("Negativos", "Positivos", "Fallecidos", "0 Dosis","1 Dosis", "2 Dosis")
rownames(dn) <- c("Promedio", "Des. Estandar", "Min", "Q1", "Mediana", "Q3", "Max", "Rango", "RIQ", "CV", "Asimetría", "Curtósis")
#Promedio
for(i in 1:6){
  if (i<=2){
    dn[1:1,i] <- mean(frec_dp[1:25,i])
  } else if (i == 3){
    dn[1:1,i] <- mean(frec_dep)
  }else{
    dn[1:1,i] <- mean(frec_dvac[1:25,i-3])
  }
}

#Desviación estándar
for(i in 1:6){
  if (i<=2){
    dn[2:2,i] <- sd(frec_dp[1:25,i])
  } else if (i == 3){
    dn[2:2,i] <- sd(frec_dep)
  }else{
    dn[2:2,i] <- sd(frec_dvac[1:25,i-3])
  }
}

#Mínimo
for(i in 1:6){
  if (i<=2){
    dn[3:3,i] <- min(frec_dp[1:25,i])
  } else if (i == 3){
    dn[3:3,i] <- min(frec_dep)
  }else{
    dn[3:3,i] <- min(frec_dvac[1:25,i-3])
  }
}

#Cuartil 1
for(i in 1:6){
  if (i<=2){
    dn[4:4,i] <- quantile(frec_dp[1:25,i], c(0.25))
  } else if (i == 3){
    dn[4:4,i] <- quantile(frec_dep, c(0.25))
  }else{
    dn[4:4,i] <- quantile(frec_dvac[1:25,i-3], c(0.25))
  }
}

#Mediana
for(i in 1:6){
  if (i<=2){
    dn[5:5,i] <- median(frec_dp[1:25,i])
  } else if (i == 3){
    dn[5:5,i] <- median(frec_dep)
  }else{
    dn[5:5,i] <- median(frec_dvac[1:25,i-3])
  }
}

#Cuartil 3
for(i in 1:6){
  if (i<=2){
    dn[6:6,i] <- quantile(frec_dp[1:25,i], c(0.75))
  } else if (i == 3){
    dn[6:6,i] <- quantile(frec_dep, c(0.75))
  }else{
    dn[6:6,i] <- quantile(frec_dvac[1:25,i-3], c(0.75))
  }
}

#Máximo
for(i in 1:6){
  if (i<=2){
    dn[7:7,i] <- max(frec_dp[1:25,i])
  } else if (i == 3){
    dn[7:7,i] <- max(frec_dep)
  }else{
    dn[7:7,i] <- max(frec_dvac[1:25,i-3])
  }
}

#Rango
for(i in 1:6){
  if (i<=2){
    dn[8:8,i] <- max(frec_dp[1:25,i]) - min(frec_dp[1:25,i])
  } else if (i == 3){
    dn[8:8,i] <- max(frec_dep)-min(frec_dep)
  }else{
    dn[8:8,i] <- max(frec_dvac[1:25,i-3])-min(frec_dvac[1:25,i-3])
  }
}
#RIQ
for(i in 1:6){
  if (i<=2){
    dn[9:9,i] <- quantile(frec_dp[1:25,i], c(0.75))-quantile(frec_dp[1:25,i], c(0.25))
  } else if (i == 3){
    dn[9:9,i] <- quantile(frec_dep, c(0.75))-quantile(frec_dep, c(0.25))
  }else{
    dn[9:9,i] <- quantile(frec_dvac[1:25,i-3], c(0.75))-quantile(frec_dvac[1:25,i-3], c(0.25))
  }
}
#Coeficiente de Variabilidad

for(i in 1:6){
  if (i<=2){
    dn[10:10,i] <- sd(frec_dp[1:25,i])*100/mean(frec_dp[1:25,i])
  } else if (i == 3){
    dn[10:10,i] <- sd(frec_dep)*100/mean(frec_dep)
  }else{
    dn[10:10,i] <- sd(frec_dvac[1:25,i-3])*100/mean(frec_dvac[1:25,i-3])
  }
}

#Asimetría
for(i in 1:6){
  if (i<=2){
    dn[11:11,i] <- skewness(frec_dp[1:25,i])
  } else if (i == 3){
    dn[11:11,i] <- skewness(frec_dep)
  }else{
    dn[11:11,i] <- skewness(frec_dvac[1:25,i-3])
  }
}

#Curtósis
for(i in 1:6){
  if (i<=2){
    dn[12:12,i] <- kurtosis(frec_dp[1:25,i])
  } else if (i == 3){
    dn[12:12,i] <- kurtosis(frec_dep)
  }else{
    dn[12:12,i] <- kurtosis(frec_dvac[1:25,i-3])
  }
}

desc_grafic <- data.frame(dn)
rmarkdown::paged_table(desc_grafic)
```


## Análisis de datos atípicos
#### Para la variable de edades

```{r}
boxplot(TF$edad,horizontal = 1, main="Boxplot: Edades de los fallecidos", xlab = "Edades")
```

Antes de analizar el gráfico, tenemos que percatarnos que tenemos ciertos datos atípicos. Especialmente, uno que salta a la vista debido a que parece tratarse de una edad negativa.

Debido a eso, analizamos cuántos datos atípicos menores a 0 hay en la base de datos

```{r}
sum(TF$edad<0)
rmarkdown::paged_table(TF[TF$edad<0,])
```

Solo se encontró una observación con dicho error. Debido a que pensamos que se trata de un error de registro de datos, pensábamos que solo fue un error de signo, pero después de darle un análisis al resto de sus datos, podemos percatarnos que esta persona recibió ambas dosis de la vacuna Pfizer, por lo que es imposible que esta haya tenido 9 años. Por esa razón, decidimos eliminar esa observación.

```{r echo=TRUE}
TF <- TF[-which.min(TF$edad),]
```

## Descriptores gráficos 
#### Para la frecuencia de fallecidos por departamento

```{r}
#Departamento
departamentos <- table(TF$dpt_cdc)
barplot(departamentos[order(departamentos)],horiz = 1, las = 1, cex.names = 0.5,main = "Gráfico de barras: Cantidad de fallecidos por departamento", xlab = "Fallecidos",col = topo.colors(25))
```

Se puede interpretar del gráfico de barras que existe una mayor incidencia de personas fallecidas en la región de Lima. Esto puede deberse a que Lima es la región del Perú con más habitantes, en especifico 9 485 405 según el censo 2017. Sin embargo, este gráfico no nos quiere decir que el distrito con mayor tasa de letalidad sea Lima, ya que la letalidad se calcula con la población muerta infectada entre la población total, como veremos a partir del siguiente gráfico.

```{r}
#Letalidad por departamento
muer_dpc <- data.frame(departamentos)
colnames(muer_dpc)<- c("dpt_cdc", "fallecidos")
letalidad <- full_join(DP,muer_dpc, by = c("dpt_cdc"))
letalidad$let_por <- letalidad$fallecidos*100/letalidad$poblacion

barplot(height = letalidad$let_por[order(letalidad$let_por)],names = letalidad$dpt_cdc[order(letalidad$let_por)],horiz = 1, las = 1, cex.names = 0.5,main = "Gráfico de barras: Letalidad por departamento", xlab = "Tasa de letalidad %", col = topo.colors(25))
```

Con esta gráfica podemos sacar mejores interpretaciones con respecto a qué región recibió mayor impacto por parte del COVID-19. En la anterior gráfica, Lima tenía más fallecidos, pero en esta gráfica podemos observar que el Callao es el que tiene mayor tasa de letalidad, es decir, es la región donde han habido más muertos en proporción con la cantidad de habitantes en esa región. Otra diferencia muy notoria se puede observar con la región de Ica, la cual tiene una población de 850 765 personas y 8 313 muertos por COVID-19. En la gráfica de número de fallecidos por región, era la 6ta región con más fallecidos, pero en la gráfica de tasa de letalidad es el 2do departamento con mayor tasa de letalidad.

Otra diferencia notoria que vimos, es que Cajamarca al ser el 12vo distrito con más fallecidos, es el último con la menor tasa de letalidad, siendo esta del 0.30%. Por esa razón, podemos concluir que en un departamento pueden haber grandes cantidades de fallecidos, pero eso no significa que en comparación a los demás distritos es donde el COVID parece ser más letal, más bien no representa nada más que la cantidad de los fallecidos hasta ese momento. En cambio, por el lado de la gráfica de letalidad, nos brinda información más detallada respecto a la proporción de personas que mueren por COVID-19 en cada departamento, lo cual puede ser un indicio alarmante que le puede ser de ayuda al Gobierno para priorizar a qué departamento se le debe prestar mayor atención.

#### Para la frecuencia de fallecidos por altitud

```{r}
#Altitud
#hist(strtoi(TF$altitud), xlab = "Altitud", main = "Cantidad de fallecidos por altitud",col = topo.colors(22))

boxplot(strtoi(TF$altitud),horizontal = 1, main="Boxplot: Cantidad de fallecidos por altitud")

summary(strtoi(TF$altitud))
#Para un gráfico de dispersión
#frec_alt <- data.frame(table(strtoi(TF$altitud)))
#plot(x=frec_alt$Var1, y=frec_alt$Freq)
```

Se observa que existe una asimetría positiva considerable respecto a las altitudes, además que la mayor concentración de fallecidos se encuentra entre 63 m.s.n.m. y 409 m.s.n.m. Esto es debido a que como anteriormente se mencionó en la gráfica de barras (Cantidad de fallecidos por región) existe una mayor incidencia de muertes en Lima, siendo que la altitud máxima en esta región registrada en la base de datos es de 953 m.s.n.m., en consecuencia la mayor parte de los fallecidos se encontraría en ese rango de altitud, causando la asimetría mencionada.

#### Para la variable edades
```{r}
#Edad
boxplot(TF$edad,horizontal = 1, main="Boxplot: Edades de los fallecidos")
summary(TF$edad)

```

Se observa que existe una asimetría negativa respecto a las edades de los fallecidos, además que la mayor concentración de fallecidos se encuentra entre los 57 años y 77 años. Creemos que esto se debe a que, al igual que lo que varios estudios han señalado, los adultos mayores son los más propensos a fallecer por COVID-19. La mediana de edad de fallecidos es 67 años y la media es 66, por lo que no hay mucha diferencia entre estos descriptores y podemos decir que no está sesgada para algún lado.

#### Para la variable Sexo
```{r}
#Sexo
porcentaje <- as.numeric(round(((prop.table(table(TF$sexo)))*100),2))
##porcentaje
etiquetas <- c("Femenino - "," Masculino - ")
etiquetas <- paste(etiquetas, porcentaje)
etiquetas <- paste(etiquetas, "%", sep = "")
pie(porcentaje, etiquetas, main ="Gráfico circular: Sexo ", radius = .8, col = c("#22CDC4", "#8904B1"))
```

En esta gráfica circular se describe la proporción de sexo que existe en la base de datos, se puede concluir que de 195 087 fallecidos registrados aproximadamente el 36.25% de fallecidos son mujeres y el 63.75% de fallecidos son hombres. Es decir, casi dos tercios de la población de fallecidos en nuestra base de datos son hombres, mientras que, aproximadamente, el tercio restante son mujeres.

#### Para la variable Vacunas

Creamos un nuevo dataframe, el cual tendrá los datos filtrados de tal manera que solo contaremos los fallecidos desde que se inició el proceso de vacunación. Nos importa tomar en cuenta a los fallecidos y a las personas que fueron ingresadas al hospital después que inició el proceso de vacunación en el Perú.

```{r echo=TRUE}
vacunacion = dplyr::filter(TF, fecha_fallecimiento >= "2021-02-09")

vacunacion = dplyr::filter(vacunacion, fecha_ingreso_hosp >= "2021-02-09")
```

```{r echo=FALSE}
#Grafico de fallecidos desde que inicia el proceso de vacunación en el Perú
#plot(table(vacunacion$fecha_fallecimiento))
```

Es importante denotar que, si bien estamos contando los fallecidos desde que se inició el proceso de vacunación en el Perú el 08/02/2021, hasta ese mismo día, todos los fallecidos seguían siendo no-vacunados, por lo que sería una comparación injusta si es que tomamos en cuenta ese día. Recién a partir del 09/02, personas con alguna dosis empezaron a fallecer. Por esa razón, solo tomamos en cuenta a los fallecidos desde el 09/02/2021 en adelante.

```{r}
#cantidad vacunados
porcentaje2 <- as.numeric(round(((prop.table(table(vacunacion$flag_vacuna)))*100),2))
##porcentaje
etiquetas <- c(" sin dosis - "," 1 dosis - "," 2 dosis - " )
etiquetas <- paste(etiquetas, porcentaje2)
etiquetas <- paste(etiquetas, "%", sep = "")
pie(porcentaje2,etiquetas, main ="Gráfico circular: Vacunados por cantidad de dosis", radius = .8, col = topo.colors(3))
```

Podemos observar que una parte muy pequeña (casi el 8%) de los fallecidos son personas vacunadas, ya sea con 1 dosis o dos. Es bastante interesante percatarnos que, aproximadamente el 93% de los fallecidos son personas no vacunados, incluso tomando en cuenta a los fallecidos desde el inicio del periodo de vacunación en el país. Esto nos puede dar un buen indicador respecto a qué tan importante puede ser el estar vacunado para afrontar al COVID de tal manera que este no resulte tan letal.

#### Vacunados según fabricante
```{r}
#Fabricante de vacunas
fab_vac <- table(c(TF$fabricante_dosis1,TF$fabricante_dosis2))
barplot(fab_vac,col = c("#FA58F4","#F2F5A9", "#0B3B0B"), main = "Gráfico de barras: Cantidad de vacunados por cada fabricante")
```

Se puede interpretar del gráfico de barras que existe una mayor incidencia de personas fallecidas vacunadas con Pfizer y menos incidencia de parte de Sinopharm y Astrazeneca. Esto puede deberse a que la mayoría de fallecidos se encuentra en un rango de edad de 57 años a 77 años, siendo este rango de edad los que se priorizó en vacunar primero y sabemos que la primera vacuna en distribuirse en el país fue Pfizer.

#### Para la variable hospitalizados
```{r}
#Hospitalizado
hospitalizado <- table(TF$flag_hospitalizado)
barplot(hospitalizado[order(hospitalizado)], las = 1, cex.names = 1,main = "Gráfico de barras: Fallecidos hospitalizados",col = topo.colors(2), names.arg=c("Hospitalizado","No hospitalizado"))
legend("topleft", inset=.02, 
   c("Hospitalizados","No hospitalizados"), fill=topo.colors(2), horiz=TRUE, cex=0.8,)
```

Se puede interpretar del gráfico de barras que existe una mayor incidencia de personas fallecidas no hospitalizadas y menor incidencia de parte de las hospitalizadas. Es importante notar que aquí se debe tomar en cuenta también el acceso a la hospitalización que puedan tener las personas de acuerdo a la región en la que se encuentra. A su vez, considerar que desde el comienzo de la pandemia, bastantes personas no lograron ser hospitalizadas debido a que los hospitales estaban repletos en su máxima capacidad.

#### Para la variable el tipo de criterio

```{r}
#Tipo de criterio de fallecido
frec_tf <- table(TF$criterio_fallecido)
barplot(frec_tf[order(frec_tf)],las = 1, cex.names = 0.4, main = "Fallecidos según criterio", xlab = "Criterio de fallecido", col = topo.colors(4))
```

Podemos concluir que la mayoría de personas fallecidas fue con un criterio virolólogico, es decir, fallecer en los 60 días posteriores a una prueba molecular para SARS-CoV-2. Mientras que, menos personas fallecidas fueron con un criterio nexo epidemiológico, en otras palabras, por un caso probable de COVID-19. Este gráfico nos revela información sobre bajo qué criterio han sido ubicado los fallecidos, sin embargo, es necesario entender estos criterios para obtener mayor información de aquí.

## Pares de variables numéricas que sospechamos tienen alguna relación:

La edad es la principal variable numérica con la que relacionamos las demás variables presentes entre los fallecidos por COVID-19, debido a que esta viene a ser un factor de riesgo a tomar en cuenta frente a la gravedad con la que el COVID-19 afecta a una persona.

Es importante recordar que cada observación es un fallecido por COVID-19. De esa manera, se entenderá mejor nuestra intención de relacionarlas siguientes variables:

1. Edad y cantidad de fallecidos
2. Edad y cantidad de hospitalizados
3. Edad y cantidad de personas admitidas en UCI
4. Edad y cantidad de personas que tuvieron una dosis o más
5. Cantidad de vacunas distribuidas y cantidad de hospitalizados


## Análisis entre variables

### Edad con cantidad de fallecidos

Pensamos que conforme aumenta la edad, debería haber un registro mayor de personas fallecidas, debido a que son los grupos de edades avanzadas los que son más vulnerables a que el COVID les afecte de tal manera que los lleve a la muerte.

```{r echo=FALSE, message=FALSE, warning=FALSE}
#Graficamos los fallecidos por edad
plot(table(TF$edad), xlab = "Edad", ylab = "Fallecidos", main = "Relación de edad y fallecidos")
```

Podemos observar que hay una mayor concentración de fallecidos entre los grupos de edades de adultos y adultos mayores, es decir, entre las personas de 40 años a más. Sin embargo, a partir de los 90 años la cantidad de fallecidos cada vez es menor. Creemos que es debido a que de por sí hay pocas personas en el país de 90 años o más, por lo que parecerán pocos fallecidos respecto a los demás grupos de edad poblacionales.

### Edad con cantidad de hospitalizados

De la población total de fallecidos, decidimos seleccionar como muestra a los que fueron hospitalizados. Es así que buscamos observar si es que conforme una persona tenía mayor edad, estas tendían a ser hospitalizadas en mayor medida.

```{r echo=FALSE, message=FALSE, warning=FALSE}
#Graficamos la relación entre edad y los que fueron hospitalizados
plot(table(TF$edad, TF$flag_hospitalizado)[,2], xlab = "Edad", ylab = "Hospitalizados", main = "Relación de edad y hospitalizados")
```

Podemos observar el comportamiento entre edad y hospitalizados pareciera tener una forma de campana, lo cual tiene sentido, ya que son los adultos y adultos mayores los que son más vulnerables al COVID-19, sin embargo, en proporción, la cantidad de adultos mayores a los 90 años son mucho menos comunes, por lo que la cantidad de fallecidos de 90 años en adelante será aún menor y generará ese comportamiento en la gráfica.

### Edad con cantidad de personas que tuvieron que ser admitidas a UCI

De la población total de fallecidos, decidimos seleccionar como muestra a los que fueron admitidos a UCI. De esta manera, buscamos observar si existía algún patrón interesante con la cantidad de personas que necesitaron de la atención en UCI conforme avanza la edad de estas.

```{r echo=FALSE, message=FALSE, warning=FALSE}
#Graficamos la relación entre la edad y los que fueron admitidos en UCI
plot(table(TF$edad, TF$flag_uci)[,2], xlab = "Edad", ylab = "UCI", main = "Edad en relación con atentidos en UCI")
```

Podemos observar que estas tienen un comportamiento muy similar con la relación anterior de la cantidad de hospitalizados distribuidos por edad. Esto se debe, principalmente, a que para ser admitido a UCI una persona debe ser hospitalizada, por lo que creemos que tiene sentido que se observe este patrón entre relaciones.


### Edad con cantidad de personas que fueron vacunadas con por lo menos una dosis

Pensamos que conforme aumenta la edad, debería haber un registro mayor de personas vacunadas, debido a que son los grupos de edades avanzadas los que se priorizaron desde un inicio cuando se empezaron a realizar las vacunaciones en el país.

```{r}
#Graficamos la relación entre edad y vacunados con por lo menos una dosis
plot(table(TF$edad, TF$flag_vacuna>0)[,2], xlab = "Edad", ylab = "Vacunados con una dosis o más", main = "Edad con vacunados")
```

## Cantidad de vacunas distribuidas con cantidad de hospitalizados

Al igual que en el gráfico circular donde evaluamos la cantidad de fallecidos y cuántos de ellos no estaban vacunados, tenían 1 dosis o tenían 2 dosis, para este gráfico tomamos en cuenta a todos los fallecidos desde el 09/02/2021 por la misma razón que mencionamos ahí y no hacer declaraciones no acertadas.

```{r}
vacunacion = dplyr::filter(TF, fecha_fallecimiento >= "2021-02-09")
vacunacion = dplyr::filter(vacunacion, fecha_ingreso_hosp >= "2021-02-09")
#Tabla que cuenta desde que se reparten las vacunas, los agrupo por fecha de ingreso a hospital
hospit = as.data.frame(table(vacunacion$fecha_ingreso_hosp))

#Tabla vacunacion, cuento cuantas primeras dosis se fueron repartiendo por dia
vacDosis1 = as.data.frame(table(vacunacion$fecha_dosis1))

#Lo mismo para dos dosis
vacDosis2 = as.data.frame(table(vacunacion$fecha_dosis2))

#Se junta jhospitaliaados y dosis 1
AAAA = full_join(hospit,vacDosis1, by = c("Var1"))

#Se junta hospitalizados y dosis 2
AAAA = full_join(AAAA,vacDosis2, by = c("Var1"))

#Los NA los reemplazo por 0, para evitar problemas al hacer el cumsum
AAAA[is.na(AAAA)] = 0

#Agarro las columnas 3 y 4 (las de dosis 1 y dosis2) y las sumo, lo del na.rm es por precación
AAAA$sumDosis <- rowSums(AAAA[ , c(3,4)], na.rm=TRUE)


#Acumulada de hospitalizados
AAAA$CumHosp <- cumsum(AAAA$Freq.x)

#Acumulada de Vacunas
AAAA$CumVac <- cumsum(AAAA$sumDosis)

#Dejo de lado las filas independientes de dosis1 y dosis 2, la de la suma porque no es la acumulada, y la de cantidad de hospitalizados no acumulada
AAAA = dplyr::select(AAAA,  -Freq.y, -Freq, -Freq.x, -sumDosis)

#version R
plot(x=AAAA$CumVac, y=AAAA$CumHosp, xlab = "Acumulado de vacunas distribuidas", ylab = "Acumulado de hospitalizados", main = "Acumulados de vacunas y hospitalizados 09/03/21 - Actualidad")

#version ggplot
#ggplot(data = AAAA)+
#  geom_point(aes(x=AAAA[,1], y = AAAA[,2]))

```

En está gráfica tomamos los hospitalizados a partir de un día después iniciada la vacunación, por razones mencionadas anteriormente. Al hacer un gráfico de distribución no acumulada no podemos sacar muchas conclusiones con respecto a la cantidad de vacunados y hospitalizados, sin embargo, si observamos la frecuencia acumulada de estos, conforme pasan los días, podemos decir que en las primeras etapas de vacunación la cantidad de hospitalizados por COVID-19 tenía un comportamiento lineal, pero cuando aproximadamente se llega a las 500 vacunas distribuidas y colocadas, el ritmo con el que crece la cantidad de hospitalizados decrece bastante, lo que podría indicar que las vacunas por su lado reducen que la persona llegue a casos graves como la hospitalización.


## Variables Aleatorias
### Binomial: La probabilidad de que una persona o más personas sean hospitalizadas

Tenemos a la cantidad de personas hospitalizadas que es nuestra variable aleatoria X (Cabe precisar que estas personas ya han fallecido, pero queremos estudiar cuál es la probabilidad de que una persona fallecida escogida al azar fue hospitalizada), entonces nuestro éxito es que la persona haya sido hospitalizada, mientras que nuestro fracaso es que no haya sido hospitalizada.

X ~ B(n, X) donde n es la muestra que tomemos y la probabilidad de éxito es de 17.2662% de obtener algún hospitalizado.

```{r echo=FALSE}
hospitalizado <- table(TF$flag_hospitalizado)
hosp_proba <- data.frame(hospitalizado)
prob_hosp <- hosp_proba[2,2]*100/sum(hosp_proba[,2])
prob_hosp
```

Plantearemos el siguiente ejemplo, si la probabilidad de que algún fallecido este hospitalizado es de 17.2662%, si escogemos una muestra aleatoria de 100 personas, ¿cuál es la probabilidad de que haya exactamente 20 hospitalizados?

```{r echo=TRUE}
dbinom(20, 100, 0.17226) # p = 0.17226
```

Ahora que vimos este ejemplo, podemos graficar la probabilidad de que n personas sean hospitalizadas con una muestra de 100 personas.

```{r}
plot(x = c(0:100), y = dbinom(0:100, 100, 0.17226), xlab = "Fallecidos", ylab = "Probabilidad den hospitalizados", main = "Probabilidad de una muestra de 100 personas n sean hospitalizadas")
```

Es decir esta gráfica nos muestra la probabilidad de éxito que de los fallecidos haya algún hospitalizado, donde la probabilidad de que 17 personas sean hospitalizadas es la más alta, esto se explica con la probabilidad fácilmente ingresada, pero vemos que la probabilidad de que exactamente sean hospitalizadas 100 personas es casi nula. En base a esto, podemos afirmar que hasta cierto momento, de cada 100 personas fallecidas, lo más probable es que 17 de ellas hayan tenido que estar hospitalizadas.

### Binomial: Probabilidad que de una muestra de 100 personas fallecidas, n hayan tenido una sola dosis de la vacuna

Calculamos la probabilidad de fallecidos que tengan 1 dosis de vacuna
```{r echo=TRUE}
vacunacion = dplyr::filter(TF, fecha_fallecimiento > "2021-02-09")
vacunacion = dplyr::filter(vacunacion, fecha_ingreso_hosp > "2021-02-09")
soloVacCon1D = dplyr::filter(vacunacion, is.na(vacunacion$fecha_dosis2) == TRUE)
soloVacCon1D = dplyr::filter(soloVacCon1D, is.na(soloVacCon1D$fecha_dosis1) == FALSE)
cantVacCon1D = nrow(soloVacCon1D)

#probabilidad de que tengan solo 1 dosis de vacuna
probVacCon1D = cantVacCon1D/sum(nrow(vacunacion))
probVacCon1D
```

Se utiliza la distribución Bin(n,p) donde n es 100 y p es 4.832061%

```{r echo = FALSE}
n = 100
#dbinom(0:n, n, probVacCon1D)
plot(x = c(0:n), y = dbinom(0:n, n, probVacCon1D), xlab = "Fallecidos", ylab = "Probabilidad tengan ambas dosis", main = "Probabilidad que de una muestra de 100 personas fallecidas, n hayan tenido una sola dosis de vacuna", cex.main=0.8)

```

En base a esto, podemos afirmar que hasta cierto punto, de cada 100 personas fallecidas solo 18 son altamente probables de tener una sola dosis, lo cual es ciertamente preocupante, si es que se toma en cuenta los hallazgos anteriores respecto a como, aparentemente, la vacuna evita en su mayoría los casos más graves de COVID.

### Binomial: Probabilidad que de una muestra de 100 personas fallecidas, n hayan tenido ambas dosis de la vacuna

Calculamos la probabilidad de fallecidos que tengan 2 dosis de vacuna

```{r echo=TRUE}
vacunacion = dplyr::filter(TF, fecha_fallecimiento > "2021-02-09")
vacunacion = dplyr::filter(vacunacion, fecha_ingreso_hosp > "2021-02-09")

#separamos por un table los que tienen dos dosis, de los que no (ya sea porque tienen 0 dosis o 1 dosis)
cantVacCon2D = table(is.na(vacunacion$fecha_dosis2))[1]

```

```{r echo = TRUE}
#calculamos la probabilidad
probVacCon2D = cantVacCon2D/sum(nrow(vacunacion))
probVacCon2D
```

Se utiliza la distribución Bin(n,p) donde n es 100 y p es 2.682976%

```{r echo=FALSE}
n = 100
#pbinom(0:n, n, probVacCon2D)

plot(x = c(0:n), y = dbinom(0:n, n, probVacCon2D), xlab = "Fallecidos", ylab = "Probabilidad tengan ambas dosis", main = "Probabilidad que de una muestra de 100 personas fallecidas, n hayan tenido ambas dosis de vacuna", cex.main=0.8)
```

Podemos observar que, de por sí, la máxima probabilidad de que alguien tenga las dos dosis de la vacuna es muy pequeña, alcanzando su máximo de probabilidad en solo encontrar dos personas que cumplan con esta condición, lo cual es aún más preocupante que la probabilida anterior.


## Hipótesis e intervalos de confianza

Nos planteamos las siguientes hipótesis:

## 1. **Al menos la mitad de los fallecidos se encontraban a 500 m.s.n.m. o menos**

* Debido a que las capitales con mayor densidad poblacional se encuentran a una baja altitud, es más probable que estas sean las zonas con más fallecidos, por lo que planteamos que al menos el 50% de los fallecidos se encontraban a menor de 500 m.s.n.m. Pensamos esto especialmente porque Lima, siendo la capital con más fallecidos reportados se encuentra a una altitud menor de 500 m.s.n.m.

$H_{0}:$ Al menos el 50% de los fallecidos se encontraban menos de 500 m.s.n.m. $p>=0.5$ 

$H_{1}:$ Menos del 50% de los fallecidos se encontraban menos del 500 m.s.n.m.  $p<0.5$ 


```{r echo = FALSE}
#intervalo de confianza de la proporcion de la altitud de los fallecidos a 500 msnm o mas
n = 500
mues_h <- TF[sample(nrow(TF), n),]
filalt = dplyr::filter(mues_h, mues_h$altitud <=500)
#mues_h

prob = nrow(filalt)/nrow(mues_h)
alfa = 0.05
```

Una vez realizamos la prueba de proporcion con prop.test, nos dio lo siguiente:

```{r}
prop.test(x=nrow(filalt), n=nrow(mues_h), alternative = "less", conf.level = 0.95, correct = FALSE)
```

Debido a que nuestro p-value resultó siendo mayor que alfa (0.05), podemos decir que no hay evidencia suficiente como para negar esta hipótesis, la cual dice que al menos la mitad de los fallecidos se encontraban a 500 m.s.n.m o menos.

A su vez, probamos aplicando la distribución de su probabilidad normal estándar, la cual resultó en el siguiente gráfico:

### Gráfico inferencial
```{r}
zc <- qnorm(0.05)

z <- (prob-0.5)/sqrt((0.5*(1-0.5))/nrow(mues_h))

cat("Con valor z-crítico de", round(zc,3), "y un z ubicado en",round(z,3),"\n\n")

#Grafico
x <- seq(-5, 12, by = 0.1)
y <- dnorm(x)
plot(x, y, type="l", main = "Distribución de Probabilidad Normal Estándar")
abline(v=c(zc,z), lty = c(1,2), col = c("red", "blue"))
coorx1 <- c(-5, seq(-5, zc, 0.01), zc)
coory1 <- c(0, dt(seq(-5, zc, 0.01), 25), 0)
polygon(coorx1, coory1, col = "red")
legend(x="bottomright", inset = c(0.01, 0.31), legend=c("Tc  ", "Tp    "),
       col=c("red", "blue"),lty=1:2, cex=0.6,
       title="Leyenda", text.font=4)
```

Podemos afirmar que esta hipótesis está en la región de aceptación, lo cual quiere decir que no hay información suficiente como para rechazar al menos el 50% de los fallecidos se encontraban menos de 500 m.s.n.m.

### Intervalo de confianza de la proporción de la cantidad de fallecidos a una altitud de 500 m.s.n.m. o menos

Como lo dice la hipótesis presentada anteriormente, nosotros pensamos que, debido a que Lima se encuentra a una altitud por debajo de los 500 m.s.n.m, gran parte de la proporción de fallecidos estará concentrado ahí. Para este caso, ya que estamos dispuestos a aceptar un 5% de error, decidimos usar un 95% de confianza. 

```{r echo = FALSE}
n = 500
mues_h <- TF[sample(nrow(TF), n),]

filalt = dplyr::filter(mues_h, mues_h$altitud <=500)
#mues_h

prob = nrow(filalt)/nrow(mues_h)
alfa = 0.05
z = qnorm(1-(alfa/2))

extremoA =  (prob - (z * sqrt((prob*(1-prob))/n)))*100
extremoB =  (prob + (z * sqrt((prob*(1-prob))/n)))*100

cat("Los extremos del intervalo de confianza de la altitud son",round(extremoA,3),"% y", round(extremoB,3), "%")

```

Dado que contamos con la base de datos entera, es decir, la población, podemos ser capaces de calcular el valor real para comprobar si es que se encuentra dentro de nuestro intervalo de confianza.

```{r}
real = dplyr::filter(TF, TF$altitud<=500)
cat("La proporcion de los fallecidos a 500 m.s.n.m en la base de datos entera, es decir, de la población, es aproximadamente de",round(
(nrow(real)/nrow(TF)),2)*100, "%","\n\n")

cat("Podemos decir que con un nivel de confianza del", 100*(1-alfa),"%, la proporción de la altitud de la población que ha fallecido a 500 m.s.n.m o menos está en el intervalo de confianza de extremos",round(extremoA,3),"% y", round(extremoB,3),"%", "\n")
```

## 2. **El promedio de las edades de los fallecidos es mayor a 65 años**

La edad de 65 años corresponde a la categoría de adultos mayores, grupo de edad el cual es más propenso a que el COVID-19 lo afecte de manera grave. Por ello, planteamos de que la edad promedio de edad de los fallecidos sea por lo menos de 65 años o más.

$H_{0}:$ El promedio de edad de los fallecidos es mayor o igual a 65 años. $u_{0} >= 65$

$H_{1}:$ El promedio de edad de los fallecidos es menor a 65 años. $u_{1} < 65$

```{r}
HEdad <- TF$edad
mues_E <-sample(HEdad,500)
EMedia <- mean(mues_E)
EDes <- sd(mues_E)
EMues <- 500
alpha <- 0.05
```

Probamos aplicando la distribución de su probabilidad normal estándar, la cual resultó en el siguiente gráfico:

### Gráfico inferencial
```{r}
TEc <- ((EMedia-65)*sqrt(EMues))/EDes
#TEc
T0c <- qt(alpha, EMues-1)
#T0c

cat("Con valor t-crítico de", round(T0c,3), "y un t ubicado en",round(TEc,3),"\n\n")

#Grafico
x <- seq(-5, 5, by = 0.1)
y <- dnorm(x)
plot(x, y, type="l", main = "Distribución de Probabilidad Normal Estándar")
abline(v=c(T0c,TEc), lty = c(1,2), col = c("red", "blue"))
coorx1 <- c(-5, seq(-5, T0c, 0.01), T0c)
coory1 <- c(0, dt(seq(-5, T0c, 0.01), 25), 0)
polygon(coorx1, coory1, col = "red")
legend(x="bottomright", inset = c(0.01, 0.31), legend=c("Tc  ", "Tp    "),
       col=c("red", "blue"),lty=1:2, cex=0.6,
       title="Leyenda", text.font=4)

```

Podemos afirmar que esta hipótesis está en la región de aceptación, por lo que aceptamos la hipótesis nula, la cual quiere decir que el promedio de edad de los fallecidos es mayor o igual a 65 años. 

### Intervalo de confianza de la edad de los fallecidos

Debido a la hipótesis presentada, decidimos realizar el intervalo de confianza de la edad de los fallecidos, para corroborar el rango en el que se encuentra la mayoría de las edades de los fallecidos. Decidimos usar un 95% de confianza, debido a que estamos dispuestos a aceptar un 5% de error. También, porque probamos con un 99% de confianza y los resultados eran bastante similares, pero una vez probamos con 90% de confianza, el valor de la media real de la edad llegaba a salirse del intervalo, por lo que decidimos tener más confianza para el intervalo.

```{r echo=FALSE}
#intervalo de confianza de la edad de los fallecidos
n = 500
mues_h <- TF$edad[sample(nrow(TF), n)]
#mues_h

prom = mean(mues_h)
s = sd(mues_h[])
alfa = 0.05 #nivel de significancia, error aleatorio
val = qt(1-alfa/2, n-1)

extremoA = prom - (val* (s/sqrt(n)))
extremoB = prom + (val* (s/sqrt(n)))

hist(mues_h, freq = F, xlab = "Edades", ylab = "Densidad", main = "Grafico de densidad")
lines(density(mues_h))
abline(v=extremoA, col="blue")
abline(v=extremoB, col="blue")
abline(v=mean(mues_h), col="red")

cat("Los extremos del intervalo de confianza de la edad son",round(extremoA,3),"y", round(extremoB,3), "años.")
```

Dado que contamos con la base de datos entera, es decir, la población, podemos ser capaces de calcular el valor real para comprobar si es que se encuentra dentro de nuestro intervalo de confianza.

```{r}
cat("La edad promedio de la base de datos entera, es decir, de la población, es aproximadamente de",round(mean(TF$edad),0), "años.","\n\n")

cat("Podemos decir que con un nivel de confianza del", 100*(1-alfa),"%, la media poblacional de la edad está en el intervalo de confianza de extremos",round(extremoA,3),"y", round(extremoB,3),"años de edad.", "\n")
```

## 3. **La diferencia de medias de fallecidos por día en la Costa, en comparación a la Sierra y la Selva es más que 200**

Como bien sabemos, el COVID-19 afecto más a ciertas zonas del país que a otras, en lugares no muy concurridos del Perú no se presentaban muchos casos de fallecidos, que estos vendrían a representar a la población de la Sierra y la Selva, mientras que en la Costa los fallecidos por día se incrementaban cada vez más, es por ello que compararemos la diferencia de medias entre la Costa con la Sierra y la Selva, y suponemos que estan es mayor a 200.

$H_{0}:$ La diferencia de promedio de fallecidos por día entre la Costa con la Sierra y Selva es menos o igual a 200. $u_{0} =< 200$

$H_{1}:$ La diferencia de promedio de fallecidos por día entre la Costa con la Sierra y Selva es mayor a 200. $u_{1} > 200$

Primero, calculamos la diferencia de la media de fallecidos por día en la Costa y en la Sierra. 

```{r}

FCostaD <-dplyr::filter(TF, region=="Costa")
FCostaD1 <- table(FCostaD$fecha_fallecimiento)
FCostaD2 <- data.frame(FCostaD1)
mues_Costa <- FCostaD2[sample(nrow(FCostaD2), 100), ]

FSierraD<-dplyr::filter(TF, TF$region=="Sierra")
FSierraD1 <- table(FSierraD$fecha_fallecimiento)
FSierraD2 <- data.frame(FSierraD1)
mues_Sierra <- FSierraD2[sample(nrow(FSierraD2), 100), ]

FSelvaD<-dplyr::filter(TF, TF$region=="Selva")
FSelvaD1 <- table(FSelvaD$fecha_fallecimiento)
FSelvaD2 <- data.frame(FSelvaD1)
mues_Selva <- FSelvaD2[sample(nrow(FSelvaD2), 100), ]


alpha <- 0.05

```

Una vez realizamos la prueba de proporción con t.test, nos dio lo siguiente:

```{r}
t.test(x=mues_Costa[,2], y=mues_Sierra[,2], alternative = "greater", conf.level = 0.95, mu=200)
```

Debido a que nuestro p-value resultó siendo menor que alfa (0.05), podemos decir que no  evidencia suficiente como para negar esta hipótesis.

### Gráfico inferencial

```{r}

valorq = qt(1-alpha, 200-2)

#Graph Costa y Sierra
x <- seq(-5, 6, by = 0.1)
y <- dnorm(x)
plot(x, y, type="l", main = "Distribución de Probabilidad Normal Estándar")
abline(v=c(valorq,2.0413), lty = c(1,2), col = c("red", "blue"))
coorx1 <- c(valorq, seq(valorq,5, 0.01), 5)
coory1 <- c(0, dt(seq(valorq, 5, 0.01), 25), 0)
polygon(coorx1, coory1, col = "red")
legend(x="bottomright", inset = c(0.01, 0.31), legend=c("Tc  ", "Tp    "),
       col=c("red", "blue"),lty=1:2, cex=0.6,
       title="Leyenda", text.font=4)

```

Podemos afirmar que esta hipótesis está en la región de rechazo. Por lo que, aceptamos la hipotesis alternativa y entonces la diferenica es mayor a 

Lo mismo realizamos para la diferencia de la media de fallecidos por día en la Costa y en la Selva, donde la prueba de proporción con t.test, nos dio lo siguiente:

```{r}
#Graph Costa y Selva
t.test(x=mues_Costa[,2], y=mues_Selva[,2], alternative = "greater", conf.level = 0.95, mu=200)
```

Debido a que nuestro p-value resultó siendo menor que alfa (0.05), podemos decir que no  evidencia suficiente como para negar esta hipótesis. Sin embargo, podemos darnos cuenta que este p-value es mucho menor a comparación con el p-value de la diferencia de medias de la Costa y Sierra, por lo que podemos afirmar que es mucho menos posible que esta hipótesis suceda.

### Gráfico inferencial

```{r}
x <- seq(-5, 6, by = 0.1)
y <- dnorm(x)
plot(x, y, type="l", main = "Distribución de Probabilidad Normal Estándar")
abline(v=c(valorq,3.3753), lty = c(1,2), col = c("red", "blue"))
coorx1 <- c(valorq, seq(valorq,5, 0.01), 5)
coory1 <- c(0, dt(seq(valorq, 5, 0.01), 25), 0)
polygon(coorx1, coory1, col = "red")
legend(x="bottomright", inset = c(0.01, 0.31), legend=c("Tc  ", "Tp    "),
       col=c("red", "blue"),lty=1:2, cex=0.6,
       title="Leyenda", text.font=4)

```

Podemos afirmar que esta hipótesis está en la región de rechazo, por lo que aceptamos la hipótesis alternativa, la cual dice que la diferencia de promedios de fallecidos por día en la Costa es mayor a 200 personas por día tanto para Sierra como para la Selva.

## 4. **Dentro de los fallecidos que han sido vacunados, esperamos que la mayoría sea mayor a 40 años**

La vacunación se inició aproximadamente el 9 de febrero de 2021, pero nada nos asegura que a partir de esa fecha solo existan vacunados, por lo que se procederá a filtrar por las personas que han sido vacunadas, independientemente si es con una o dos dosis. Nuestra hipótesis gira en torno que los fallecidos que hayan sido vacunado, el promedio de sus edades sea mayor a 40 años.

$H_{0}:$ El promedio de edad de los fallecidos es menor o igual a 40 años. $u_{0} =< 40$

$H_{1}:$ El promedio de edad de los fallecidos que hayan sido vacunados es mayor a 40 años. $u_{1} > 40$

### Gráfico inferencial
```{r echo=FALSE}
vacunacion = filter(TF, fecha_fallecimiento >= "2021-02-09")
vacunacion = filter(vacunacion, fecha_ingreso_hosp >= "2021-02-09")
  vacunacion <- filter(TF, flag_vacuna >=1)
vacunacion <- vacunacion[sample(nrow(vacunacion),100),]
VacMedia <- mean(vacunacion$edad)
VacDS <- sd(vacunacion$edad)
VacN <- 100
TPvac <- ((VacMedia-40)*sqrt(VacN))/VacDS
#TPvac
TCvac <- qt(1-alpha, VacN-1)
#TCvac

cat("Con valor t-crítico de", round(TCvac,3), "y un t ubicado en", round(TPvac,3),"\n\n")


#Grafico
x <- seq(-5, 21, by = 0.1)
y <- dnorm(x)
plot(x, y, type="l", main = "Distribución de Probabilidad Normal Estándar")
abline(v=c(TCvac,TPvac), lty = c(1,2), col = c("red", "blue"))
coorx1 <- c(TCvac, seq(TCvac, 5, 0.01), 5)
coory1 <- c(0, dt(seq(TCvac, 5, 0.01), 30), 0)
polygon(coorx1, coory1, col = "red")
legend(x="bottomright", inset = c(0.01, 0.31), legend=c("Tc  ", "Tp    "),
       col=c("red", "blue"),lty=1:2, cex=0.6,
       title="Leyenda", text.font=4)
```

Podemos afirmar que la hipótesis nula está en la región de rechazo, por lo que se procede a ir con la hipótesis alterna, la cual dice que el promedio de edad de los fallecidos que fueron vacunados es mayor a 40 años.

### Intervalo de confianza del promedio de la edad de fallecidos vacunados

Nosotros suponemos que el promedio de la edad de vacunados, debe encontrarse en un rango mayor o igual a 40 años. Debido a eso, decidimos realizar su intervalo de confianza para ubicar donde se podría encontrar el valor real de la edad de la población de fallecidos vacunados. Para este intervalo usamos un 90% de confianza. Es importante especificar que nosotros consideramos vacunados a las personas que han tenido 1 dosis o más.

```{r}
vacunacion = filter(TF, fecha_fallecimiento >= "2021-02-09")
vacunacion = filter(vacunacion, fecha_ingreso_hosp >= "2021-02-09")
soloVac = filter(vacunacion, is.na(vacunacion$fecha_dosis1) == FALSE)
#soloVac #de esta manera, tenemos SOLO a los que han tenido 1 dosis o más, es decir fallecidos vacunados

n = 500
mues_h <- soloVac$edad[sample(nrow(soloVac), n)]
#mues_h

prom = mean(mues_h)
s = sd(mues_h)
alfa = 0.1 #nivel de significancia, error aleatorio
val = qt(1-alfa/2, n-1)

extremoA = prom - (val* (s/sqrt(n)))
extremoB = prom + (val* (s/sqrt(n)))

hist(mues_h, freq = F, xlab = "Edades", ylab = "Densidad", main = "Grafico de densidad")
lines(density(mues_h))
abline(v=extremoA, col="blue")
abline(v=extremoB, col="blue")
abline(v=mean(mues_h), col="red")

cat("Los extremos del intervalo de confianza de la edad son",round(extremoA,3),"y", round(extremoB,3), "años.")

```

Dado que contamos con la base de datos entera, es decir, la población, podemos ser capaces de calcular el valor real para comprobar si es que se encuentra dentro de nuestro intervalo de confianza.

```{r}
cat("La edad promedio de la poblacion de fallecidos vacunada es aproximadamente de",round(mean(soloVac$edad),3), "años.","\n\n")

cat("Podemos decir que con un nivel de confianza del", 100*(1-alfa),"%, la media poblacional de la edad de fallecidos vacunados está en el intervalo de confianza de extremos",round(extremoA,3),"y", round(extremoB,3),"años de edad", "\n")
```

## 5. **De toda la población de fallecidos, esperamos que a lo mucho el 25% de estos sean personas que hayan estado vacunadas**

Debido a que la vacuna se encarga de proteger el sistema inmunológico de una persona y cómo este reacciona frente al COVID, esperamos que los fallecidos en general que hayan estado vacunados formen una pequeña parte de este universo.

$H_{0}:$ El 25% o menos de los fallecidos son vacunados. $p >= 0.25$ 

$H_{1}:$ Más del 25% de los fallecidos son vacunados. $p<0.25$ 

```{r echo = FALSE}
n = 500
vacunacion = filter(TF, fecha_fallecimiento >= "2021-02-09")
#vacunacion = filter(vacunacion, fecha_ingreso_hosp >= "2021-02-09")
#vacunacion es la tabla que tiene a todos los fallecidos desde que inicia el periodo de vacunacion

mues_h <- vacunacion[sample(nrow(vacunacion), n),]
#mues_h
filalt = filter(mues_h, is.na(mues_h$fecha_dosis1) == FALSE)
#de esta manera, tenemos a los que han tenido una dosis o mas

#probabilidad de la muestra
prob = nrow(filalt)/nrow(mues_h)

#probabilidad de la hipotesis
probHipo = 0.25

alfa = 0.05
```

Una vez realizamos la prueba de proporción con prop.test, nos dio lo siguiente:

```{r echo = FALSE}
prop.test(x=nrow(filalt), n=nrow(mues_h), p = 0.25, alternative = "greater", conf.level = 0.95)
```

Debido a que nuestro p-value resultó siendo mayor que alfa (0.05), podemos decir que no hay evidencia suficiente como para negar esta hipótesis, lo cual creemos que habla bastante bien sobre la vacuna, ya que existe una proporción pequeña de fallecidos vacunados.

A su vez, probamos aplicando la distribución de su probabilidad normal estándar, la cual resultó en el siguiente gráfico:

### Gráfico inferencial

```{r echo = FALSE}
zc <- qnorm(1-alfa)

z <- (prob-probHipo)/sqrt((probHipo*(1-probHipo))/nrow(mues_h))

cat("Con valor t-crítico de", round(zc,3), "y un t ubicado en", round(z,3),"\n\n")

#Grafico
x <- seq(-12, 12, by = 0.1)
y <- dnorm(x)
plot(x, y, type="l", main = "Distribución de Probabilidad Normal Estándar")
abline(v=c(zc,z), lty = c(1,2), col = c("red", "blue"))
coorx1 <- c(zc, seq(zc, 5, 0.01), 5)
coory1 <- c(0, dt(seq(zc, 5, 0.01), 25), 0)
polygon(coorx1, coory1, col = "red")
legend(x="bottomright", inset = c(0.01, 0.31), legend=c("Tc  ", "Tp    "),
       col=c("red", "blue"),lty=1:2, cex=0.6,
       title="Leyenda", text.font=4)
```

Podemos afirmar que esta hipótesis está en la región de aceptación, lo cual quiere decir que no hay suficiente evidencia como para rechazar que el 25% o menos de los fallecidos son vacunados.

# Intervalo de confianza de la proporción de la cantidad de fallecidos vacunados

Nosotros suponemos que de toda la población de fallecidos, un porcentaje bastante pequeño de fallecidos deben ser personas vacunadas. Para hacer esta comparación más justa, filtramos la data a partir de la fecha en que inició el proceso de vacunación, para no realizar una comparación de los fallecidos desde antes que hubieran vacunas en el Perú. Para este caso, estamos dispuestos a aceptar un 5% de error, decidimos usar un 95% de confianza. Es de precisar que nosotros consideramos vacunados a las personas que tienen una dosis o más y, a su vez, estamos considerando para esta hipótesis a los fallecidos desde que se inició el proceso de vacunación.

```{r}

#proporcion: hay menos % de fallecidos vacunados

n = 500
vacunacion = filter(TF, fecha_fallecimiento >= "2021-02-09")
vacunacion = filter(vacunacion, fecha_ingreso_hosp >= "2021-02-09")
#vacunacion es la tabla que tiene a todos los fallecidos desde que inicia el periodo de vacunacion

mues_h <- vacunacion[sample(nrow(vacunacion), n),]
#mues_h
filalt = filter(mues_h, is.na(mues_h$fecha_dosis1) == FALSE)
#de esta manera, tenemos SOLO a los que han tenido 1 dosis

prob = nrow(filalt)/nrow(mues_h)
alfa = 0.05
z = qnorm(1-(alfa/2))

extremoA =  (prob - (z * sqrt((prob*(1-prob))/n)))*100
extremoB =  (prob + (z * sqrt((prob*(1-prob))/n)))*100


cat("Los extremos del intervalo de confianza de la proporcion de fallecidos con vacuna son del",round(extremoA,3),"% y", round(extremoB,3), "%")
```

Dado que contamos con la base de datos entera, es decir, la población, podemos ser capaces de calcular el valor real para comprobar si es que se encuentra dentro de nuestro intervalo de confianza.

```{r}
real = filter(vacunacion, is.na(vacunacion$fecha_dosis1) == FALSE)
cat("La proporción de los fallecidos vacunados en la base de datos entera desde que inició el periodo de vacunación es aproximadamente del",round(
(nrow(real)/nrow(vacunacion)),2)*100, "%","\n\n")


cat("Podemos decir que con un nivel de confianza del", 100*(1-alfa),"%, la proporción poblacional de fallecidos vacunados está en el intervalo de confianza de extremos",round(extremoA,3),"% y", round(extremoB,3),"%", "\n")
```

### Aclaración sobre el grado de hospitalización más grave

Antes de seguir con la siguiente hipótesis, es importante que definamos qué tomamos nosotros como un grado de hospitalización. Nuestra base de datos consisten en personas fallecidas por COVID-19 y datos de ellos como lo son el si fueron hospitalizados o no, si estuvieron en UCI, UCIN o no, si necesitaron oxígeno o no, si necesitaron ventilación o no, etc. Debido a esto, nosotros definimos el grado de hospitalización más grave cuando una persona fallecida llegó a estar en UCI (con esto, nos aseguramos que estuvo hospitalizada), necesitó oxígeno y necesitó ventilación. Con ese término más claro, podemos seguir con la siguiente hipótesis.

## 6. **Dentro de los fallecidos en el grado de hospitalización más grave, esperamos que un 75% o más de estos sean NO vacunados**

Debido a que la vacuna se encarga de proteger el sistema inmunológico de una persona y cómo este reacciona frente al COVID, esperamos que una gran parte de los fallecidos que llegaron a estar hospitalizados en el "peor de los casos" (es decir, estuvieron en UCI, necesitaron oxígeno y ventilación), hayan sido personas que no hayan estado vacunadas.

$H_{0}:$ El 75% o más de los fallecidos en el grado de hospitalización más grave son no vacunados. $p >= 0.75$ 

$H_{1}:$ Menos del 75% de los fallecidos en el grado de hospitalización más grave son no vacunados. $p<0.75$ 

```{r echo = FALSE}
n = 500
vacunacion = filter(TF, fecha_fallecimiento > "2021-02-09")
vacunacion = filter(vacunacion, fecha_ingreso_hosp > "2021-02-09")
#vacunacion es la tabla que tiene a todos los fallecidos desde que inicia el periodo de vacunacion

peorCasosHospitalizados = filter(vacunacion, vacunacion$flag_hospitalizado==1, vacunacion$flag_uci==1, vacunacion$con_oxigeno==1, vacunacion$con_ventilacion==1)

mues_h <- peorCasosHospitalizados[sample(nrow(peorCasosHospitalizados), n),]
filalt = filter(mues_h, is.na(mues_h$fecha_dosis1)==TRUE)
#mues_h

#probabilidad de la muestra
prob = nrow(filalt)/nrow(mues_h)

#probabilidad de la hipotesis
probHipo = 0.75

alfa = 0.05
```

Una vez realizamos la prueba de proporción con prop.test, nos dio lo siguiente:

```{r}
prop.test(x=nrow(filalt), n=nrow(mues_h), p = 0.75, alternative = "less", conf.level = 0.95)
```

Debido a que nuestro p-value resultó siendo mayor que alfa (0.05), podemos decir que no hay evidencia suficiente como para negar esta hipótesis.

A su vez, probamos aplicando la distribución de su probabilidad normal estándar, la cual resultó en el siguiente gráfico:

### Gráfico inferencial

```{r}
zc <- qnorm(alfa)
#zc
z <- (prob-probHipo)/sqrt((probHipo*(1-probHipo))/nrow(mues_h))
#z

cat("Con valor t-crítico de", round(zc,3), "y un t ubicado en", round(z,3),"\n\n")

#Grafico
x <- seq(-5, 12, by = 0.1)
y <- dnorm(x)
plot(x, y, type="l", main = "Distribución de Probabilidad Normal Estándar")
abline(v=c(zc,z), lty = c(1,2), col = c("red", "blue"))
coorx1 <- c(-5, seq(-5, zc, 0.01), zc)
coory1 <- c(0, dt(seq(-5, zc, 0.01), 25), 0)
polygon(coorx1, coory1, col = "red")
legend(x="bottomright", inset = c(0.01, 0.31), legend=c("Tc  ", "Tp    "),
       col=c("red", "blue"),lty=1:2, cex=0.6,
       title="Leyenda", text.font=4)

```

Podemos afirmar que esta hipótesis está en la región de aceptación. Esto significa que no hay evidencia suficiente como para no afirmar que el 75% o más de los fallecidos en el grado de hospitalización más grave son no vacunados. Debido a esto, como grupo, nos deja pensando bastante bien sobre la efectividad que tiene la vacuna al hacer que estos casos más graves de COVID estén mucho menos presentes en personas vacunadas que en las personas no vacunadas.

### Intervalo de confianza de la proporción de la cantidad de fallecidos NO vacunados en el grado más grave de hospitalización

Como lo dice la hipótesis presentada, buscaremos en qué intervalo de confianza se puede encontrar la proporción real de fallecidos no vacunados con un grado de hospitalización grave. El intervalo lo haremos con un nivel de confianza del 90%.

```{r echo = FALSE}
n = 500
vacunacion = filter(TF, fecha_fallecimiento >= "2021-02-09")
vacunacion = filter(vacunacion, fecha_ingreso_hosp >= "2021-02-09")
#vacunacion es la tabla que tiene a todos los fallecidos desde que inicia el periodo de vacunacion

peorCasosHospitalizados = filter(vacunacion, vacunacion$flag_hospitalizado==1, vacunacion$flag_uci==1, vacunacion$con_oxigeno==1, vacunacion$con_ventilacion==1)

mues_h <- peorCasosHospitalizados[sample(nrow(peorCasosHospitalizados), n),]
filalt = filter(mues_h, is.na(mues_h$fecha_dosis1)==TRUE)
#mues_h

#probabilidad de la muestra
prob = nrow(filalt)/nrow(mues_h)

#probabilidad real
real = filter(vacunacion, is.na(vacunacion$fecha_dosis1)==TRUE)


alfa = 0.1
prob = nrow(filalt)/nrow(mues_h)
z = qnorm(1-(alfa/2))

extremoA =  (prob - (z * sqrt((prob*(1-prob))/n)))*100
extremoB =  (prob + (z * sqrt((prob*(1-prob))/n)))*100

cat("Los extremos del intervalo de confianza de la proporción de la cantidad de fallecidos NO vacunados en el grado más grave de hospitalización son del ",round(extremoA,3),"% y", round(extremoB,3), "%")
```

Dado que contamos con la base de datos entera, es decir, la población, podemos ser capaces de calcular el valor real para comprobar si es que se encuentra dentro de nuestro intervalo de confianza.

```{r}
cat("La proporción de los fallecidos NO vacunados en el grado de hospitalización más grave en la base de datos entera, es decir, de la población, es aproximadamente de",round(
(nrow(real)/nrow(vacunacion)),2)*100, "%","\n")

cat("Podemos decir que con un nivel de confianza del", 100*(1-alfa),"%, la proporción de los fallecidos NO vacunados en el grado de hospitalización más grave está en el intervalo de confianza de extremos",round(extremoA,3),"% y", round(extremoB,3),"%", "\n")

```


## Regresiones

## 1. **Relación entre el acumulado de vacunas distribuidas y acumulado de fallecidos**

```{r echo = FALSE, message=FALSE, warning=FALSE}
library(dplyr)
vacunacion = dplyr::filter(TF, fecha_fallecimiento >= "2021-02-09")
vacunacion = dplyr::filter(vacunacion, fecha_ingreso_hosp >= "2021-02-09" | is.na(fecha_ingreso_hosp) == TRUE)

fallecid = as.data.frame(table(vacunacion$fecha_fallecimiento))

hospit = as.data.frame(table(vacunacion$fecha_ingreso_hosp))

personasUCI = as.data.frame(table(vacunacion$fecha_ingreso_uci))

#Tabla vacunacion, cuento cuantas primeras dosis se fueron repartiendo por dia
vacDosis1 = as.data.frame(table(vacunacion$fecha_dosis1))

#Lo mismo para dos dosis
vacDosis2 = as.data.frame(table(vacunacion$fecha_dosis2))

#Se junta jhospitaliaados y dosis 1
AAAA = full_join(fallecid,vacDosis1, by = c("Var1"))

#Se junta hospitalizados y dosis 2
AAAA = full_join(AAAA,vacDosis2, by = c("Var1"))

AAAA = full_join(AAAA, hospit, by=c("Var1"))

AAAA = full_join(AAAA, personasUCI, by = c("Var1"))

#Los NA los reemplazo por 0, para evitar problemas al hacer el cumsum
AAAA[is.na(AAAA)] = 0

#Agarro las columnas 3 y 4 (las de dosis 1 y dosis2) y las sumo, lo del na.rm es por precación
AAAA$sumDosis <- rowSums(AAAA[ , c(3,4)], na.rm=TRUE)


#Acumulada de Vacunas
AAAA$CumVac <- cumsum(AAAA$sumDosis)


AAAA$CumUci = cumsum(AAAA$Freq)

AAAA$CumHospit = cumsum(AAAA$Freq.y.y)

#Acumulada de hospitalizados
AAAA$CumFallecidos <- cumsum(AAAA$Freq.x)

#Dejo de lado las filas independientes de dosis1 y dosis 2, la de la suma porque no es la acumulada, y la de cantidad de hospitalizados no acumulada
AAAA = dplyr::select(AAAA,  -sumDosis, -Freq.y, -Freq.x.x, -Freq, -Freq.x, -Freq.y.y)

AAAA$Var1 <- as.Date(AAAA$Var1)
Vacunados <- read_csv("./out2.csv")
colnames(Vacunados) <- c("Var1", "Dosis")
Vacunados$Var1 <- as.Date(Vacunados$Var1)
AAAA = full_join(AAAA, Vacunados, by=c("Var1"))
colnames(AAAA)<- c("Fechas", "Vacunados", "UCI", "Hospitalizados", "Fallecidos", "Vacunas")
AAAA <- filter(AAAA,Fechas <"2021-10-30")
AAAA <-AAAA[-264,]
AAAA$CumVacu <- cumsum(AAAA$Vacunas)
AAAA = dplyr::select(AAAA,  -Vacunas)
colnames(AAAA)<- c("Fechas", "Vacunados", "UCI", "Hospitalizados", "Fallecidos", "Vacunas")

```

Para esta relación entre variables, lo primero que hay que tener en cuenta es que ya no se considera los vacunados fallecidos, en cambio se considerará a los vacunados, ya sea fallecido o persona común que decidió a vacunarse, desde que inicio la vacunación hasta el 2021/10/30. Esta relación no presenta una relación lineal, más bien se asemeja a la una función logarítmica. Por ello, se planteará un modelo logarítmico para ver su compartimiento, tengamos en cuenta que para una función logarítmica sucede que, a valores más grandes, la variable respuesta se hace casi constante.

```{r}
#version R
model1 <- lm(Fallecidos ~ log(Vacunas,2), data = AAAA) #Se plantea el modelo de grado 3
ggplot(data = AAAA, aes(x=Vacunas, y = Fallecidos))+ geom_point()+ stat_smooth(method = lm, formula = y ~ x + log(x))
summary(model1)
```

Para este modelo no lineal, vemos que el $R^2 =   0.9161$, es decir, la relación entre variables, es cercana a 1, lo cual nos indica que existe cierta dependencia significativa entre la cantidad de vacunas repartidas y fallecidos, y es que, a más vacunas repartidas, el acumulado de fallecidos tendrá un comportamiento parecido al constante, donde la pendiente de la recta es cada vez más cercana 0.


```{r}
par(mfrow = c(2,2))
plot(model1) #Grafica de residuos para el modelo
```

***Residuos vs datos ajustados***

La línea roja al no seguir un patrón lineal, reafirma que nuestro datos no presentan una regresión lineal, por ello el modelo de regresión logarítmico es el más adecuado para este.

***Normal Q-Q***

Vemos que cierta parte de los datos se desvían de lo que sería una distribución normal, siendo los datos más atípicos el 1 y 2; sin embargo, aún podemos decir que los gráficos están distribuidos normalmente debido a que son unos pocos datos que se desvían, mientras que una gran parte aún permanece en la línea.

***Scale vs Location***

Nuestra línea es aproximadamente lineal, por lo que podemos decir que la varianza es casi igual. Por otro lado, los datos presentan un patrón de comportamiento y no están distribuido aleatoriamente, por lo que sería pertinente estudiar las causas del por qué. Uno de los posibles razones podría ser el comportamiento casi lineal que se presenta cuando determinadas vacunas son distribuidas.

***Residuos frente a apalancamiento***

Justo en este gráfico, vemos que un dato logra cruzar la distancia de Cook, por lo que sin ese dato presente, el modelo cambiaría. Por ello, se sugiere no eliminar los datos.

## 2. **Relación entre el acumulado de vacunas distribuidas y acumulado de personas hospitalizadas**

Para esta regresión, se considerará lo que se mencionó en la primera regresión acerca de la cantidad de vacunados. En este caso, el comportamiento presentado también es un logaritmico y, por ende, no lineal.

```{r}
#version R
model2 <- lm(Hospitalizados ~ log(Vacunas,2), data = AAAA) #Se plantea el modelo de grado 3
ggplot(data = AAAA, aes(x=Vacunas, y = Hospitalizados))+ geom_point()+ stat_smooth(method = lm, formula = y ~ x + log(x))
summary(model2)
```

Para este modelo no lineal, vemos que el $R^2 =   0.9086$, es decir, la relación entre variables, es cercana a 1, lo cual nos indica que existe cierta dependencia significativa entre la cantidad de vacunas repartidas y hospitalizados, y es que a más vacunas repartidas, nos dice básicamente que las personas que serán hospitalizadas es casi constante, porque tomemos en cuenta que este gráfico es del acumulado de personas hospitalizadas y si este se mantiene con un comportamiento casi constante, nos quiere decir que las personas hospitalizadas han aumentado a una velocidad mucho menor que antes.

```{r}
par(mfrow = c(2,2))
plot(model2) #Grafica de residuos para el modelo
```

***Residuos vs datos ajustados***

La línea roja al no seguir un patrón lineal, comprueba que nuestro modelo se ajusta mejor a una regresión no lineal, en este caso, una logarítmica.

***Normal Q-Q***

Vemos que cierta parte de los datos se desvían de lo que sería una distribución normal, siendo los datos más atípicos el 1 y 2; sin embargo, aún podemos decir que los gráficos están distribuidos normalmente debido a que son unos pocos datos que se desvían mientras que una gran parte aún permanece en la línea.

***Scale vs Location***

Nuestra línea es aproximadamente lineal, por lo que podemos decir que la varianza es casi igual. Los datos presentan un patrón de comportamiento que decrece y crece, a excepción de los datos 1 y 2. Podríamos decir que nuestro modelo presenta homocedasticidad.

***Residuos frente a apalancamiento***

Algunos datos cruzan la distancia de Cook, el que más resulta es el dato 1, es decir, que ese dato es muy significativo para nuestro modelo y eliminarlo llevaría a un gran cambio en el modelo aplicado.


## 3. **La relación de la densidad poblacional con la cantidad de fallecidos**

Para este análisis, vemos que hay un dato que tiene unos valores muy alto que corresponde a los habitantes y fallecidos en Lima, por lo que se procederá a remover ese dato para analizar el comportamiento de los demás datos obtenidos.

```{r}
letalidad1 <- letalidad
plot(x = letalidad1$poblacion, y=letalidad1$fallecidos, xlab = "Población no fallecida", ylab="Personas fallecidas")
```

Al remover este dato obtenemos la siguiente gráfica con la cual se procederá a trabajar. La primera gráfica no presenta un modelo lineal en si, mientras que la segunda se presenta la tendencia que presentan estos datos. Además, ante el modelo lineal planteado se verá su compartimiento.

```{r}
letalidad1 <- letalidad1[-15,]
colnames(letalidad1)<- c("Departamento", "Poblacion", "Fallecidos", "Letalidad")

plot(x = letalidad1$Poblacion, y=letalidad1$Fallecidos, xlab = "Población", ylab = "Fallecidos")
model4 <- lm(Fallecidos ~ Poblacion, data = letalidad1) #Se plantea el modelo de grado 3
ggplot(data = letalidad1, aes(x=Poblacion, y = Fallecidos))+ geom_point()+ stat_smooth(method = lm, formula = y ~ x)
summary(model4)
```

Para este modelo no lineal, vemos que el $R^2 = 0.7272$, es decir la relación entre variables existe y es muy próxima a 1.

Ahora, veremos los gráficos de diagnóstico para el modelo de regresión lineal planteado. Esto nos servirá sobre todo en las predicciones donde tengamos que trabajar con valores particulares. Obtendremos 4 gráficas, las cuales analizaremos una por una:

```{r}
par(mfrow = c(2,2))
plot(model4) #Grafica de residuos para el modelo
```

***Residuos vs datos ajustados***

La primera gráfica nos quiere decir que los datos que tenemos no se aproximan para nada a un modelo lineal, por lo que un modelo polinomio es el más indicado para estos datos. En este caso, un polinomio de 3er grado.

***Normal Q-Q***

Vemos que la mayoría de datos se distribuyen a través de la línea recta lo que indicaría que los residuos están distribuidos de manera normal. Los datos atípicos no se alejan mucho de la recta, por lo que no afectaría a la distribución normal.

***Scale vs Location***

Vemos que el gráfico presenta cierta heterocedasticidad y esto se debe a que nuestro modelo no sigue un modelo lineal de por sí, mas bien, los valores aquí están más dispersos que en los anteriores gráficos. La varianza varía mucho con respecto a los datos.

***Residuos frente a apalancamiento***

Justo en este gráfico, vemos que menos datos están por debajo de la distancia de Cook, por lo que se seguirá considerando no eliminar a esos valores ya que pueden afectar al modelo planteado.


## Conclusiones

Tras el análisis del presente informe, podemos concluir que:

1. La base de datos nos logró brindar una perspectiva muy detallada respecto a los casos de fallecimientos por COVID-19 y las variables que nos interesaron investigar, las cuales principalmente fueron edad, números de dosis de vacuna y grado de hospitalización.

2. Se sabe gracias a estudios y el acelerado avance clínico que las vacunas contra el COVID-19 permiten que aquellas personas con las vacunas completas si bien podrían contagiarse del virus, estas evitarían que se desarrollen formas graves de este en el organismo, llegando únicamente a formas leves o asintomáticas de dicha enfermedad. Como pudimos apreciar con nuestra prueba de hipótesis para la hipótesis 5, no encontramos evidencia para rechazar que a lo mucho el 25% de las personas fallecidas a causa de COVID-19 eran personas vacunadas. Además, gracias a su gráfico de distribución de probabilidad normal estándar, pudimos reafirmar que dicha hipótesis se encuentra en la región de aceptación.

4. Consideramos necesario hacer una diferencia entre un análisis de cantidad de fallecidos por región y tasa de letalidad por región. Nos pareció un hallazgo muy importante dado que viéndolo desde un punto de vista de cantidad de fallecidos podemos decir que tenemos una vista más superficial de la situación. Decimos esto porque, especialmente en un país como Perú, saldrán primero las regiones con mayor densidad poblacional, relegando atrás regiones donde, a través de una perspectiva de tasa de letalidad, estas posiblemente estén en una situación igual o peor, debido a que hay una mayor tasa de muertos, tomando en cuenta su población actual.

5. La cantidad de fallecidos y su grado de hospitalización tiene una fuerte relación con la edad que posee la persona con COVID, pues el estudio muestra que la mayor cantidad de personas fallecidas hospitalizadas son personas adultas mayores que estuvieron en unidad de cuidados intensivos (UCI) con una edad en promedio de 65 años. Esto tendría relación con lo que se viene diciendo por parte de la Organización Mundial de la Salud respecto a que los adultos mayores son los más propensos a fallecer por COVID-19. 

6. Respecto a las vacunas, logramos demostrar que entre toda la población de fallecidos, las personas vacunadas conforman una parte muy pequeña del universo de personas fallecidas. Incluso conforman un grupo más pequeño aún si es que nos fijamos en el grado de hospitalización más grave, el cual involucra que una persona haya tenido que estar en UCI, requerir oxígeno y ventilación. Esto habla bastante bien de la efectividad de las vacunas y su potencial de reducir el impacto que tiene el COVID en una persona, especialmente en las que se encuentran en los grupos de riesgo.

7. Todas las distintas etapas del proyecto fueron fundamentales para lograr desempeñar la mejor investigación de los datos. Comenzando con la estadística descriptiva, que nos permitió observar de manera rápida y resumida cómo se comportan los datos hasta el momento. Esta etapa fue bastante importante para entender cómo se comportaban los fallecidos por COVID-19, de acuerdo a su edad. Por su parte, la estadística de probabilidades nos fue de ayuda para experimentar y observar aparentes relaciones entre variables que sospechábamos tenían cierto comportamiento entre sí. Esta parte nos sirvió mucho para responder las preguntas que nos realizamos previa a la investigación. Por último, si bien nuestra base de datos puede constituir como una población y no una muestra, la estadística inferencial nos sirvió para comprobar las hipótesis y preguntas que nos realizamos durante la investigación presente, las cuales fueron fundamentales para lograr los objetivos que nos planteamos.


## Bibliografia

- Plataforma Nacional de Datos Abiertos (p. RENIEC). (2020). Calle Schell 310, Miraflores 15074: Secretaría de Gobierno Digital Presidencia del Consejo de Ministros.
https://www.datosabiertos.gob.pe/dataset/hospitalizados-vacunados-y-fallecidos-por-covid-19

- Ministerio de Salud. (2020). Centro Nacional de Epidemiología, Prevención y Control de Enfermedades (p. RENIEC). Calle Schell 310, Miraflores 15074: Secretaría de Gobierno Digital Presidencia del Consejo de Ministros.
https://www.dge.gob.pe/portalnuevo/covid-19/situacion-del-covid-19-en-el-peru/
